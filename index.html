<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>파워링크 광고 소재 생성기 | AI마케팅전략연구소</title>
<link href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.css" rel="stylesheet">
<style>
/* Pretendard Variable loaded via link tag */

/* ── 리셋 & 기본 ── */
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --g:#03C75A;--g2:#00e676;--g-dim:rgba(3,199,90,.12);--g-glow:rgba(3,199,90,.35);
  --b:#0066ff;--b2:#3385ff;
  --bg:#060d17;--bg2:#091320;--bg3:#0d1a2d;
  --glass:rgba(255,255,255,.04);--glass2:rgba(255,255,255,.07);
  --border:rgba(255,255,255,.08);--border2:rgba(255,255,255,.12);
  --text:#e8f0fe;--text2:rgba(232,240,254,.9);--text3:rgba(232,240,254,.7);
  --red:#ff4d6d;--amber:#f59e0b;
  --shadow:0 8px 32px rgba(0,0,0,.5);
  --shadow-g:0 0 30px rgba(3,199,90,.2);
  --r:12px;--r2:8px;
  --hh:48px;
}
html{scroll-behavior:smooth}
body{
  font-family:'Pretendard Variable','Pretendard',-apple-system,'Apple SD Gothic Neo','Malgun Gothic',sans-serif;
  background:var(--bg);color:var(--text);font-size:15px;line-height:1.6;
  min-height:100vh;overflow-x:hidden;
}

/* ══ 오로라 배경 ══ */
.aurora{
  position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;
}
.aurora-1{
  position:absolute;width:900px;height:600px;
  top:-200px;left:-200px;
  background:radial-gradient(ellipse,rgba(3,199,90,.07) 0%,transparent 65%);
  animation:auroraMov1 18s ease-in-out infinite alternate;
}
.aurora-2{
  position:absolute;width:700px;height:500px;
  top:30%;right:-200px;
  background:radial-gradient(ellipse,rgba(0,102,255,.08) 0%,transparent 65%);
  animation:auroraMov2 22s ease-in-out infinite alternate;
}
.aurora-3{
  position:absolute;width:600px;height:400px;
  bottom:-100px;left:30%;
  background:radial-gradient(ellipse,rgba(3,199,90,.05) 0%,transparent 65%);
  animation:auroraMov3 15s ease-in-out infinite alternate;
}
@keyframes auroraMov1{from{transform:translate(0,0) scale(1)}to{transform:translate(120px,60px) scale(1.15)}}
@keyframes auroraMov2{from{transform:translate(0,0) scale(1)}to{transform:translate(-80px,100px) scale(1.1)}}
@keyframes auroraMov3{from{transform:translate(0,0) scale(1)}to{transform:translate(-60px,-80px) scale(1.2)}}

/* 노이즈 오버레이 */
.noise{
  position:fixed;inset:0;z-index:1;pointer-events:none;opacity:.025;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

/* ══ 모달 ══ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(12px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn .2s ease}
.overlay.hidden{display:none!important}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{opacity:0;transform:translateY(24px) scale(.97)}to{opacity:1;transform:none}}

/* API Key 모달 */
.key-modal{background:linear-gradient(160deg,#0a1628,#0f1f38);border:1px solid var(--border2);border-radius:20px;max-width:480px;width:100%;box-shadow:0 24px 80px rgba(0,0,0,.6),0 0 0 1px rgba(3,199,90,.08);animation:slideUp .3s cubic-bezier(.34,1.56,.64,1);overflow:hidden}
.key-modal-head{background:linear-gradient(135deg,#0a1628 0%,rgba(3,199,90,.06) 100%);padding:26px 28px 22px;position:relative;border-bottom:1px solid var(--border)}
.key-modal-head::after{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at top right,rgba(3,199,90,.08),transparent 60%);pointer-events:none}
.key-modal-head .logo-mark{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#029e48,var(--g));display:flex;align-items:center;justify-content:center;font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:22px;font-weight:900;color:#fff;margin-bottom:14px;box-shadow:0 4px 16px var(--g-glow)}
.key-modal-head h2{font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:19px;font-weight:800;color:#fff;margin-bottom:5px}
.key-modal-head p{font-size:12px;color:var(--text3);line-height:1.6}
.key-modal-body{padding:20px 28px}
.step-guide{margin-bottom:16px}
.step-guide-title{font-size:10px;font-weight:700;color:var(--text3);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px}
.step-row{display:flex;gap:10px;align-items:flex-start;margin-bottom:8px}
.step-num{width:20px;height:20px;border-radius:50%;background:var(--g-dim);border:1.5px solid rgba(3,199,90,.4);color:var(--g);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
.step-text{font-size:12px;color:var(--text2);line-height:1.6}
.step-text a{color:var(--g);text-decoration:none;font-weight:600}
.key-input-wrap{background:rgba(0,0,0,.3);border:1.5px solid var(--border);border-radius:10px;padding:10px 14px;margin-bottom:6px;display:flex;align-items:center;gap:10px;transition:border-color .2s,box-shadow .2s}
.key-input-wrap:focus-within{border-color:rgba(3,199,90,.5);box-shadow:0 0 0 3px rgba(3,199,90,.08)}
.key-input-wrap input{flex:1;border:none;background:none;outline:none;font-family:inherit;font-size:12px;color:var(--text);letter-spacing:.5px}
.key-input-wrap input::placeholder{color:var(--text3)}
.eye-btn{background:none;border:none;cursor:pointer;color:var(--text3);font-size:14px;padding:0;transition:color .15s}
.eye-btn:hover{color:var(--text2)}
.key-notice{font-size:11px;color:var(--text3);line-height:1.7;margin-bottom:16px}
.key-notice span{color:var(--g);font-weight:600}
.key-confirm-btn{width:100%;padding:11px;background:linear-gradient(135deg,#029e48,var(--g));border:none;border-radius:10px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;font-family:inherit;transition:all .2s;opacity:.4;letter-spacing:.2px}
.key-confirm-btn.ready{opacity:1;box-shadow:0 4px 16px var(--g-glow)}
.key-confirm-btn.ready:hover{transform:translateY(-1px);box-shadow:0 8px 24px var(--g-glow)}
.key-confirm-btn:disabled{cursor:not-allowed}
.key-skip-btn{width:100%;padding:7px;background:none;border:none;color:var(--text3);font-size:11px;cursor:pointer;margin-top:6px;font-family:inherit;transition:color .15s}
.key-skip-btn:hover{color:var(--text2)}

/* 분석 모달 */
.analysis-modal-inner{background:linear-gradient(160deg,#080f1c,#0d1c30);border:1px solid var(--border2);border-radius:18px;max-width:640px;width:100%;max-height:88vh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,.6),var(--shadow-g)}
.analysis-modal-head{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:linear-gradient(135deg,rgba(3,199,90,.05),transparent)}
.analysis-modal-body{padding:20px 24px;overflow-y:auto;flex:1}
.analysis-modal-body::-webkit-scrollbar{width:4px}
.analysis-modal-body::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:2px}
.analysis-section{margin-bottom:22px;padding-bottom:22px;border-bottom:1px solid var(--border);animation:secFadeIn .4s ease both}
@keyframes secFadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.analysis-section:last-child{border-bottom:none}
.analysis-section-title{
  font-size:14px;font-weight:900;color:#fff;letter-spacing:-.3px;
  margin-bottom:10px;display:flex;align-items:center;gap:8px;
  padding-bottom:8px;border-bottom:1px solid rgba(3,199,90,.15);
}
.analysis-section-title::before{content:'';width:3px;height:16px;background:var(--g);border-radius:2px;flex-shrink:0;box-shadow:0 0 8px var(--g-glow)}
.analysis-section-content{font-size:13px;color:rgba(232,240,254,.78);line-height:1.85}
/* 분석 내용 내 강조 키워드 */
.analysis-section-content .hl{color:var(--g);font-weight:700}
.analysis-section-content .hl-b{color:var(--b2);font-weight:700}
.analysis-section-content .hl-w{color:#fff;font-weight:700}
.analysis-loading{color:var(--text3);font-size:12px;display:flex;align-items:center;gap:10px;padding:8px 0}

/* ══ 헤더 ══ */
.site-header{
  position:sticky;top:0;z-index:100;height:var(--hh);
  background:rgba(6,13,23,.85);backdrop-filter:blur(20px) saturate(180%);
  border-bottom:1px solid var(--border);
  padding:0 20px;display:flex;align-items:center;justify-content:space-between;
}
.header-left{display:flex;align-items:center;gap:10px}
.h-logo{
  width:28px;height:28px;border-radius:8px;
  background:linear-gradient(135deg,#029e48,var(--g));
  display:flex;align-items:center;justify-content:center;
  font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:15px;font-weight:900;color:#fff;
  box-shadow:0 2px 10px var(--g-glow);
}
.h-title{font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:15px;font-weight:700;color:var(--text);letter-spacing:-.3px}
.h-version{font-size:11px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:4px;padding:2px 7px;font-weight:700;letter-spacing:.3px}
.header-right{display:flex;align-items:center;gap:12px}
.h-clock{display:flex;flex-direction:column;align-items:flex-end;line-height:1.2}
.h-clock-time{font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:16px;font-weight:700;letter-spacing:2px;color:var(--g);font-variant-numeric:tabular-nums;filter:drop-shadow(0 0 8px var(--g-glow))}
.h-clock-date{font-size:9px;color:var(--text3);letter-spacing:.3px}
.h-div{width:1px;height:24px;background:var(--border)}
.api-status{display:flex;align-items:center;gap:5px;font-size:13px;color:var(--text3)}
.s-dot{width:7px;height:7px;border-radius:50%;background:var(--g);box-shadow:0 0 8px var(--g-glow);animation:pulse 2s ease infinite}
.s-dot.off{background:var(--text3);box-shadow:none;animation:none}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 8px var(--g-glow)}50%{opacity:.6;box-shadow:0 0 4px var(--g-glow)}}
.h-btn{background:var(--glass);border:1px solid var(--border);color:var(--text2);border-radius:7px;padding:5px 12px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s}
.h-btn:hover{background:var(--glass2);border-color:var(--border2);color:var(--text)}

/* ══ 히어로 ══ */
.hero{
  position:relative;z-index:2;text-align:center;padding:10px 20px 8px;overflow:hidden;
}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:6px;
  font-size:11px;font-weight:700;letter-spacing:2px;color:var(--g);text-transform:uppercase;
  background:var(--g-dim);border:1px solid rgba(3,199,90,.2);border-radius:20px;
  padding:3px 12px;margin-bottom:8px;
  animation:fadeSlideUp .6s ease .1s both;
}
.hero h1{
  font-family:'Pretendard Variable','Pretendard',-apple-system,'Apple SD Gothic Neo','Malgun Gothic',sans-serif;font-size:22px;font-weight:900;
  color:#fff;line-height:1.3;margin-bottom:5px;letter-spacing:-0.8px;
  max-width:100%;
  animation:fadeSlideUp .6s ease .2s both;
}
.hero h1 em{
  color:var(--g);font-style:normal;
  text-shadow:0 0 30px var(--g-glow);
}
.hero-sub{
  font-size:12px;color:var(--text3);margin-bottom:0;line-height:1.5;
  animation:fadeSlideUp .6s ease .3s both;
}
.hero-sub strong{color:var(--text2)}






@keyframes fadeSlideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}

/* ══ API 배너 ══ */
#apiKeyBanner{
  display:none;background:rgba(245,158,11,.08);border-bottom:1px solid rgba(245,158,11,.2);
  padding:6px 20px;align-items:center;justify-content:center;gap:10px;
  font-size:11px;color:var(--amber);position:relative;z-index:2;
}

/* ══ 메인 ══ */
.app-main{max-width:1200px;margin:0 auto;padding:0 16px 40px;position:relative;z-index:2}

/* ══ 입력 패널 (sticky) ══ */
.sticky-panel{
  position:relative;
  margin-bottom:14px;
}
.input-card{
  background:linear-gradient(160deg,rgba(9,19,32,.96),rgba(13,26,45,.96));
  backdrop-filter:blur(20px) saturate(150%);
  border:1px solid var(--border2);border-radius:var(--r);
  box-shadow:0 8px 40px rgba(0,0,0,.5),0 0 0 1px rgba(3,199,90,.04);
  overflow:hidden;
}

/* 진행 바 */
.pbar-strip{
  background:rgba(0,0,0,.25);border-bottom:1px solid var(--border);
  padding:8px 20px;display:flex;align-items:center;gap:16px;
}
.pbar-track{height:2px;background:rgba(255,255,255,.07);border-radius:1px;flex:1;overflow:hidden}
.pbar-fill{height:100%;background:linear-gradient(90deg,var(--g),var(--b2));width:0%;transition:width .7s cubic-bezier(.4,0,.2,1);border-radius:1px;box-shadow:0 0 8px var(--g-glow)}
.pbar-steps{display:flex;gap:20px;align-items:center;flex-shrink:0}
.pbar-step{display:flex;align-items:center;gap:5px}
.pstep-dot{
  width:20px;height:20px;border-radius:50%;
  background:rgba(255,255,255,.05);border:1.5px solid rgba(255,255,255,.12);
  display:flex;align-items:center;justify-content:center;
  transition:all .4s cubic-bezier(.34,1.56,.64,1);flex-shrink:0;position:relative;
}
.pstep-num{font-size:10px;font-weight:800;color:var(--text3);transition:opacity .2s}
.pstep-check{width:8px;height:8px;position:absolute;opacity:0;transition:opacity .2s}
.pstep-lbl{font-size:12px;color:var(--text3);font-weight:500;white-space:nowrap;transition:color .3s}
.pbar-step.active .pstep-dot{background:rgba(3,199,90,.15);border-color:var(--g);animation:pDot 1.5s ease infinite}
.pbar-step.active .pstep-num{color:var(--g)}
.pbar-step.active .pstep-lbl{color:#fff;font-weight:700}
.pbar-step.done .pstep-dot{background:var(--g);border-color:var(--g);animation:pDone .4s cubic-bezier(.34,1.56,.64,1)}
.pbar-step.done .pstep-num{opacity:0}
.pbar-step.done .pstep-check{opacity:1}
.pbar-step.done .pstep-lbl{color:var(--g);font-weight:600}
@keyframes pDot{0%,100%{box-shadow:0 0 0 0 rgba(3,199,90,.4)}50%{box-shadow:0 0 0 5px rgba(3,199,90,0)}}
@keyframes pDone{0%{transform:scale(.5)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
.pbar-msg{font-size:12px;color:var(--text3);min-width:130px;text-align:right;transition:all .3s}

/* 컬럼 라벨 바 */
.col-labels{
  display:grid;grid-template-columns:1fr 1fr 1fr 1fr;
  border-bottom:1px solid var(--border);
}
.col-lbl{
  padding:6px 16px;font-size:13px;font-weight:700;
  color:var(--text3);letter-spacing:.6px;text-transform:uppercase;
  display:flex;align-items:center;gap:5px;
}
.col-lbl:not(:last-child){border-right:1px solid var(--border)}
.col-lbl-dot{width:5px;height:5px;border-radius:50%;background:var(--g);opacity:.5}

/* ══ 옵션B: 3컬럼+패널 2행 그리드 ══ */
.input-grid-b{
  display:grid;
  grid-template-columns:1fr 1fr 1fr 260px;
  grid-template-rows:auto auto;
  gap:8px;
  padding:8px 12px 0;
}
/* enhance-col도 input-col과 동일 카드 스타일 */
.input-grid-b .enhance-col{
  background:rgba(5,12,22,.7);
  border:1px solid rgba(255,255,255,.08);
  border-radius:10px;overflow:hidden;
  display:flex;flex-direction:column;
  transition:border-color .2s;
}
.input-grid-b .enhance-col:hover{border-color:rgba(255,255,255,.18)}
.input-grid-b .enhance-head{
  display:flex;align-items:center;gap:6px;
  padding:10px 12px 4px;
}
.input-grid-b .enhance-inner{
  padding:4px 12px 10px;
  display:flex;flex-direction:column;
  gap:6px;flex:1;
}
.left-input-section{
  display:flex;flex-direction:column;gap:8px;min-width:0;
}
/* 입력 그리드 */
.input-grid{
  display:grid;
  grid-template-columns:1fr 1fr 1fr 1fr;
  gap:8px;
}
.input-col{
  padding:0;display:flex;flex-direction:column;
  border:1px solid rgba(255,255,255,.08);
  border-radius:10px;
  background:rgba(5,12,22,.7);
  overflow:hidden;
  transition:border-color .2s;
}
.input-col:hover{border-color:rgba(255,255,255,.18)}
/* 컬럼 상단 컬러 라인 */
.input-col:nth-child(1){border-top:2px solid rgba(3,199,90,.55)}
.input-col:nth-child(2){border-top:2px solid rgba(51,133,255,.55)}
.input-col:nth-child(3){border-top:2px solid rgba(180,60,255,.55)}
.input-col:nth-child(4){border-top:2px solid rgba(255,150,0,.55)}
/* icol-head 패딩 */
.input-col > .icol-head{padding:10px 12px 0}
.icol-inner{padding:8px 12px;display:flex;flex-direction:column;gap:6px;flex:1}

/* 05 분석 패널 tall */
.analysis-panel-tall{
  border-top:2px solid rgba(255,150,0,.6) !important;
  display:flex;flex-direction:column;
  min-height:100%;
}
.analysis-panel-tall > .icol-head{padding:10px 12px 0}
.analysis-panel-tall > .analysis-status{padding:3px 12px}
.analysis-panel-tall > #analysisProgress{padding:4px 12px 0}
.analysis-panel-tall > .analysis-preview{padding:6px 12px;flex:1;overflow-y:auto}
.analysis-panel-tall > .analysis-btn{margin:auto 12px 10px;width:calc(100% - 24px)}

/* Gemini 심사숙고 박스 */
.ap-thinking-box{
  display:flex;align-items:center;gap:8px;
  padding:8px 12px;
  background:linear-gradient(135deg,rgba(3,199,90,.08),rgba(0,102,255,.06));
  border:1px solid rgba(3,199,90,.2);border-radius:8px;
  margin-bottom:6px;
}
.ap-thinking-icon{
  font-size:16px;color:var(--g);
  animation:thinkSpin 3s linear infinite;
}
@keyframes thinkSpin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
.ap-thinking-text{font-size:12px;color:var(--g);font-weight:600;flex:1}
.ap-thinking-dots{display:flex;gap:4px;align-items:center;padding-left:4px}
.ap-thinking-dots span{
  width:5px;height:5px;border-radius:50%;
  background:var(--g);
  animation:thinkDot 1.4s ease infinite;
}
.ap-thinking-dots span:nth-child(1){animation-delay:0s}
.ap-thinking-dots span:nth-child(2){animation-delay:.2s}
.ap-thinking-dots span:nth-child(3){animation-delay:.4s}
.ap-thinking-dots span:nth-child(4){animation-delay:.6s}
.ap-thinking-dots span:nth-child(5){animation-delay:.8s}
@keyframes thinkDot{0%,80%,100%{opacity:.2;transform:scale(.7)}40%{opacity:1;transform:scale(1)}}

/* 타이핑 커서 */
.analysis-typing-cursor{
  display:inline-block;width:2px;height:1em;
  background:var(--g);margin-left:2px;vertical-align:middle;
  animation:cursorBlink .7s step-end infinite;
}
@keyframes cursorBlink{0%,100%{opacity:1}50%{opacity:0}}

/* 폼 요소 */
.lbl{font-size:13px;font-weight:700;color:var(--text2);display:flex;align-items:center;gap:4px;margin-bottom:2px}
.req{color:var(--g);font-size:9px}
.lbl-desc{font-size:11px;color:var(--text3);margin-bottom:5px}
.inp{
  width:100%;padding:6px 10px;
  background:rgba(0,0,0,.3);border:1.5px solid var(--border);
  border-radius:var(--r2);font-size:13px;font-family:inherit;color:var(--text);outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.inp:focus{border-color:rgba(3,199,90,.45);box-shadow:0 0 0 3px rgba(3,199,90,.07);background:rgba(0,0,0,.4)}
.inp::placeholder{color:var(--text3)}
textarea.inp{resize:none;line-height:1.5;font-size:13px}

/* feat slots */
.feat-slot{display:flex;align-items:center;gap:5px;background:rgba(0,0,0,.2);border:1px solid var(--border);border-radius:5px;padding:4px 8px;margin-bottom:3px;transition:border-color .15s}
.feat-slot:focus-within{border-color:rgba(3,199,90,.3)}
.feat-slot-num{font-size:10px;font-weight:700;color:var(--g);width:14px;flex-shrink:0}
.feat-slot input{flex:1;background:none;border:none;outline:none;font-size:12px;color:var(--text);font-family:inherit}
.feat-slot input::placeholder{color:var(--text3);font-size:11px}
.feat-slot-del{background:none;border:none;color:var(--text3);cursor:pointer;font-size:11px;padding:0 2px;transition:color .15s}
.feat-slot-del:hover{color:var(--red)}
.feat-add-btn{background:none;border:1px dashed rgba(255,255,255,.12);color:var(--text3);border-radius:5px;padding:3px 0;font-size:10px;cursor:pointer;font-family:inherit;width:100%;transition:all .2s;margin-top:2px}
.feat-add-btn:hover{border-color:rgba(3,199,90,.4);color:var(--g);background:var(--g-dim)}
.feat-suggest{display:flex;flex-wrap:wrap;gap:3px;margin-bottom:5px}
.feat-chip{font-size:9px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:4px;padding:2px 6px;cursor:pointer;transition:all .15s}
.feat-chip:hover{background:rgba(3,199,90,.2)}
.feat-chip.used{background:var(--glass);border-color:var(--border);color:var(--text3);cursor:default}
.feat-suggest-lbl{font-size:9px;color:var(--text3);margin-bottom:3px}

/* 이미지 업로드 */
.upload-zone{
  border:1.5px dashed rgba(255,255,255,.12);border-radius:var(--r2);
  padding:8px;text-align:center;cursor:pointer;transition:all .2s;
  position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;
  background:rgba(0,0,0,.2);min-height:56px;
}
.upload-zone:hover{border-color:rgba(3,199,90,.4);background:var(--g-dim)}
.upload-zone.filled{border-color:rgba(3,199,90,.3);background:rgba(3,199,90,.04)}
.upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%}
.upl-icon{font-size:16px;filter:drop-shadow(0 0 6px var(--g-glow))}
.upl-text{font-size:9px;color:var(--text3)}
.upl-count{font-size:9px;color:var(--g);font-weight:700}
.img-grid{display:flex;flex-wrap:wrap;gap:4px;margin-top:5px}
.img-thumb{position:relative;width:44px;height:44px;flex-shrink:0;border-radius:5px;overflow:hidden;border:1.5px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,.3);transition:transform .15s}
.img-thumb:hover{transform:scale(1.05)}
.img-thumb img{width:100%;height:100%;object-fit:cover;display:block}
.del-btn{position:absolute;top:2px;right:2px;width:14px;height:14px;border-radius:50%;background:rgba(229,62,62,.9);color:#fff;font-size:8px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700;transition:background .15s}
.del-btn:hover{background:var(--red)}
.img-num{position:absolute;bottom:2px;left:3px;font-size:7px;font-weight:700;color:#fff;background:rgba(0,0,0,.5);border-radius:2px;padding:0 3px;line-height:14px}

/* 분석 컬럼 */
.col-analysis{background:linear-gradient(160deg,rgba(3,199,90,.04),rgba(0,102,255,.03))}


.analysis-status{font-size:11px;color:var(--text3);padding:3px 10px;background:rgba(0,0,0,.2);border-radius:4px;border:1px solid var(--border);display:inline-block;margin:4px 16px 6px;transition:all .3s}
.analysis-status.running{color:var(--g);background:rgba(3,199,90,.08);border-color:rgba(3,199,90,.25);animation:statusPulse 2s ease infinite}
@keyframes statusPulse{0%,100%{opacity:1}50%{opacity:.7}}
.analysis-preview{
  font-size:13px;color:var(--text2);line-height:1.8;
  overflow-y:auto;max-height:140px;
  margin-bottom:8px;min-height:60px;
}
.analysis-preview::-webkit-scrollbar{width:3px}
.analysis-preview::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:2px}
.analysis-btn{
  background:linear-gradient(135deg,var(--g-dim),rgba(0,102,255,.08));
  border:1px solid rgba(3,199,90,.25);color:var(--g);border-radius:6px;
  padding:8px 12px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;
  width:100%;transition:all .2s;
}
.analysis-btn:hover{background:rgba(3,199,90,.15);box-shadow:0 0 12px rgba(3,199,90,.15)}
.analysis-btn:disabled{background:var(--glass);border-color:var(--border);color:var(--text3);cursor:not-allowed;box-shadow:none}
.analysis-btn.done{animation:analysisGlow 1.5s ease 3;border-color:rgba(3,199,90,.6);background:rgba(3,199,90,.15)}
@keyframes analysisGlow{0%,100%{box-shadow:0 0 0 0 rgba(3,199,90,.4)}50%{box-shadow:0 0 0 6px rgba(3,199,90,0),0 0 20px rgba(3,199,90,.4)}}

/* 푸터 행 (생성 버튼) */
.input-footer{
  padding:10px 16px 14px;display:flex;align-items:center;gap:12px;
  background:rgba(0,0,0,.15);
}
.gen-btn{
  padding:13px 32px;
  background:linear-gradient(135deg,#029e48,var(--g));
  border:none;border-radius:var(--r2);
  font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:15px;font-weight:800;color:#fff;
  cursor:pointer;letter-spacing:.3px;transition:all .2s;
  box-shadow:0 4px 16px var(--g-glow);white-space:nowrap;
  position:relative;overflow:hidden;
}
.gen-btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,transparent,rgba(255,255,255,.15),transparent);
  transform:translateX(-100%);transition:transform .4s ease;
}
.gen-btn:hover::before{transform:translateX(100%)}
.gen-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px var(--g-glow)}
.gen-btn:active{transform:translateY(0)}
.gen-btn:disabled{background:rgba(255,255,255,.06);box-shadow:none;cursor:not-allowed;color:var(--text3)}
.gen-btn:disabled::before{display:none}
.gen-btn:disabled .spin{display:none}
.footer-info{font-size:12px;color:var(--text3);flex:1}

/* ══ 섹션 헤더 ══ */
.section-header{
  display:flex;align-items:center;gap:10px;
  padding:14px 0 10px;
}
.section-label{
  font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:16px;font-weight:800;
  color:#fff;letter-spacing:.3px;
  display:flex;align-items:center;gap:8px;
}
.section-label::before{content:'';width:4px;height:18px;background:var(--g);border-radius:2px;box-shadow:0 0 10px var(--g-glow)}
.section-div{flex:1;height:1px;background:var(--border)}

/* ══ 광고 미리보기 ══ */
.preview-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
/* 미리보기 + 소재 모니터 컨테이너 */
#previewMonitorWrap{
  position:relative;
  z-index:10;
  background:var(--bg);
  padding-bottom:6px;
}

/* ── 각 섹션 독립 sticky ── */
#previewSection{
  background:var(--bg);
  position:relative;
  z-index:12;
  transition:box-shadow .2s;
}
#previewSection.pinned{
  position:sticky;
  top:calc(var(--hh) + 6px);
  box-shadow:0 6px 24px rgba(0,0,0,.5);
}
#monitorSection{
  background:var(--bg);
  position:relative;
  z-index:11;
  transition:box-shadow .2s;
}
#monitorSection.pinned{
  position:sticky;
  box-shadow:0 6px 24px rgba(0,0,0,.45);
  /* top은 JS에서 동적 계산 */
}
#previewMonitorWrap::-webkit-scrollbar{width:3px}
#previewMonitorWrap::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:2px}
#previewSection{background:transparent}
.pv-card{
  background:var(--glass);backdrop-filter:blur(12px);
  border:1px solid var(--border);border-radius:var(--r);
  overflow:hidden;transition:border-color .2s,box-shadow .2s;
}
.pv-card:hover{border-color:var(--border2);box-shadow:0 4px 24px rgba(0,0,0,.3)}
.pv-head{padding:4px 10px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:6px;background:rgba(0,0,0,.15)}
.pv-head h4{font-size:11px;font-weight:700;color:var(--text2);flex:1}
.pv-live{font-size:11px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:3px;padding:1px 5px;font-weight:700;animation:blink 2s ease infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.6}}
.pv-body{padding:3px 6px}

/* 네이버 PC 광고 — 45자 전체 표시, 줄바꿈 허용 */
.naver-ad{background:#fff;border:1px solid #e2e8f0;border-radius:6px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.07)}
.naver-ad-inner{padding:8px 10px}
.naver-ad-header{display:flex;align-items:center;gap:3px;margin-bottom:2px;flex-wrap:wrap}
.naver-ad-logo{width:12px;height:12px;border-radius:3px;background:#03C75A;display:flex;align-items:center;justify-content:center;font-size:6px;font-weight:900;color:#fff;flex-shrink:0}
.naver-ad-store{font-size:9px;color:#555;font-weight:500}
.naver-ad-url{font-size:9px;color:#777}
.naver-ad-badge{font-size:7px;color:#888;border:1px solid #ccc;border-radius:2px;padding:1px 3px;line-height:1.2;margin-left:2px}
.naver-ad-row{display:flex;gap:7px;align-items:flex-start}
.naver-ad-body{flex:1;min-width:0}
.naver-ad-title{font-size:12px;font-weight:700;color:#1a73e8;line-height:1.4;margin-bottom:2px;word-break:keep-all;white-space:normal;overflow:visible}
.naver-ad-title.empty{color:#ccc;font-weight:400;font-size:10px}
.naver-ad-desc{font-size:10px;color:#444;line-height:1.5;word-break:keep-all;white-space:normal;overflow:visible}
.naver-ad-desc.empty{color:#ccc;font-size:9px}
.naver-ad-thumb{width:36px;height:36px;border-radius:4px;background:#f8f8f8;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;overflow:hidden;border:1px solid #eee}
.naver-ad-thumb img{width:100%;height:100%;object-fit:cover}
.naver-ad-chips{display:flex;flex-wrap:wrap;gap:3px;margin-top:3px}
.naver-ad-chip{background:#f3f3f3;border:1px solid #e5e5e5;border-radius:2px;padding:1px 4px;font-size:8px;color:#555}

/* 네이버 모바일 — 45자 전체 표시 */
.naver-mob-ad{background:#fff;border:1px solid #e2e8f0;border-radius:6px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.07)}
.naver-mob-ad-inner{padding:8px 10px}
.naver-mob-meta{display:flex;align-items:center;gap:3px;margin-bottom:4px;flex-wrap:wrap}
.naver-mob-logo{width:13px;height:13px;border-radius:50%;background:#03C75A;display:flex;align-items:center;justify-content:center;font-size:6px;font-weight:900;color:#fff;flex-shrink:0}
.naver-mob-store{font-size:9px;color:#555;font-weight:500}
.naver-mob-url{font-size:9px;color:#888}
.naver-mob-badge{font-size:7px;color:#888;border:1px solid #ccc;border-radius:2px;padding:1px 3px;line-height:1.2;margin-left:2px}
.naver-mob-row{display:flex;gap:7px;align-items:flex-start;margin-bottom:4px}
.naver-mob-body{flex:1;min-width:0}
.naver-mob-title{font-size:12px;font-weight:700;color:#1a73e8;line-height:1.4;margin-bottom:2px;word-break:keep-all;white-space:normal;overflow:visible}
.naver-mob-title.empty{color:#ccc;font-weight:400;font-size:10px}
.naver-mob-desc{font-size:10px;color:#444;line-height:1.5;word-break:keep-all;white-space:normal;overflow:visible}
.naver-mob-desc.empty{color:#ccc;font-size:10px}
.naver-mob-thumb{width:44px;height:44px;border-radius:5px;background:#f8f8f8;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;overflow:hidden;border:1px solid #eee}
.naver-mob-thumb img{width:100%;height:100%;object-fit:cover}
/*chips removed*/
/*chips removed*/
/*chips removed*/
.pv-note{font-size:8px;color:var(--text3);margin-top:3px;text-align:center}

/* ══ 결과 카드 ══ */
.result-wrap{margin-bottom:14px}
.result-card{
  background:var(--glass);backdrop-filter:blur(12px);
  border:1px solid var(--border);border-radius:var(--r);overflow:hidden;
}
.result-tabs{display:flex;border-bottom:1px solid var(--border);background:rgba(0,0,0,.2)}
.rtab{
  flex:1;padding:11px 0;font-size:14px;font-weight:700;color:var(--text3);
  border:none;background:none;cursor:pointer;
  border-bottom:2px solid transparent;transition:all .2s;font-family:inherit;
  display:flex;align-items:center;justify-content:center;gap:6px;
}
.rtab.active{color:var(--text);border-bottom-color:var(--g)}
.rpane{display:none}
.rpane.active{display:block}

/* 아이템 */
.sec-bar{
  display:flex;align-items:center;gap:6px;padding:6px 12px;
  border-bottom:1px solid var(--border);background:rgba(0,0,0,.15);
  position:sticky;top:0;z-index:1;
}
.sec-title{font-size:13px;font-weight:700;color:var(--text2);display:flex;align-items:center;gap:5px;flex:1}
.badge{font-size:11px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:3px;padding:1px 6px;font-weight:700}
.badge.sel{background:rgba(0,102,255,.1);color:var(--b2);border-color:rgba(0,102,255,.2)}
.item{display:flex;align-items:center;gap:8px;padding:9px 14px;border-bottom:1px solid var(--border);transition:background .15s;cursor:pointer;flex-wrap:wrap}
.item:hover{background:rgba(255,255,255,.03)}
.item.on{
  background:linear-gradient(90deg,rgba(3,199,90,.12),rgba(3,199,90,.03));
  border-left:3px solid var(--g);
  padding-left:11px;
}
.item.on .txt{color:#4ddb8f;font-weight:600}
.plus{
  width:22px;height:22px;border-radius:50%;
  border:1.5px solid var(--border);background:none;color:var(--text3);
  font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .2s;flex-shrink:0;
}
.plus:hover{border-color:var(--g);color:var(--g);background:var(--g-dim)}
.item.on .plus{background:var(--g);border-color:var(--g);color:#fff}
.txt-wrap{flex:1;min-width:0}
.txt{font-size:15px;color:var(--text);line-height:1.4;outline:none}
.txt:focus{outline:1px solid rgba(3,199,90,.4);border-radius:2px;padding:1px 2px}
.meta{display:flex;align-items:center;gap:5px;margin-top:2px}
.cc{font-size:11px;color:var(--text3)}
.cc.over{color:var(--red);font-weight:700}
.badge-tag{font-size:11px;background:var(--g-dim);color:var(--g);border-radius:2px;padding:1px 5px;font-weight:700}
.pin-sel{
  background:rgba(0,0,0,.2);border:1px solid var(--border);color:var(--text2);
  border-radius:4px;padding:3px 8px;font-size:11px;cursor:pointer;font-family:inherit;
  flex-shrink:0;transition:border-color .15s;
}
.pin-sel:focus{outline:none;border-color:rgba(3,199,90,.4)}
.pin-sel.pinned{border-color:rgba(0,102,255,.4);color:var(--b2);background:rgba(0,102,255,.06)}

/* 빈 상태 */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:10px}
.empty-icon{font-size:32px;opacity:.2;filter:grayscale(1)}
.empty-txt{text-align:center;font-size:15px;color:var(--text3);line-height:1.8}
.empty-txt strong{color:var(--text2)}

/* ── 현황판 */
.status-board{background:var(--glass);border:1px solid var(--border);border-radius:var(--r);padding:14px 16px;display:flex;flex-direction:column;gap:10px}
.sb-row-select{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.sb-sel-box{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:12px;position:relative;overflow:hidden}
.sb-sel-box::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:2px 0 0 2px}
.sb-title::before{background:#a855f7}
.sb-desc::before{background:#f59e0b}
.sb-sel-icon{font-size:20px;flex-shrink:0;opacity:.7}
.sb-sel-info{flex:1;min-width:0}
.sb-sel-label{font-size:9px;color:rgba(255,255,255,.35);letter-spacing:.4px;text-transform:uppercase;margin-bottom:2px}
.sb-sel-count{display:flex;align-items:baseline;gap:4px}
.sb-sel-num{font-size:26px;font-weight:900;line-height:1}
.sb-title .sb-sel-num{color:#a855f7}
.sb-desc  .sb-sel-num{color:#f59e0b}
.sb-sel-max{font-size:11px;color:rgba(255,255,255,.25)}
.sb-bar{height:3px;background:rgba(255,255,255,.07);border-radius:2px;margin-top:6px;overflow:hidden}
.sb-bar-fill{height:100%;border-radius:2px;transition:width .4s cubic-bezier(.4,0,.2,1)}
.sb-title-fill{background:linear-gradient(90deg,#a855f7,#c084fc)}
.sb-desc-fill{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
.sb-divider{height:1px;background:rgba(255,255,255,.06)}
.sb-row-pin{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.sb-pin-box{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:8px;padding:8px 12px;display:flex;flex-direction:column;gap:2px;position:relative;overflow:hidden;transition:background .2s,border-color .2s}
.sb-pin-box::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;border-radius:0 0 8px 8px}
.sb-t1::after{background:#03C75A}.sb-t2::after{background:#3385ff}.sb-t3::after{background:#ff9800}
.sb-d1::after{background:#84cc16}.sb-d2::after{background:#06b6d4}
.sb-pin-label{font-size:9px;color:rgba(255,255,255,.3);letter-spacing:.3px}
.sb-pin-num{font-size:22px;font-weight:900;line-height:1.1;color:rgba(255,255,255,.15);transition:color .2s}
.sb-pin-box.active .sb-pin-num{color:var(--pin-color)}
.sb-t1{--pin-color:#03C75A}.sb-t2{--pin-color:#3385ff}.sb-t3{--pin-color:#ff9800}
.sb-d1{--pin-color:#84cc16}.sb-d2{--pin-color:#06b6d4}
.sb-pin-box.active{border-color:rgba(255,255,255,.12)}
.sb-pin-box.active.sb-t1{background:rgba(3,199,90,.05)}
.sb-pin-box.active.sb-t2{background:rgba(51,133,255,.05)}
.sb-pin-box.active.sb-t3{background:rgba(255,152,0,.05)}
.sb-pin-box.active.sb-d1{background:rgba(132,204,22,.05)}
.sb-pin-box.active.sb-d2{background:rgba(6,182,212,.05)}
.sb-pin-sub{font-size:9px;color:rgba(255,255,255,.2)}
.sb-lists{display:grid;grid-template-columns:1fr 1fr;gap:16px}

/* ── compact 소재 모니터 (sticky 내부) ── */
.sb-compact-row{
  display:flex;align-items:center;gap:6px;flex-wrap:nowrap;
  background:var(--glass);border:1px solid var(--border);
  border-radius:var(--r);padding:7px 12px;overflow-x:auto;
}
.sb-c-sel{
  display:flex;align-items:center;gap:4px;
  background:rgba(255,255,255,.04);border-radius:6px;
  padding:5px 10px;flex-shrink:0;position:relative;min-width:70px;
}
.sb-c-icon{font-size:14px;line-height:1}
.sb-c-num{font-size:18px;font-weight:900;line-height:1}
.sb-c-title .sb-c-num{color:#a855f7}
.sb-c-desc  .sb-c-num{color:#f59e0b}
.sb-c-label{font-size:10px;color:rgba(255,255,255,.3)}
.sb-c-bar{position:absolute;bottom:0;left:0;right:0;height:2px;background:rgba(255,255,255,.07);border-radius:0 0 6px 6px;overflow:hidden}
.sb-c-fill{height:100%;border-radius:2px;transition:width .4s}
.sb-c-fill-t{background:linear-gradient(90deg,#a855f7,#c084fc)}
.sb-c-fill-d{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
.sb-c-pin{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:1px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);
  border-radius:6px;padding:5px 8px;flex-shrink:0;min-width:52px;
  position:relative;overflow:hidden;transition:background .2s,border-color .2s;
}
.sb-c-pin::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;border-radius:0 0 6px 6px}
.sb-c-t1::after{background:#03C75A}.sb-c-t2::after{background:#3385ff}.sb-c-t3::after{background:#ff9800}
.sb-c-d1::after{background:#84cc16}.sb-c-d2::after{background:#06b6d4}
.sb-c-pin-num{font-size:16px;font-weight:900;color:rgba(255,255,255,.15);transition:color .2s;line-height:1}
.sb-c-pin.active .sb-c-pin-num{color:var(--pin-color)}
.sb-c-t1{--pin-color:#03C75A}.sb-c-t2{--pin-color:#3385ff}.sb-c-t3{--pin-color:#ff9800}
.sb-c-d1{--pin-color:#84cc16}.sb-c-d2{--pin-color:#06b6d4}
.sb-c-pin.active{border-color:rgba(255,255,255,.12)}
.sb-c-pin.active.sb-c-t1{background:rgba(3,199,90,.08)}
.sb-c-pin.active.sb-c-t2{background:rgba(51,133,255,.08)}
.sb-c-pin.active.sb-c-t3{background:rgba(255,152,0,.08)}
.sb-c-pin.active.sb-c-d1{background:rgba(132,204,22,.08)}
.sb-c-pin.active.sb-c-d2{background:rgba(6,182,212,.08)}
.sb-c-pin-lbl{font-size:8px;color:rgba(255,255,255,.3);letter-spacing:.2px}
.sb-c-pin-sub{font-size:8px;color:rgba(255,255,255,.15);max-width:50px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.sb-c-list{
  flex:1;min-width:100px;max-height:38px;overflow-y:auto;
  background:rgba(0,0,0,.2);border-radius:5px;padding:3px 6px;
  font-size:10px;color:var(--text2);line-height:1.6;
  border:1px solid rgba(255,255,255,.04);
}
.sb-c-list::-webkit-scrollbar{width:2px}
.sb-c-list::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:2px}
.sb-list-col{}
.sb-list-head{font-size:11px;font-weight:700;color:var(--text3);display:flex;justify-content:space-between;margin-bottom:5px;text-transform:uppercase;letter-spacing:.4px}
.sel-card{
  background:var(--glass);backdrop-filter:blur(12px);
  border:1px solid var(--border);border-radius:var(--r);padding:12px 16px;
}
.sel-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.sel-head{font-size:12px;font-weight:700;color:var(--text3);display:flex;justify-content:space-between;margin-bottom:5px;text-transform:uppercase;letter-spacing:.4px}
.sel-cnt{color:var(--g);font-weight:700}
.sel-item{font-size:13px;color:var(--text2);background:rgba(0,0,0,.2);border-radius:4px;padding:4px 8px;margin-bottom:3px;display:flex;align-items:center;gap:4px;border:1px solid var(--border)}
.sel-empty{font-size:10px;color:var(--text3)}
.sel-copy{background:none;border:none;cursor:pointer;font-size:11px;padding:0 3px;opacity:.4;transition:opacity .15s;flex-shrink:0}
.sel-copy:hover{opacity:1}
.sel-copy.copied{opacity:1}
.sel-x{background:none;border:none;cursor:pointer;color:var(--text3);font-size:11px;margin-left:auto;padding:0 2px;flex-shrink:0;transition:color .15s}
.sel-x:hover{color:var(--red)}

/* ══ 스피너 ══ */
.spin,.spin-sm{display:inline-block;border-radius:50%;border:2px solid rgba(255,255,255,.1);border-top-color:var(--g);animation:spin .6s linear infinite}
.spin{width:14px;height:14px}
.spin-sm{width:10px;height:10px;border-width:1.5px}
@keyframes spin{to{transform:rotate(360deg)}}

/* 기타 */
.notice{font-size:11px;border-radius:6px;padding:7px 11px;margin:4px 0}
.n-error{background:rgba(255,77,109,.08);color:var(--red);border:1px solid rgba(255,77,109,.2)}
.n-warn{background:rgba(245,158,11,.08);color:var(--amber);border:1px solid rgba(245,158,11,.2)}
.n-info{background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2)}
.kw-chip{font-size:9px;background:var(--glass);border:1px solid var(--border);border-radius:3px;padding:2px 6px;cursor:pointer;color:var(--text3);transition:all .15s}
.kw-chip:hover{background:var(--g-dim);border-color:rgba(3,199,90,.3);color:var(--g)}
.divider{height:1px;background:var(--border);margin:4px 0}
.ripple-btn{position:relative;overflow:hidden}

/* ══ 5칸 결과 레이아웃 ══ */
.result-5col{display:grid;grid-template-columns:1.6fr 1fr 1fr 1fr 1.4fr;height:100%;min-height:320px}
.r5-col{display:flex;flex-direction:column;overflow:hidden;border-right:1px solid var(--border)}
.r5-col:last-child{border-right:none}
.r5-head{
  padding:8px 12px;border-bottom:1px solid var(--border);
  background:rgba(0,0,0,.2);flex-shrink:0;
  display:flex;align-items:center;gap:6px;min-height:36px;
}
.r5-title{font-size:14px;font-weight:800;color:var(--text2);flex:1;white-space:nowrap}
.r5-sub{font-size:11px;color:var(--text3)}
.r5-body{flex:1;overflow-y:auto;padding:4px 0;max-height:420px}
.r5-body::-webkit-scrollbar{width:3px}
.r5-body::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:2px}
/* 키워드 컬럼 버튼 */
.r5-kw .r5-body{padding:8px}
.r5-chips{display:flex;flex-direction:column;gap:4px}
.kw-btn{
  width:100%;text-align:left;padding:8px 12px;
  background:rgba(0,0,0,.2);border:1px solid var(--border);
  border-radius:5px;color:var(--text2);font-size:14px;
  cursor:pointer;font-family:inherit;transition:all .15s;
  display:block;white-space:normal;word-break:keep-all;line-height:1.4;
}
.kw-btn:hover{background:var(--g-dim);border-color:rgba(3,199,90,.3);color:var(--g)}
.kw-btn.kw-on{background:rgba(3,199,90,.1);border-color:rgba(3,199,90,.4);color:var(--g);font-weight:700}
.kw-btn.kw-on::before{content:'✓ ';font-size:11px}

/* 입력 컬럼 헤더 */
.icol-head{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px}
.icol-num{font-size:9px;font-weight:900;color:var(--g);background:var(--g-dim);border:1px solid rgba(3,199,90,.25);border-radius:4px;padding:2px 5px;flex-shrink:0;margin-top:1px;letter-spacing:.5px;min-width:22px;text-align:center}
/* 컬럼별 번호 뱃지 색상 */
.icol-num-1{color:var(--g);background:rgba(3,199,90,.12);border-color:rgba(3,199,90,.3)}
.icol-num-2{color:#3385ff;background:rgba(51,133,255,.12);border-color:rgba(51,133,255,.3)}
.icol-num-3{color:#b43cff;background:rgba(180,60,255,.12);border-color:rgba(180,60,255,.3)}
.icol-num-4{color:#ff9800;background:rgba(255,150,0,.12);border-color:rgba(255,150,0,.3)}
.icol-num-5{color:#ff9800;background:rgba(255,150,0,.12);border-color:rgba(255,150,0,.3)}
.icol-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:1px;line-height:1.3;word-break:keep-all}
.icol-desc{font-size:10px;color:var(--text3);line-height:1.35;word-break:keep-all}
.inp-ta{resize:none;line-height:1.5;min-height:72px;font-size:13px}


/* 분석 진행 표시 */
.ap-step-row{display:flex;align-items:center;gap:7px;padding:5px 0;font-size:12px;color:var(--text3);transition:color .3s}
.ap-step-row.active{color:var(--text)}
.ap-step-row.done{color:var(--g)}
.ap-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.15);flex-shrink:0;transition:all .3s}
.ap-step-row.active .ap-dot{background:var(--g);box-shadow:0 0 6px var(--g-glow);animation:apPulse .8s ease infinite}
.ap-step-row.done .ap-dot{background:var(--g)}
@keyframes apPulse{0%,100%{opacity:1}50%{opacity:.4}}
.ap-timer{font-size:10px;color:var(--text3);margin-top:4px;text-align:right}
.ap-timer b{color:var(--g)}

/* 분석 필드 행 - 실제 입력값 표시 */
.ap-field-row{
  display:flex;align-items:center;gap:6px;
  padding:4px 7px;border-radius:6px;margin-bottom:2px;
  border:1px solid transparent;transition:all .35s ease;
  background:rgba(255,255,255,.025);
}
.ap-field-row.pending{opacity:.45}
.ap-field-row.active{
  opacity:1;background:rgba(3,199,90,.08);
  border-color:rgba(3,199,90,.25);
  animation:apFieldPulse 1s ease infinite;
}
.ap-field-row.done{
  opacity:1;background:rgba(3,199,90,.04);
  border-color:rgba(3,199,90,.12);
}
.ap-field-row.skip{opacity:.3}
@keyframes apFieldPulse{0%,100%{border-color:rgba(3,199,90,.25)}50%{border-color:rgba(3,199,90,.5)}}
.ap-f-icon{font-size:13px;flex-shrink:0}
.ap-f-content{flex:1;min-width:0}
.ap-f-label{font-size:9px;font-weight:700;color:var(--text3);display:block;letter-spacing:.3px;text-transform:uppercase}
.ap-field-row.active .ap-f-label{color:var(--g)}
.ap-field-row.done .ap-f-label{color:rgba(3,199,90,.65)}
.ap-f-value{font-size:11px;color:var(--text3);display:block;line-height:1.4;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ap-field-row.active .ap-f-value{color:#fff;font-weight:600}
.ap-field-row.done .ap-f-value{color:var(--text2)}
.ap-f-status{font-size:12px;flex-shrink:0}


/* 모바일 광고 카드 - 네이버 실제처럼 */
.mob-ad-card{background:#fff;border:1px solid #e5e8ec;border-radius:8px;padding:12px 14px;margin-bottom:6px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.mob-ad-card--sub{background:#fafafa;border-color:#ebebeb}
.mob-ad-card--sub .naver-mob-title{font-size:14px}
.mob-ad-empty{background:#fff;border:1px solid #e5e8ec;border-radius:8px;padding:12px 14px}
#pvMobTitleList{max-height:120px;overflow-y:auto}
#pvMobTitleList::-webkit-scrollbar{width:3px}
#pvMobTitleList::-webkit-scrollbar-thumb{background:#e0e0e0;border-radius:2px}


/* ── 입력 강화 기능 ── */
.enhance-row{
  display:grid;grid-template-columns:1fr 1fr 1fr;
  gap:8px;
}
.enhance-col{
  padding:0;
  display:flex;flex-direction:column;
  background:rgba(5,12,22,.7);
  border:1px solid rgba(255,255,255,.08);
  border-radius:10px;overflow:hidden;
  transition:border-color .2s;
}
.enhance-col:hover{border-color:rgba(255,255,255,.15)}
.enhance-col:nth-child(1){border-top:2px solid rgba(255,77,109,.4)}
.enhance-col:nth-child(2){border-top:2px solid rgba(51,200,170,.4)}
.enhance-col:nth-child(3){border-top:2px solid rgba(150,100,255,.4)}
.enhance-inner{padding:8px 12px;display:flex;flex-direction:column;gap:6px;flex:1}
.enhance-head{
  display:flex;align-items:center;gap:6px;
  padding:8px 12px 4px;
}
.enhance-icon{font-size:14px;flex-shrink:0}
.enhance-title{font-size:12px;font-weight:700;color:var(--text);margin-bottom:1px}
.enhance-desc{font-size:10px;color:var(--text3);line-height:1.35;word-break:keep-all}

/* 금지어 */
.deny-list{display:flex;flex-wrap:wrap;gap:4px;min-height:10px}
.deny-tag{display:inline-flex;align-items:center;gap:4px;background:rgba(255,77,109,.08);border:1px solid rgba(255,77,109,.2);border-radius:5px;padding:4px 10px;font-size:13px;color:#ff6b85}
.deny-tag-x{background:none;border:none;color:rgba(255,77,109,.5);cursor:pointer;font-size:10px;padding:0;line-height:1;transition:color .15s}
.deny-tag-x:hover{color:#ff4d6d}
.deny-input-row{margin-top:2px}

/* 시즌 칩 */
.season-chips{display:flex;flex-wrap:wrap;gap:3px}
.schip{font-size:10px;padding:3px 8px;border-radius:12px;border:1px solid var(--border);color:var(--text3);cursor:pointer;background:none;font-family:inherit;transition:all .15s}
.schip:hover{border-color:rgba(3,199,90,.3);color:var(--g)}
.schip.on{background:var(--g-dim);border-color:rgba(3,199,90,.35);color:var(--g);font-weight:700}

/* 어조 */
.tone-grid{display:grid;grid-template-columns:1fr 1fr;gap:3px}
.tone-btn{padding:5px 6px;background:rgba(0,0,0,.2);border:1px solid var(--border);border-radius:5px;font-size:10px;color:var(--text3);cursor:pointer;font-family:inherit;transition:all .15s;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tone-btn:hover{border-color:rgba(3,199,90,.3);color:var(--g)}
.tone-btn.on{background:var(--g-dim);border-color:rgba(3,199,90,.35);color:var(--g);font-weight:700}


/* ── 결과 + 미리보기 통합 레이아웃 ── */
.result-layout{display:grid;grid-template-columns:1fr 340px;gap:12px;align-items:start}
.rl-left{background:var(--glass);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;min-height:200px}
.rl-right{display:flex;flex-direction:column;gap:10px;position:sticky;top:calc(var(--hh) + 12px);max-height:calc(100vh - var(--hh) - 24px);overflow-y:auto}
.rl-section-label{
  padding:9px 14px;background:rgba(0,0,0,.2);border-bottom:1px solid var(--border);
  font-size:13px;font-weight:800;color:var(--text2);display:flex;align-items:center;gap:8px;
}
.rl-divider{height:1px;background:var(--border);margin:4px 0}
/* 키워드 그리드: 가로 2열 배치 */
.kw-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px;padding:8px 10px}
/* 설명 목록 */
.desc-list{padding:4px 0}


/* ── 새로고침 버튼 */
.refresh-btn{background:var(--glass);border:1px solid var(--border);color:var(--text3);border-radius:6px;padding:6px 14px;font-size:13px;cursor:pointer;font-family:inherit;transition:all .2s;white-space:nowrap}
.refresh-btn:hover{border-color:rgba(3,199,90,.4);color:var(--g)}

/* ── 선택 제한 뱃지 */
.sel-limit-badge{font-size:10px;padding:2px 6px;background:rgba(255,170,0,.08);border:1px solid rgba(255,170,0,.2);color:#ffaa00;border-radius:4px;margin-left:4px}
.sel-limit-badge.full{background:rgba(255,77,109,.1);border-color:rgba(255,77,109,.3);color:#ff4d6d}

/* ── 5열 레이아웃 */
.result-5col{display:grid;grid-template-columns:1.5fr 1fr 1fr 1fr 1.4fr;min-height:360px;border-radius:var(--r);overflow:hidden}
.r5-col{display:flex;flex-direction:column;border-right:1px solid var(--border)}
.r5-col:last-child{border-right:none}
.r5-head{
  padding:10px 14px;border-bottom:1px solid var(--border);
  background:rgba(0,0,0,.25);
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
}
.r5-title{font-size:13px;font-weight:800;color:#fff}
.r5-sub{font-size:10px;color:var(--text3);margin-left:auto}
.kw-fire{font-size:12px}
.r5-body{flex:1;overflow-y:auto;max-height:420px}
.r5-body::-webkit-scrollbar{width:3px}
.r5-body::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:2px}
.r5-chips{padding:6px 8px;display:flex;flex-direction:column;gap:3px}

/* ── kw-btn 개선 (선택/비선택 명확한 대비) */
.kw-btn{
  width:100%;text-align:left;padding:8px 12px;
  background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.1);
  border-radius:6px;color:rgba(232,240,254,.7);font-size:14px;
  cursor:pointer;font-family:inherit;transition:all .15s;line-height:1.4;
}
.kw-btn:hover{background:rgba(3,199,90,.06);border-color:rgba(3,199,90,.3);color:var(--g)}
.kw-btn.kw-on{
  background:rgba(3,199,90,.12);border-color:rgba(3,199,90,.5);
  color:#00e676;font-weight:700;
  box-shadow:inset 0 0 0 1px rgba(3,199,90,.2);
}
.kw-btn.kw-on::before{content:'✓ ';color:#03C75A;font-size:12px}

/* ── item(제목/설명 행) 개선 - 선택/미선택 대비 */
.item{
  display:flex;align-items:center;gap:8px;padding:9px 14px;
  border-bottom:1px solid rgba(255,255,255,.04);
  transition:background .15s;cursor:default;
}
.item:hover{background:rgba(255,255,255,.03)}
.item.on{
  background:linear-gradient(90deg,rgba(3,199,90,.08),rgba(3,199,90,.03));
  border-left:3px solid var(--g);
}
.item.on .txt{color:#00e676;font-weight:600}
.plus{
  width:26px;height:26px;border-radius:50%;
  background:rgba(255,255,255,.06);border:1.5px solid rgba(255,255,255,.15);
  color:rgba(232,240,254,.5);font-size:14px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:all .15s;flex-shrink:0;font-family:inherit;
}
.plus:hover{background:rgba(3,199,90,.15);border-color:rgba(3,199,90,.4);color:var(--g)}
.item.on .plus{
  background:rgba(3,199,90,.2);border-color:var(--g);
  color:var(--g);font-weight:700;
}

/* ── pin-sel 가독성 대폭 개선 */
.pin-sel{
  background:#1a2d45;
  border:1.5px solid rgba(100,180,255,.35);
  color:#a8d4ff;
  border-radius:6px;padding:4px 10px;font-size:12px;
  cursor:pointer;font-family:inherit;flex-shrink:0;
  transition:all .15s;
  -webkit-appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23a8d4ff'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center;
  padding-right:24px;
}
.pin-sel:hover{border-color:rgba(100,180,255,.6);background-color:#1e3550}
.pin-sel.pinned{
  background:#0a2a1a;border-color:rgba(3,199,90,.6);color:#03C75A;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2303C75A'/%3E%3C/svg%3E");
}
.pin-sel option{background:#1a2d45;color:#a8d4ff;font-size:13px;padding:6px}
.pin-sel option:first-child{color:#6a9bbf}

/* ── 분석 리포트 em → color */
.analysis-section-content em,
.analysis-section-content .hl-b{color:#60aaff !important;font-style:normal;font-weight:600}
.analysis-section-content .hl{color:#03C75A !important;font-weight:700;font-style:normal}
.analysis-section-content .hl-w{color:#ffffff !important;font-weight:700;font-style:normal}

/* ── 분석 리포트 박스 (더 길게, 더 풍부하게) */
.analysis-section{
  margin-bottom:24px;padding-bottom:24px;
  border-bottom:1px solid var(--border);
}
.analysis-section:last-child{border-bottom:none}
.analysis-section-title{
  font-size:15px;font-weight:900;color:#fff;
  margin-bottom:12px;display:flex;align-items:center;gap:8px;
  padding-bottom:10px;border-bottom:1px solid rgba(3,199,90,.15);
}
.analysis-section-title::before{content:'';width:3px;height:18px;background:var(--g);border-radius:2px;flex-shrink:0}
.analysis-section-content{font-size:14px;color:rgba(232,240,254,.82);line-height:1.9}
.analysis-section-content p{margin-bottom:10px}
.analysis-section-content b{color:#fff;font-weight:700}
.analysis-section-content em{color:#a8d8ff;font-style:normal}
.ar-body p{margin:0 0 8px}
.ar-item{
  padding:8px 12px;margin:6px 0;
  background:rgba(255,255,255,.03);
  border-left:2px solid rgba(255,255,255,.1);
  border-radius:0 6px 6px 0;
  line-height:1.7;
}
.ar-item b{color:#7dd3fc}
.ar-item em{color:#86efac;font-style:normal}

/* ── 마케터 분석 사이드 패널 */
.col-analysis{min-height:180px}


/* ── 2열 결과 레이아웃 */
.result-2col{display:grid;grid-template-columns:1.15fr .85fr}
.rc-title-col{border-right:1px solid var(--border);overflow-y:auto;max-height:560px}
.rc-desc-col{overflow-y:auto;max-height:560px}
.rc-title-col::-webkit-scrollbar,.rc-desc-col::-webkit-scrollbar{width:3px}
.rc-title-col::-webkit-scrollbar-thumb,.rc-desc-col::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:2px}

/* ── 3컬럼 제목 레이아웃 (가로 나열) */
.result-titles-3col{
  display:grid;grid-template-columns:1fr 1fr 1fr;
  border-bottom:1px solid var(--border);
}
.rc-title-group{
  display:flex;flex-direction:column;
  border-right:1px solid var(--border);
  overflow-y:auto;max-height:440px;
}
.rc-title-group:last-child{border-right:none}
.rc-title-group::-webkit-scrollbar{width:3px}
.rc-title-group::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:2px}
.rc-desc-2col{display:grid;grid-template-columns:1fr 1fr;border-top:1px solid var(--border)}
.rc-desc-group{display:flex;flex-direction:column}
.rc-desc-area{overflow-y:auto;max-height:300px}
.rc-desc-area::-webkit-scrollbar{width:3px}
.rc-desc-area::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:2px}

/* ── 핀 위치별 item 색상 */
.item.pin1,.item-desc.pin1{
  background:linear-gradient(90deg,rgba(3,199,90,.1),rgba(3,199,90,.03));
  border-left:3px solid #03C75A;
}
.item.pin1 .txt,.item-desc.pin1 .txt{color:#4ddb8f}
.item.pin2,.item-desc.pin2{
  background:linear-gradient(90deg,rgba(51,133,255,.1),rgba(51,133,255,.03));
  border-left:3px solid #3385ff;
}
.item.pin2 .txt,.item-desc.pin2 .txt{color:#6aabff}
.item.pin3,.item-desc.pin3{
  background:linear-gradient(90deg,rgba(255,152,0,.1),rgba(255,152,0,.03));
  border-left:3px solid #ff9800;
}
.item.pin3 .txt,.item-desc.pin3 .txt{color:#ffbb4d}

/* ── 핀 select 색상 (위치별) */
.pin-sel.pin1{background:#0a2a1a;border-color:rgba(3,199,90,.7);color:#03C75A;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2303C75A'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center}
.pin-sel.pin2{background:#0a1a2a;border-color:rgba(51,133,255,.7);color:#3385ff;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%233385ff'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center}
.pin-sel.pin3{background:#2a1a0a;border-color:rgba(255,152,0,.7);color:#ff9800;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23ff9800'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center}

/* ── 헤더 행 */
.rc-head{
  display:flex;align-items:center;gap:8px;flex-wrap:wrap;
  padding:10px 16px;background:rgba(0,0,0,.25);
  border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:5;
}
.rc-head-label{font-size:13px;font-weight:800;color:#fff}
.rc-sel-count{
  font-size:12px;font-weight:700;
  background:rgba(3,199,90,.15);border:1px solid rgba(3,199,90,.3);
  color:var(--g);border-radius:12px;padding:2px 10px;
}

/* ── 제목 그룹 */
.title-group{border-bottom:1px solid rgba(255,255,255,.06)}
.title-group:last-child{border-bottom:none}
.title-group-label{
  display:flex;align-items:center;gap:8px;
  padding:8px 16px;
  background:rgba(0,0,0,.18);
  font-size:12px;font-weight:700;color:rgba(232,240,254,.7);
  border-bottom:1px solid rgba(255,255,255,.05);
  position:sticky;top:43px;z-index:4;
}
.tg-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.tg1{background:#03C75A;box-shadow:0 0 6px rgba(3,199,90,.5)}
.tg2{background:#3385ff;box-shadow:0 0 6px rgba(51,133,255,.5)}
.tg3{background:#ff9800;box-shadow:0 0 6px rgba(255,152,0,.5)}
.tg-sub{font-size:10px;font-weight:400;color:rgba(232,240,254,.4);margin-left:auto}

/* ── item 개선 (그룹 내 행) */
.item{
  display:flex;align-items:center;gap:10px;padding:10px 16px;
  border-bottom:1px solid rgba(255,255,255,.04);
  transition:background .15s;
}
.item:last-child{border-bottom:none}
.item:hover{background:rgba(255,255,255,.025)}
.item.on{
  background:linear-gradient(90deg,rgba(3,199,90,.09),rgba(3,199,90,.02));
  border-left:3px solid var(--g);
}
.item.on .txt{color:#4ddb8f;font-weight:600}

/* ── 그룹 뱃지 (1번추천, 2번추천...) */
.grp-badge{
  font-size:10px;font-weight:700;border-radius:4px;
  padding:2px 7px;flex-shrink:0;white-space:nowrap;
}
.grp-badge.g1{background:rgba(3,199,90,.15);color:#03C75A;border:1px solid rgba(3,199,90,.3)}
.grp-badge.g2{background:rgba(51,133,255,.15);color:#3385ff;border:1px solid rgba(51,133,255,.3)}
.grp-badge.g3{background:rgba(255,152,0,.15);color:#ff9800;border:1px solid rgba(255,152,0,.3)}

/* ── 설명 item - 텍스트 길어서 세로 구조 */
.item-desc{
  display:flex;align-items:flex-start;gap:10px;padding:12px 16px;
  border-bottom:1px solid rgba(255,255,255,.04);
  transition:background .15s;
}
.item-desc:hover{background:rgba(255,255,255,.025)}
.item-desc.on{
  background:linear-gradient(90deg,rgba(3,199,90,.12),rgba(3,199,90,.02));
  border-left:3px solid var(--g);
  padding-left:13px;
}
.item-desc.on .txt{color:#4ddb8f;font-weight:600}
.item-desc .txt-wrap{flex:1}
.item-desc .txt{font-size:14px;line-height:1.6;word-break:keep-all}
.item-desc .meta{display:flex;align-items:center;gap:6px;margin-top:4px}
.item-desc .plus{margin-top:1px}


/* ══ 입력 컬럼/강화 칸 내부 여백 — 전체 12px 기준으로 통일 ══ */

/* enhance-body / icol-body 구형 클래스 */
.enhance-body{padding:8px 12px;display:flex;flex-direction:column;gap:6px;flex:1}
.icol-body{padding:8px 12px;display:flex;flex-direction:column;gap:6px;flex:1}

.input-col:hover{border-color:rgba(255,255,255,.18) !important}

/* input-col 직접 자식들 패딩 */
.input-col > textarea.inp {
  padding: 6px 12px;
  margin: 4px 12px 4px;
  width: calc(100% - 24px);
  box-sizing: border-box;
}
.input-col > input.inp {
  padding: 6px 12px;
  margin: 4px 12px 4px;
  width: calc(100% - 24px);
  box-sizing: border-box;
}
.input-col > #featSlots {
  padding: 4px 12px 2px;
  width: 100%;
  box-sizing: border-box;
}
.input-col > .feat-add-row,
.input-col > button.feat-add-btn {
  margin: 0 12px 8px;
  width: calc(100% - 24px);
  box-sizing: border-box;
}
.input-col > .cost-row {
  padding: 3px 12px 6px;
  width: 100%;
  box-sizing: border-box;
}
.input-col > .analysis-status {
  padding: 0 12px;
  width: 100%;
  box-sizing: border-box;
}
.input-col > .analysis-preview {
  padding: 0 12px 6px;
  width: 100%;
  box-sizing: border-box;
}
.input-col > .analysis-btn {
  margin: 8px 12px 10px;
  width: calc(100% - 24px);
}
.input-col > #analysisProgress {
  padding: 3px 12px 0;
  width: 100%;
  box-sizing: border-box;
}

/* enhance-col 직접 자식들 패딩 */
.enhance-col > .deny-list,
.enhance-col > .deny-input-row,
.enhance-col > .season-chips,
.enhance-col > input.inp,
.enhance-col > .tone-grid {
  padding-left: 12px;
  padding-right: 12px;
  width: 100%;
  box-sizing: border-box;
}
.enhance-col > .deny-list { padding-top: 4px; }
.enhance-col > .season-chips { padding-top: 4px; padding-bottom: 4px; }
.enhance-col > .tone-grid { padding-top: 4px; padding-bottom: 8px; }
.enhance-col > input.inp { padding: 5px 12px; margin-top: 4px; margin-bottom: 8px; }


/* ── 분석 완료 사이드 텍스트 */
.analysis-complete-txt{font-size:13px;font-weight:700;color:#03C75A;margin-bottom:6px}

/* ── 히어로 sub */
.hero-sub{font-size:15px;color:var(--text3);margin-bottom:18px;line-height:1.7;animation:fadeSlideUp .6s ease .3s both}
.hero-sub strong{color:var(--text2)}

/* ── 마케터 분석 리포트 전체 보기 버튼 */
.analysis-btn{
  margin:10px 16px 12px;
  width:calc(100% - 32px);
}

/* ── enhance-col 내부 패딩 */
.enhance-col > .deny-list{ padding:6px 14px 2px;width:100%;box-sizing:border-box }
.enhance-col > .deny-input-row{ padding:2px 14px 10px;width:100%;box-sizing:border-box }
.enhance-col > .season-chips{ padding:6px 14px 2px;width:100%;box-sizing:border-box }
.enhance-col > input.inp{ margin:4px 14px 8px;width:calc(100% - 28px) }
.enhance-col > .tone-grid{ padding:6px 14px 10px;width:100%;box-sizing:border-box }

.col-analysis{ border-top:2px solid rgba(255,150,0,.55) }


/* ── 필수/선택/자동 뱃지 */
.badge-req{
  display:inline-flex;align-items:center;gap:2px;
  font-size:7.5px;font-weight:800;padding:0px 4px;border-radius:3px;
  background:rgba(255,60,80,.18);color:#ff4d6d;
  border:1px solid rgba(255,60,80,.35);vertical-align:middle;
  line-height:1.4;
}
.badge-req::before{content:'✱';font-size:8px}

.badge-opt{
  font-size:7.5px;font-weight:600;padding:0px 4px;border-radius:3px;
  background:rgba(255,255,255,.07);color:rgba(232,240,254,.5);
  border:1px solid rgba(255,255,255,.1);vertical-align:middle;
  line-height:1.4;
}

.badge-auto{
  font-size:7.5px;font-weight:700;padding:0px 4px;border-radius:3px;
  background:rgba(255,152,0,.12);color:#ff9800;
  border:1px solid rgba(255,152,0,.25);vertical-align:middle;
  line-height:1.4;
}

/* ── 필수 힌트 텍스트 */
.req-hint{
  font-size:11px;color:#ff8fa0;margin-top:2px;display:none;
  padding:2px 6px;
}
.req-hint.show{display:block}

/* ── 필수 입력 미완료 시 컬럼 강조 */
.input-col.req-error{border-color:rgba(255,60,80,.5) !important;box-shadow:0 0 0 1px rgba(255,60,80,.2) !important}
.input-col.req-error .icol-head{background:rgba(255,60,80,.08) !important}

/* ══ 분석 중 상세 표시 ══ */
.analyzing-label{
  display:flex;align-items:center;gap:10px;flex:1;
}
.analyzing-detail{
  display:flex;flex-direction:column;gap:2px;flex:1;min-width:0;
}
.analyzing-phase{
  font-size:11px;font-weight:800;color:var(--g);letter-spacing:.3px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.analyzing-step{
  font-size:11px;color:var(--text3);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  transition:opacity .3s;
}
.analyzing-timer-box{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:rgba(3,199,90,.08);border:1px solid rgba(3,199,90,.2);
  border-radius:8px;padding:4px 10px;min-width:64px;flex-shrink:0;
}
.analyzing-timer-remain{
  font-size:17px;font-weight:900;color:var(--g);
  font-variant-numeric:tabular-nums;line-height:1.1;letter-spacing:-0.5px;
}
.analyzing-timer-lbl{
  font-size:9px;color:var(--text3);font-weight:600;letter-spacing:.5px;
}
.gen-btn.analyzing{
  background:linear-gradient(135deg,#0a2a16,#032e12,#029e48) !important;
  background-size:200% 200% !important;
  animation:genBtnPulse 1.8s ease infinite !important;
  box-shadow:0 0 0 0 rgba(3,199,90,.5) !important;
}
@keyframes genBtnPulse{
  0%{box-shadow:0 0 0 0 rgba(3,199,90,.6),0 4px 16px rgba(3,199,90,.3)}
  50%{box-shadow:0 0 0 8px rgba(3,199,90,0),0 4px 24px rgba(3,199,90,.5)}
  100%{box-shadow:0 0 0 0 rgba(3,199,90,.0),0 4px 16px rgba(3,199,90,.3)}
}
/* 분석 중 footer 배경 */
.input-footer.analyzing{
  background:rgba(3,199,90,.04);
  border-top:1px solid rgba(3,199,90,.15);
  transition:all .5s;
}
/* 분석 중 상태 텍스트 */
.analyzing-label{
  display:flex;align-items:center;gap:8px;
  font-size:12px;font-weight:700;color:var(--g);
}
.analyzing-bar{
  display:flex;gap:3px;align-items:center;
}
.analyzing-bar span{
  display:inline-block;width:3px;border-radius:2px;background:var(--g);
  animation:analyzeBarDance 1.2s ease infinite;
}
.analyzing-bar span:nth-child(1){height:8px;animation-delay:0s}
.analyzing-bar span:nth-child(2){height:14px;animation-delay:.15s}
.analyzing-bar span:nth-child(3){height:10px;animation-delay:.3s}
.analyzing-bar span:nth-child(4){height:16px;animation-delay:.45s}
.analyzing-bar span:nth-child(5){height:8px;animation-delay:.6s}
.analyzing-bar span:nth-child(6){height:12px;animation-delay:.75s}
@keyframes analyzeBarDance{
  0%,100%{transform:scaleY(.4);opacity:.4}
  50%{transform:scaleY(1);opacity:1}
}
/* 분석 패널 분석 중 강조 */
.analysis-panel-tall.analyzing-active{
  border-color:rgba(3,199,90,.5) !important;
  box-shadow:0 0 0 0 rgba(3,199,90,.3);
  animation:panelGlow 2s ease infinite;
}
@keyframes panelGlow{
  0%,100%{box-shadow:0 0 12px rgba(3,199,90,.1)}
  50%{box-shadow:0 0 24px rgba(3,199,90,.25)}
}
/* ══ 분석 패널 대기 상태 ══ */
.ap-idle-gemini{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.ap-idle-logo{position:relative;width:36px;height:36px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ap-idle-pulse{position:absolute;inset:-4px;border-radius:50%;border:1.5px solid rgba(3,199,90,.3);animation:idlePulse 2s ease infinite}
@keyframes idlePulse{0%,100%{transform:scale(1);opacity:.4}50%{transform:scale(1.15);opacity:.8}}
.ap-idle-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:2px}
.ap-idle-sub{font-size:11px;color:var(--text3);line-height:1.4}
.ap-idle-scan{display:flex;flex-direction:column;gap:7px}
.ap-scan-item{display:flex;align-items:center;gap:8px;font-size:11px;color:var(--text3);padding:5px 8px;border-radius:6px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.05);transition:all .3s}
.ap-scan-item.lit{color:var(--g);background:rgba(3,199,90,.06);border-color:rgba(3,199,90,.2)}
.ap-scan-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.15);flex-shrink:0;transition:all .3s}
.ap-scan-item.lit .ap-scan-dot{background:var(--g);box-shadow:0 0 6px rgba(3,199,90,.5);animation:apPulse .8s ease infinite}
/* ══ 버튼 옆 로그 요약 ══ */
.gen-log-wrap{display:none;flex:1;overflow:hidden;margin-left:10px}
.gen-log-item{font-size:11px;color:var(--text3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .3s}
.gen-log-item.active{color:var(--g);font-weight:600}
.ap-unified-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.ap-log-box{background:rgba(0,0,0,.25);border:1px solid rgba(3,199,90,.15);border-radius:8px;padding:10px 12px;min-height:100px;max-height:180px;overflow-y:auto;font-family:monospace;transition:border-color .3s}
.ap-log-box.analyzing{border-color:rgba(3,199,90,.45);animation:logPulse 2s ease infinite}
@keyframes logPulse{0%,100%{border-color:rgba(3,199,90,.3);box-shadow:0 0 0 rgba(3,199,90,0)}50%{border-color:rgba(3,199,90,.6);box-shadow:0 0 8px rgba(3,199,90,.15)}}
.ap-log-idle-txt{color:rgba(255,255,255,.18);font-size:11px;font-style:italic;line-height:1.6;padding:4px 0}
.ap-status-badge{font-size:9px;font-weight:700;letter-spacing:.5px;padding:2px 7px;border-radius:20px;background:rgba(255,255,255,.08);color:var(--text3);flex-shrink:0}
.ap-status-badge.active{background:rgba(3,199,90,.2);color:var(--g)}
.ap-status-badge.done{background:rgba(0,102,255,.2);color:#4da3ff}

.inputs-locked .input-grid,
.inputs-locked .input-grid-b,
.inputs-locked .enhance-row{position:relative}
.inputs-locked .input-grid::after,
.inputs-locked .input-grid-b::after,
.inputs-locked .enhance-row::after{
  content:'';
  position:absolute;inset:0;z-index:10;
  background:transparent;
  pointer-events:all;
  border-radius:10px;
  cursor:not-allowed;
}
/* 생성 버튼 카운트다운 표시 */
.gen-btn .btn-countdown{
  font-size:12px;font-weight:700;
  font-variant-numeric:tabular-nums;
  background:rgba(0,0,0,.3);border-radius:5px;
  padding:1px 7px;margin-left:8px;letter-spacing:-.3px;
  display:inline-block;min-width:38px;text-align:center;
}
/* 정렬 개선: icol-head 내부 텍스트 높이 고정 */
/* 분석 패널 내부 여백 통일 */
.analysis-panel-tall > .icol-head{padding:12px 14px 8px}
.analysis-panel-tall > .analysis-status{padding:0 14px 4px}
.analysis-panel-tall > #analysisProgress{padding:0 14px 0;overflow-y:auto;flex:1}
.analysis-panel-tall > .analysis-preview{padding:8px 14px;flex:1;overflow-y:auto;font-size:12px;line-height:1.6;color:var(--text2)}
.analysis-panel-tall > .analysis-btn{margin:8px 14px 12px;width:calc(100% - 28px)}
/* 마케터 분석 실시간 내용 표시 */
.ap-live-log{
  margin-top:8px;padding:8px 10px;
  background:rgba(3,199,90,.04);border:1px solid rgba(3,199,90,.12);
  border-radius:7px;font-size:11px;line-height:1.7;color:var(--text3);
}
.ap-live-log .ap-log-item{
  display:flex;align-items:flex-start;gap:6px;
  padding:2px 0;border-bottom:1px solid rgba(255,255,255,.04);
}
.ap-live-log .ap-log-item:last-child{border-bottom:none}
.ap-live-log .ap-log-icon{font-size:11px;flex-shrink:0;margin-top:1px}
.ap-live-log .ap-log-text{flex:1;color:var(--text2)}
.ap-live-log .ap-log-text.active{color:var(--g);font-weight:600}
.ap-live-log .ap-log-dot{
  width:6px;height:6px;border-radius:50%;flex-shrink:0;margin-top:4px;
  background:rgba(255,255,255,.15);transition:all .3s;
}
.ap-live-log .ap-log-dot.done{background:var(--g)}
.ap-live-log .ap-log-dot.active{background:var(--g);animation:apPulse .8s ease infinite}

/* ═══════════════════════════════════════════════════════════════
   v8.3  DESIGN OVERRIDE — 2026 Editorial Precision
   Pretendard Variable 단일 폰트, 가독성 우선 타이포그래피 시스템
   ═══════════════════════════════════════════════════════════════ */

/* ── 0. CSS 변수 재정의 ── */
:root {
  --bg:#04080f;
  --bg2:#070d18;
  --bg3:#0a1320;
  --glass:rgba(255,255,255,.035);
  --glass2:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.075);
  --border2:rgba(255,255,255,.13);
  --text:#dce8f8;
  --text2:rgba(220,232,248,.88);
  --text3:rgba(220,232,248,.42);
  --hh:52px;
  --r:14px;
  --r2:9px;
  /* 타이포 스케일 */
  --fs-xs:10px;
  --fs-sm:11.5px;
  --fs-base:13px;
  --fs-md:14px;
  --fs-lg:15px;
  --fs-xl:17px;
}

/* ── 1. 기본 body ── */
body {
  font-family:'Pretendard Variable','Pretendard',-apple-system,'Apple SD Gothic Neo',sans-serif !important;
  font-size:14px;
  line-height:1.65;
  letter-spacing:-0.01em;
  background:var(--bg);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  word-break:keep-all;
}

/* ── 2. 헤더 정제 ── */
.site-header {
  height:var(--hh);
  background:rgba(4,8,15,.92);
  border-bottom:1px solid rgba(255,255,255,.06);
  padding:0 24px;
  backdrop-filter:blur(24px) saturate(200%);
}
.h-logo {
  width:32px;height:32px;border-radius:9px;
  font-size:16px;font-weight:900;
  box-shadow:0 2px 12px rgba(3,199,90,.3);
}
.h-title {
  font-size:14.5px;font-weight:700;
  letter-spacing:-0.3px;
}
.h-version {
  font-size:10px;font-weight:700;letter-spacing:.5px;
  padding:2px 8px;border-radius:20px;
}
.h-clock-time {
  font-size:15px;font-weight:700;letter-spacing:1.5px;
}
.h-clock-date {
  font-size:9.5px;letter-spacing:.4px;
}
.h-btn {
  font-size:12px;font-weight:600;
  padding:6px 14px;border-radius:8px;
  letter-spacing:-0.1px;
}

/* ── 3. 히어로 ── */
.hero {
  padding:18px 20px 14px;
}
.hero-eyebrow {
  font-size:10px;font-weight:700;letter-spacing:2.5px;
  padding:4px 14px;border-radius:20px;
}
.hero h1 {
  font-size:21px;font-weight:900;letter-spacing:-0.8px;
  line-height:1.35;margin-bottom:6px;
}
.hero-sub {
  font-size:13px;color:var(--text3);
  line-height:1.6;margin-bottom:0;
}

/* ── 4. 섹션 헤더 ── */
.section-label {
  font-size:15px;font-weight:800;
  letter-spacing:-0.3px;
}
.section-label::before {
  width:3px;height:17px;
}

/* ── 5. 입력 카드 전체 ── */
.input-card {
  border-radius:var(--r);
  border:1px solid var(--border2);
  background:linear-gradient(160deg,rgba(7,13,24,.97),rgba(10,19,35,.97));
  box-shadow:0 12px 48px rgba(0,0,0,.45), 0 0 0 1px rgba(3,199,90,.035);
}

/* ── 6. 진행 바 (progress bar) ── */
.pbar-strip {
  padding:10px 22px;
  background:rgba(0,0,0,.3);
  border-bottom:1px solid rgba(255,255,255,.05);
}
.pstep-lbl {
  font-size:11.5px;font-weight:600;
  letter-spacing:-.1px;
}
.pbar-msg {
  font-size:11.5px;font-weight:600;
  letter-spacing:-.2px;
}

/* ── 7. 입력 칼럼 (input-col) 정제 ── */
.input-col {
  border-radius:11px !important;
  background:rgba(5,10,20,.75) !important;
  border:1px solid rgba(255,255,255,.07) !important;
}
.input-col:hover {
  border-color:rgba(255,255,255,.15) !important;
  background:rgba(6,12,24,.8) !important;
}

/* 카드 헤더 (icol-head) */
.input-col > .icol-head,
.analysis-panel-tall > .icol-head {
  padding:14px 16px 8px !important;
}
.icol-head {
  gap:10px;
  margin-bottom:0 !important;
}

/* 번호 뱃지 — 더 크고 선명하게 */
.icol-num {
  font-size:9.5px !important;
  font-weight:900 !important;
  padding:3px 6px !important;
  border-radius:5px !important;
  letter-spacing:.3px !important;
  min-width:24px !important;
  text-align:center !important;
  flex-shrink:0 !important;
  margin-top:2px !important;
}

/* 카드 타이틀 — 가독성 최우선 */
.icol-title {
  font-size:13.5px !important;
  font-weight:800 !important;
  color:var(--text) !important;
  letter-spacing:-.25px !important;
  line-height:1.4 !important;
  margin-bottom:2px !important;
}

/* 설명 텍스트 — 너무 작으면 안 읽힘 */
.icol-desc {
  font-size:11.5px !important;
  color:var(--text3) !important;
  line-height:1.45 !important;
  word-break:keep-all !important;
}

/* ── 8. 강화 칼럼 (enhance-col) ── */
.enhance-col {
  border-radius:11px !important;
  background:rgba(5,10,20,.75) !important;
  border:1px solid rgba(255,255,255,.07) !important;
}
.enhance-col:hover {
  border-color:rgba(255,255,255,.14) !important;
}
.enhance-head {
  padding:14px 16px 6px !important;
  gap:9px !important;
}
.enhance-icon {
  font-size:15px !important;
}
.enhance-title {
  font-size:13px !important;
  font-weight:800 !important;
  color:var(--text) !important;
  letter-spacing:-.2px !important;
  margin-bottom:1px !important;
}
.enhance-desc {
  font-size:11.5px !important;
  color:var(--text3) !important;
  line-height:1.4 !important;
}
.enhance-inner {
  padding:4px 16px 12px !important;
}

/* ── 9. 입력 필드 ── */
.inp {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:13.5px !important;
  font-weight:500 !important;
  letter-spacing:-.15px !important;
  line-height:1.55 !important;
  padding:8px 12px !important;
  border-radius:var(--r2) !important;
  background:rgba(0,0,0,.35) !important;
  border:1.5px solid rgba(255,255,255,.08) !important;
  color:var(--text) !important;
  transition:border-color .2s, box-shadow .2s, background .2s !important;
}
.inp:focus {
  border-color:rgba(3,199,90,.5) !important;
  box-shadow:0 0 0 3px rgba(3,199,90,.08) !important;
  background:rgba(0,0,0,.42) !important;
  outline:none !important;
}
.inp::placeholder {
  color:rgba(220,232,248,.22) !important;
  font-size:13px !important;
}
.inp-ta {
  min-height:78px !important;
  resize:none !important;
}

/* ── 10. feat-slot (특징 입력) ── */
.feat-slot {
  background:rgba(0,0,0,.25) !important;
  border:1.5px solid rgba(255,255,255,.07) !important;
  border-radius:7px !important;
  padding:5px 10px !important;
  margin-bottom:4px !important;
  gap:8px !important;
}
.feat-slot:focus-within {
  border-color:rgba(3,199,90,.35) !important;
  background:rgba(3,199,90,.03) !important;
}
.feat-slot-num {
  font-size:10px !important;
  font-weight:800 !important;
  width:16px !important;
}
.feat-slot input {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:13px !important;
  font-weight:500 !important;
  color:var(--text) !important;
  letter-spacing:-.15px !important;
}
.feat-slot input::placeholder {
  color:rgba(220,232,248,.2) !important;
  font-size:12px !important;
}
.feat-add-btn {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:11.5px !important;
  font-weight:600 !important;
  padding:4px 0 !important;
  border-radius:7px !important;
  border-style:dashed !important;
  letter-spacing:-.1px !important;
}

/* ── 11. 뱃지 (필수/선택/자동) ── */
.badge-req {
  font-size:7.5px !important;
  font-weight:800 !important;
  padding:0px 4px !important;
  border-radius:3px !important;
  letter-spacing:.1px !important;
  line-height:1.4 !important;
}
.badge-opt {
  font-size:7.5px !important;
  font-weight:600 !important;
  padding:0px 4px !important;
  border-radius:3px !important;
  letter-spacing:.1px !important;
  line-height:1.4 !important;
}
.badge-auto {
  font-size:7.5px !important;
  font-weight:700 !important;
  padding:0px 4px !important;
  border-radius:3px !important;
  letter-spacing:.1px !important;
  line-height:1.4 !important;
}

/* ── 12. 시즌 칩 ── */
.schip {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:11px !important;
  font-weight:600 !important;
  padding:4px 10px !important;
  border-radius:20px !important;
  letter-spacing:-.1px !important;
  transition:all .18s !important;
}
.schip.on {
  font-weight:700 !important;
  box-shadow:0 0 10px rgba(3,199,90,.15) !important;
}
.schip:hover {
  background:rgba(3,199,90,.06) !important;
}

/* ── 13. 어조 버튼 ── */
.tone-grid {
  gap:5px !important;
}
.tone-btn {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:11.5px !important;
  font-weight:700 !important;
  padding:7px 8px !important;
  border-radius:7px !important;
  letter-spacing:-.1px !important;
  line-height:1.3 !important;
  transition:all .18s !important;
  white-space:nowrap !important;
}
.tone-btn.on {
  box-shadow:0 0 12px rgba(3,199,90,.15) !important;
}

/* ── 14. 금지어 태그 ── */
.deny-tag {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:12px !important;
  font-weight:600 !important;
  padding:4px 10px !important;
  border-radius:6px !important;
  letter-spacing:-.1px !important;
}

/* ── 15. 이미지 업로드 존 ── */
.upload-zone {
  border-radius:9px !important;
  padding:12px !important;
  min-height:64px !important;
}
.upl-icon { font-size:20px !important; }
.upl-text {
  font-size:11px !important;
  font-weight:600 !important;
  letter-spacing:-.1px !important;
}

/* ── 16. 생성 버튼 ── */
.gen-btn {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:14.5px !important;
  font-weight:900 !important;
  letter-spacing:-.3px !important;
  padding:13px 36px !important;
  border-radius:10px !important;
}
.footer-info {
  font-size:12px !important;
  font-weight:500 !important;
  letter-spacing:-.1px !important;
  color:var(--text3) !important;
}

/* ── 17. input-footer ── */
.input-footer {
  padding:12px 20px 16px !important;
  background:rgba(0,0,0,.18) !important;
  border-top:1px solid rgba(255,255,255,.05) !important;
  gap:14px !important;
}

/* ── 18. 분석 패널 내부 ── */
.ap-unified-header { margin-bottom:12px !important; }
#apHeaderTitle {
  font-size:13px !important;
  font-weight:800 !important;
  letter-spacing:-.2px !important;
}
#apHeaderSub {
  font-size:11px !important;
  margin-top:2px !important;
  line-height:1.45 !important;
}
.ap-status-badge {
  font-size:9.5px !important;
  font-weight:700 !important;
  letter-spacing:.3px !important;
  padding:3px 8px !important;
  border-radius:20px !important;
}
.ap-log-box {
  border-radius:9px !important;
  padding:10px 14px !important;
  font-family:'Pretendard Variable',monospace !important;
  font-size:11.5px !important;
  line-height:1.65 !important;
  min-height:96px !important;
}
.ap-log-idle-txt {
  font-size:11.5px !important;
  letter-spacing:-.1px !important;
}

/* ── 19. 분석 버튼 ── */
.analysis-btn {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:13px !important;
  font-weight:800 !important;
  letter-spacing:-.2px !important;
  padding:10px 14px !important;
  border-radius:8px !important;
}

/* ── 20. 미리보기 섹션 ── */
.pv-head h4 {
  font-size:11.5px !important;
  font-weight:700 !important;
  letter-spacing:-.1px !important;
}
.pv-live {
  font-size:10px !important;
  font-weight:700 !important;
  padding:2px 7px !important;
  border-radius:4px !important;
}

/* ── 21. 광고 소재 결과 카드 ── */
.rc-head {
  padding:11px 18px !important;
}
.rc-head-label {
  font-size:13.5px !important;
  font-weight:900 !important;
  letter-spacing:-.25px !important;
}
.tg-sub {
  font-size:10.5px !important;
  font-weight:500 !important;
}
.grp-badge {
  font-size:10px !important;
  font-weight:700 !important;
  padding:2px 8px !important;
  border-radius:5px !important;
  letter-spacing:-.1px !important;
}

/* ── 22. 제목/설명 item ── */
.item {
  padding:10px 18px !important;
  gap:10px !important;
}
.txt {
  font-size:14px !important;
  font-weight:500 !important;
  letter-spacing:-.2px !important;
  line-height:1.5 !important;
}
.item.on .txt {
  font-weight:700 !important;
  letter-spacing:-.25px !important;
}
.plus {
  width:26px !important; height:26px !important;
  border-radius:50% !important;
  font-size:13px !important;
  font-weight:900 !important;
  flex-shrink:0 !important;
}
.cc {
  font-size:10.5px !important;
  font-weight:600 !important;
  letter-spacing:-.1px !important;
}
.meta {
  gap:6px !important;
  margin-top:4px !important;
}

/* ── 23. 설명 item ── */
.item-desc {
  padding:12px 18px !important;
  gap:10px !important;
}
.item-desc .txt {
  font-size:13.5px !important;
  font-weight:500 !important;
  letter-spacing:-.2px !important;
  line-height:1.65 !important;
}

/* ── 24. pin-sel (위치 고정 드롭다운) ── */
.pin-sel {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:11.5px !important;
  font-weight:600 !important;
  padding:5px 26px 5px 10px !important;
  border-radius:6px !important;
  letter-spacing:-.1px !important;
}

/* ── 25. 현황판 (status-board) ── */
.status-board {
  border-radius:13px !important;
  padding:16px 18px !important;
  gap:12px !important;
}
.sb-sel-label {
  font-size:9.5px !important;
  font-weight:700 !important;
  letter-spacing:.6px !important;
}
.sb-sel-num {
  font-size:28px !important;
  font-weight:900 !important;
  letter-spacing:-1px !important;
  line-height:1 !important;
}
.sb-sel-max {
  font-size:11.5px !important;
  font-weight:500 !important;
}
.sb-pin-label {
  font-size:9.5px !important;
  font-weight:600 !important;
  letter-spacing:.2px !important;
}
.sb-pin-num {
  font-size:20px !important;
  font-weight:900 !important;
  letter-spacing:-1px !important;
}
.sb-pin-sub {
  font-size:10px !important;
  font-weight:500 !important;
  letter-spacing:-.1px !important;
}
.sb-list-head {
  font-size:11px !important;
  font-weight:700 !important;
  letter-spacing:.2px !important;
}
.sel-item {
  font-size:12.5px !important;
  font-weight:500 !important;
  letter-spacing:-.15px !important;
}
.sel-empty {
  font-size:11.5px !important;
  letter-spacing:-.1px !important;
}
.sel-limit-badge {
  font-size:10.5px !important;
  font-weight:700 !important;
  padding:2px 8px !important;
  border-radius:5px !important;
}

/* ── 26. 섹션 헤더 ── */
.sec-title {
  font-size:13.5px !important;
  font-weight:800 !important;
  letter-spacing:-.25px !important;
}
.badge {
  font-size:11px !important;
  font-weight:700 !important;
  padding:1px 7px !important;
  border-radius:4px !important;
  letter-spacing:-.1px !important;
}

/* ── 27. input-grid-b 레이아웃 내부 패딩 정규화 ── */
.input-grid-b {
  padding:10px 14px 0 !important;
  gap:10px !important;
}

/* ── 28. 모달 폰트 ── */
.key-modal-head h2 {
  font-size:18px !important;
  font-weight:900 !important;
  letter-spacing:-.4px !important;
}
.key-modal-head p {
  font-size:12.5px !important;
  line-height:1.6 !important;
}
.step-text {
  font-size:12.5px !important;
  line-height:1.65 !important;
}
.key-input-wrap input {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:13px !important;
  font-weight:500 !important;
  letter-spacing:.2px !important;
}
.key-notice {
  font-size:11.5px !important;
  line-height:1.75 !important;
}
.key-confirm-btn {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:13.5px !important;
  font-weight:800 !important;
  letter-spacing:-.2px !important;
  padding:12px !important;
  border-radius:10px !important;
}

/* ── 29. 분석 모달 ── */
.analysis-modal-head {
  padding:22px 26px !important;
}
.analysis-modal-body {
  padding:22px 26px !important;
}
.analysis-section-title {
  font-size:15px !important;
  font-weight:900 !important;
  letter-spacing:-.35px !important;
  margin-bottom:12px !important;
}
.analysis-section-content {
  font-size:14px !important;
  line-height:1.9 !important;
  letter-spacing:-.15px !important;
}

/* ── 30. refresh 버튼 ── */
.refresh-btn {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:12.5px !important;
  font-weight:700 !important;
  padding:6px 16px !important;
  border-radius:7px !important;
  letter-spacing:-.1px !important;
}

/* ── 31. 상태 카드 테두리 강화 ── */
.input-col:nth-child(1) { border-top:2px solid rgba(3,199,90,.6) !important; }
.input-col:nth-child(2) { border-top:2px solid rgba(180,60,255,.55) !important; }
.input-col:nth-child(3) { border-top:2px solid rgba(255,150,0,.55) !important; }
.col-analysis { border-top:2px solid rgba(255,150,0,.55) !important; }
.enhance-col:nth-child(1) { border-top:2px solid rgba(255,77,109,.45) !important; }
.enhance-col:nth-child(2) { border-top:2px solid rgba(51,200,170,.45) !important; }
.enhance-col:nth-child(3) { border-top:2px solid rgba(150,100,255,.45) !important; }

/* ── 32. 글로벌 스크롤바 정제 ── */
::-webkit-scrollbar { width:4px; height:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,255,255,.1); border-radius:4px; }
::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,.18); }

/* ── 33. 포커스 ring 통일 ── */
button:focus-visible, select:focus-visible, input:focus-visible, textarea:focus-visible {
  outline:2px solid rgba(3,199,90,.5);
  outline-offset:2px;
}

/* ── 34. 분석 중 진행 텍스트 ── */
.analyzing-phase {
  font-size:12px !important;
  font-weight:900 !important;
  letter-spacing:-.1px !important;
}
.analyzing-step {
  font-size:11.5px !important;
  font-weight:500 !important;
}
.analyzing-timer-remain {
  font-size:18px !important;
  font-weight:900 !important;
  letter-spacing:-1px !important;
}
.analyzing-timer-lbl {
  font-size:9.5px !important;
  font-weight:700 !important;
  letter-spacing:.3px !important;
}

/* ── 35. 네이버 미리보기 내 폰트 ── */
.naver-ad-store, .naver-mob-store {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:9.5px !important;
  font-weight:600 !important;
}
.naver-ad-title, .naver-mob-title {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:12.5px !important;
  font-weight:800 !important;
}
.naver-ad-desc, .naver-mob-desc {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:10.5px !important;
  font-weight:500 !important;
  line-height:1.6 !important;
}

/* ── 36. 경고 토스트 ── */
#limitToast {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  font-size:13px !important;
  font-weight:700 !important;
  letter-spacing:-.2px !important;
  border-radius:10px !important;
  padding:12px 20px !important;
}

/* ── 37. 결과 카드 배지 (sel-count) ── */
.rc-sel-count {
  font-size:11px !important;
  font-weight:700 !important;
  padding:2px 10px !important;
  border-radius:20px !important;
  letter-spacing:-.1px !important;
}

/* ── 38. input-grid-b 4열 레이아웃 통일 ── */
.input-grid-b {
  display:grid !important;
  grid-template-columns:1fr 1fr 1fr 260px !important;
  grid-template-rows:auto auto !important;
  gap:10px !important;
  padding:10px 14px 0 !important;
}

/* ── 39. 전체 폰트 상속 강제 ── */
button, input, textarea, select, option {
  font-family:'Pretendard Variable','Pretendard',-apple-system,'Apple SD Gothic Neo',sans-serif !important;
}

/* ── 40. pbar steps 텍스트 ── */
.pstep-lbl {
  font-weight:600 !important;
  font-size:11.5px !important;
  letter-spacing:-.15px !important;
}

/* ─── 41. 헤더 API 상태 ─── */
.api-status {
  font-size:12.5px !important;
  font-weight:500 !important;
  letter-spacing:-.1px !important;
}

/* ─── 42. section-header padding ─── */
.section-header {
  padding:16px 0 10px !important;
}

/* ─── 43. 리포트 사이드 미리보기 ─── */
#analysisSidePreview {
  font-size:12px !important;
  line-height:1.75 !important;
  letter-spacing:-.1px !important;
}

/* ─── 44. h-version 정제 ─── */
.h-version {
  font-size:10px !important;
  letter-spacing:.8px !important;
  font-weight:800 !important;
  padding:3px 9px !important;
}

/* ─── 45. analysis-modal 제목 ─── */
.analysis-modal-head > div > div > div:first-child {
  font-size:15.5px !important;
  font-weight:900 !important;
  letter-spacing:-.4px !important;
}

/* ─── 46. analysis-panel-tall 패딩 ─── */
.analysis-panel-tall > .icol-head { padding:14px 16px 8px !important; }
.analysis-panel-tall > .analysis-status { padding:0 16px 4px !important; }
.analysis-panel-tall > #analysisProgress { padding:0 16px 0 !important; }
.analysis-panel-tall > .analysis-btn { margin:8px 16px 14px !important; width:calc(100% - 32px) !important; }

/* ─── 47. input-col 내부 직접 자식 패딩 통일 ─── */
.input-col > textarea.inp,
.input-col > input.inp {
  padding:7px 12px !important;
  margin:4px 14px 4px !important;
  width:calc(100% - 28px) !important;
}
.input-col > #featSlots {
  padding:4px 14px 2px !important;
  width:100% !important;
}
.input-col > button.feat-add-btn {
  margin:0 14px 10px !important;
  width:calc(100% - 28px) !important;
}
.input-col > .upload-zone {
  margin:4px 14px !important;
  width:calc(100% - 28px) !important;
}
.input-col > .img-grid {
  padding:0 14px 6px !important;
}
.input-col > #costCurrent {
  padding:0 14px 6px !important;
}

/* ─── 48. enhance-col 내부 패딩 통일 ─── */
.enhance-col > .enhance-inner {
  padding:4px 16px 12px !important;
}
.enhance-col > .deny-list {
  padding:2px 16px 4px !important; width:100% !important;
}
.enhance-col > .season-chips {
  padding:2px 16px 4px !important; width:100% !important;
}
.enhance-col > input.inp {
  margin:2px 16px 8px !important; width:calc(100% - 32px) !important;
}
.enhance-col > .tone-grid {
  padding:2px 16px 10px !important; width:100% !important;
}

/* ─── 49. 타이포그래피 전체 one-shot 정규화 ─── */
h1,h2,h3,h4,h5,h6 {
  font-family:'Pretendard Variable','Pretendard',sans-serif !important;
  word-break:keep-all !important;
}
p, span, div, label, li {
  font-family:'Pretendard Variable','Pretendard',sans-serif;
}


/* ── 전체 취소 버튼 */
.clear-all-btn{
  background:rgba(255,77,109,.08);
  border:1.5px solid rgba(255,77,109,.25);
  color:#ff6b85;
  border-radius:7px;padding:4px 12px;
  font-size:11.5px;font-weight:700;
  cursor:pointer;font-family:inherit;
  transition:all .18s;letter-spacing:-.1px;
  display:none;align-items:center;gap:5px;
  flex-shrink:0;
}
.clear-all-btn:hover{
  background:rgba(255,77,109,.15);
  border-color:rgba(255,77,109,.5);
  color:#ff4d6d;
  box-shadow:0 0 10px rgba(255,77,109,.15);
}
.clear-all-btn.visible{display:flex}


/* ── 미리보기 PC/모바일 크기 통일 */
.naver-ad,.naver-mob-ad{
  min-height:40px;
}
.naver-ad-inner,.naver-mob-ad-inner{
  min-height:32px;
  padding:5px 8px!important;
}
/* 빈 상태 placeholder 높이도 통일 */
.naver-ad-title.empty,
.naver-mob-title.empty{
  min-height:8px;
  display:block;
}
.naver-ad-desc.empty,
.naver-mob-desc.empty{
  min-height:10px;
  display:block;
}
/* 썸네일 크기 통일 44x44 */
.naver-ad-thumb,.naver-mob-thumb{
  width:36px!important;height:36px!important;
  font-size:14px!important;
}
/* 폰트 크기 통일 */
.naver-ad-title,.naver-mob-title{
  font-size:12.5px!important;font-weight:800!important;
}
.naver-ad-desc,.naver-mob-desc{
  font-size:10.5px!important;line-height:1.55!important;
}
/* mob-ad-empty도 동일 높이 */
.mob-ad-empty{
  min-height:32px;
  padding:5px 8px!important;
}


/* ══ 고정하기 버튼 ══ */
.pin-section-btn {
  display:inline-flex;align-items:center;gap:5px;
  background:rgba(255,255,255,.06);
  border:1.5px solid rgba(255,255,255,.1);
  color:rgba(220,232,248,.6);
  border-radius:7px;padding:4px 11px;
  font-size:11.5px;font-weight:700;
  cursor:pointer;font-family:inherit;
  transition:all .2s;letter-spacing:-.1px;
  flex-shrink:0;
}
.pin-section-btn:hover {
  border-color:rgba(3,199,90,.45);
  color:#03C75A;
  background:rgba(3,199,90,.07);
}
.pin-section-btn.pinned {
  background:rgba(3,199,90,.1);
  border-color:rgba(3,199,90,.5);
  color:#03C75A;
  box-shadow:0 0 10px rgba(3,199,90,.12);
}
.pin-section-btn .pin-icon { font-size:11px; transition:transform .2s; }
.pin-section-btn.pinned .pin-icon { transform:rotate(45deg); }



/* ══ 더보기 버튼 ══ */
.more-sel-btn {
  display:inline-flex;align-items:center;gap:4px;
  background:rgba(3,199,90,.08);
  border:1px solid rgba(3,199,90,.2);
  color:#03C75A;border-radius:6px;
  padding:3px 10px;font-size:11px;font-weight:700;
  cursor:pointer;font-family:inherit;transition:all .18s;
  margin-left:auto;
}
.more-sel-btn:hover { background:rgba(3,199,90,.15);border-color:rgba(3,199,90,.4); }
.more-sel-btn .cnt-badge {
  background:rgba(3,199,90,.2);border-radius:10px;
  padding:0 5px;font-size:10px;font-weight:800;
}

/* ══ 더보기 모달 ══ */
.sel-modal-overlay {
  position:fixed;inset:0;z-index:300;
  background:rgba(0,0,0,.65);backdrop-filter:blur(6px);
  display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity .2s;
}
.sel-modal-overlay.open { opacity:1;pointer-events:all; }
.sel-modal {
  background:linear-gradient(160deg,#070d18,#0a1320);
  border:1px solid rgba(255,255,255,.1);
  border-radius:16px;
  box-shadow:0 24px 80px rgba(0,0,0,.7);
  width:min(700px,92vw);
  max-height:82vh;
  display:flex;flex-direction:column;
  transform:scale(.95) translateY(16px);
  transition:transform .25s cubic-bezier(.34,1.56,.64,1);
  overflow:hidden;
}
.sel-modal-overlay.open .sel-modal { transform:scale(1) translateY(0); }
.sel-modal-head {
  padding:16px 22px;
  border-bottom:1px solid rgba(255,255,255,.07);
  display:flex;align-items:center;gap:10px;
  background:rgba(0,0,0,.25);flex-shrink:0;
}
.sel-modal-head h3 { font-size:15px;font-weight:900;letter-spacing:-.3px;flex:1; }
.sel-modal-close {
  width:28px;height:28px;border-radius:50%;
  background:rgba(255,255,255,.07);border:none;
  color:rgba(220,232,248,.6);cursor:pointer;
  font-size:13px;font-family:inherit;
  display:flex;align-items:center;justify-content:center;
  transition:all .15s;
}
.sel-modal-close:hover { background:rgba(255,77,109,.15);color:#ff6b85; }
.sel-modal-body {
  display:grid;grid-template-columns:1fr 1fr;
  gap:0;overflow-y:auto;flex:1;
}
.sel-modal-body::-webkit-scrollbar { width:4px; }
.sel-modal-body::-webkit-scrollbar-thumb { background:rgba(255,255,255,.1);border-radius:4px; }
.sel-modal-col {
  padding:16px 20px;
  border-right:1px solid rgba(255,255,255,.06);
}
.sel-modal-col:last-child { border-right:none; }
.sel-modal-col-title {
  font-size:11px;font-weight:800;color:rgba(220,232,248,.4);
  letter-spacing:.5px;text-transform:uppercase;
  margin-bottom:10px;display:flex;align-items:center;gap:6px;
}
.sel-modal-col-title .col-cnt {
  background:rgba(3,199,90,.12);color:#03C75A;
  border-radius:20px;padding:1px 7px;font-size:10px;font-weight:800;
  letter-spacing:-.1px;text-transform:none;
}
.sel-modal-item {
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
  border-radius:8px;padding:10px 12px;
  margin-bottom:6px;transition:all .15s;
}
.sel-modal-item:hover { background:rgba(255,255,255,.055);border-color:rgba(255,255,255,.12); }
.sel-modal-item:last-child { margin-bottom:0; }
.sel-modal-item-num {
  font-size:10px;font-weight:800;color:rgba(220,232,248,.3);
  margin-bottom:4px;
}
.sel-modal-item-txt {
  font-size:13.5px;font-weight:500;color:var(--text);
  letter-spacing:-.2px;line-height:1.55;word-break:keep-all;
}
.sel-modal-item-meta {
  display:flex;align-items:center;gap:6px;margin-top:6px;
}
.sel-modal-item-len {
  font-size:10px;font-weight:700;padding:1px 6px;
  border-radius:4px;background:rgba(3,199,90,.1);color:#03C75A;
}
.sel-modal-item-pin {
  font-size:10px;font-weight:700;padding:1px 6px;
  border-radius:4px;background:rgba(51,133,255,.1);color:#3385ff;
}
.sel-modal-empty {
  text-align:center;padding:32px 0;
  color:rgba(220,232,248,.25);font-size:13px;
}
.sel-modal-footer {
  padding:12px 22px;
  border-top:1px solid rgba(255,255,255,.06);
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(0,0,0,.2);flex-shrink:0;
}
.sel-modal-footer-info { font-size:12px;color:rgba(220,232,248,.4); }
.sel-modal-copy-all {
  background:rgba(3,199,90,.1);border:1px solid rgba(3,199,90,.25);
  color:#03C75A;border-radius:7px;padding:6px 16px;
  font-size:12px;font-weight:700;cursor:pointer;font-family:inherit;
  transition:all .18s;
}
.sel-modal-copy-all:hover { background:rgba(3,199,90,.18);border-color:rgba(3,199,90,.5); }

/* sb-lists 더보기 버튼 영역 */
.sb-list-head { align-items:center; }


/* ─── 3 API 키 모달 스타일 ─── */
.mk-api-row{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:12px 14px;display:flex;flex-direction:column;gap:6px}
.mk-api-header{display:flex;align-items:center;gap:7px}
.mk-badge{font-size:9px;font-weight:800;padding:2px 7px;border-radius:20px;letter-spacing:.3px;flex-shrink:0}
.mk-badge-g{background:rgba(3,199,90,.15);color:#03C75A;border:1px solid rgba(3,199,90,.3)}
.mk-badge-c{background:rgba(255,140,0,.12);color:#ff9800;border:1px solid rgba(255,140,0,.25)}
.mk-badge-o{background:rgba(51,133,255,.12);color:#3385ff;border:1px solid rgba(51,133,255,.25)}
.mk-api-name{font-size:13px;font-weight:800;color:#fff}
.mk-api-role{font-size:10px;color:rgba(255,255,255,.3);margin-left:auto}
.mk-input{width:100%;box-sizing:border-box;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.12);border-radius:8px;padding:8px 12px;font-size:12px;color:#fff;font-family:monospace;outline:none;transition:border-color .15s}
.mk-input:focus{border-color:rgba(3,199,90,.5)}
.mk-input::placeholder{color:rgba(255,255,255,.2)}
.mk-link-row{font-size:10px;color:rgba(255,255,255,.28)}
.mk-link-row a{color:rgba(3,199,90,.65);text-decoration:none}
.mk-link-row a:hover{color:#03C75A}

/* ─── 헤더 API 상태 도트 ─── */
.h-api-dots{display:flex;gap:5px;align-items:center}
.h-api-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.18);flex-shrink:0;transition:all .3s}
.h-api-dot.on-g{background:#03C75A;box-shadow:0 0 5px rgba(3,199,90,.7)}
.h-api-dot.on-c{background:#ff9800;box-shadow:0 0 5px rgba(255,140,0,.6)}
.h-api-dot.on-o{background:#3385ff;box-shadow:0 0 5px rgba(51,133,255,.6)}

/* ─── 헤더 3AI 상태 표시 ─── */
.h3-dots{display:flex;align-items:center;gap:10px}
.h3-api-item{display:flex;align-items:center;gap:4px;cursor:default}
.h3-api-dot{width:8px;height:8px;border-radius:50%;background:#ff4d6d;box-shadow:0 0 6px rgba(255,77,109,.7);flex-shrink:0;transition:background .3s,box-shadow .3s}
.h3-api-name{font-size:11px;font-weight:700;color:rgba(220,232,248,.55);transition:color .3s}
.h3-api-item.on .h3-api-dot{background:#03C75A;box-shadow:0 0 7px rgba(3,199,90,.8)}
.h3-api-item.on .h3-api-name{color:rgba(220,232,248,.85)}

/* ─── 상품명 툴팁 ─── */
.name-tooltip-wrap{position:relative;display:inline-flex;align-items:center;margin-left:5px;vertical-align:middle}
.name-tip-icon{display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,.12);color:rgba(255,255,255,.5);font-size:9px;font-weight:800;cursor:default;border:1px solid rgba(255,255,255,.15);transition:all .15s;font-style:normal}
.name-tooltip-wrap:hover .name-tip-icon{background:rgba(3,199,90,.2);color:#03C75A;border-color:rgba(3,199,90,.4)}
.name-tip-box{position:absolute;left:50%;top:calc(100% + 7px);transform:translateX(-50%);background:#0d1f35;border:1px solid rgba(3,199,90,.25);border-radius:8px;padding:8px 11px;font-size:11px;font-weight:400;color:rgba(220,232,248,.8);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s;z-index:200;line-height:1.6;box-shadow:0 6px 20px rgba(0,0,0,.5)}
.name-tip-box::before{content:'';position:absolute;bottom:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-bottom-color:#0d1f35}
.name-tooltip-wrap:hover .name-tip-box{opacity:1}

/* ─── 공용 ? 툴팁 ─── */
.tip-wrap{position:relative;display:inline-flex;align-items:center;margin-left:4px;vertical-align:middle}
.tip-q{display:inline-flex;align-items:center;justify-content:center;width:13px;height:13px;border-radius:50%;background:rgba(255,255,255,.1);color:rgba(255,255,255,.4);font-size:8px;font-weight:800;cursor:default;border:1px solid rgba(255,255,255,.12);transition:all .15s;font-style:normal;flex-shrink:0}
.tip-wrap:hover .tip-q{background:rgba(3,199,90,.18);color:#03C75A;border-color:rgba(3,199,90,.35)}
.tip-box{position:absolute;left:50%;top:calc(100% + 7px);transform:translateX(-50%);background:#0b1a2e;border:1px solid rgba(3,199,90,.2);border-radius:8px;padding:8px 11px;font-size:10.5px;font-weight:400;color:rgba(220,232,248,.78);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s;z-index:300;line-height:1.65;box-shadow:0 6px 24px rgba(0,0,0,.55)}
.tip-box::before{content:'';position:absolute;bottom:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-bottom-color:#0b1a2e}
.tip-wrap:hover .tip-box{opacity:1}

/* ─── enhance-num (06~08 번호) ─── */
.enhance-num{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;border-radius:5px;background:rgba(255,255,255,.07);color:rgba(220,232,248,.45);font-size:9.5px;font-weight:800;flex-shrink:0;font-family:'Pretendard Variable','Pretendard',sans-serif}
</style>
</head>
<body>

<canvas id="starCanvas" style="position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.55"></canvas>
<div class="aurora"><div class="aurora-1"></div><div class="aurora-2"></div><div class="aurora-3"></div></div>
<div class="noise"></div>

<!-- ── API Key 모달 ── -->
<div class="overlay hidden" id="keyModal">
  <div class="key-modal">
    <div class="key-modal-head">
      <button onclick="document.getElementById('keyModal').classList.add('hidden')" style="position:absolute;top:14px;right:16px;background:rgba(255,255,255,.15);border:none;color:#fff;width:28px;height:28px;border-radius:50%;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;z-index:1">×</button>
      <div class="logo-mark">N</div>
      <h2>파워링크 광고 소재 생성기</h2>
      <p>스마트스토어 URL 하나로 파워링크 광고 문구를<br>AI가 자동으로 만들어드립니다</p>
    </div>
    <div class="key-modal-body">
      <div style="padding:18px 22px 6px;display:flex;flex-direction:column;gap:10px">

        <!-- Gemini (필수) -->
        <div class="mk-api-row">
          <div class="mk-api-header">
            <span class="mk-badge mk-badge-g">필수</span>
            <span class="mk-api-name">🟢 Gemini API Key</span>
            
          </div>
          <input type="password" class="mk-input" id="modalKeyGemini" placeholder="AIzaSy..." oninput="onKeyInput()" onpaste="setTimeout(onKeyInput,10)" />
          <div class="mk-link-row"><a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com</a> → Create API Key</div>
        </div>

        <!-- Claude (권장) -->
        <div class="mk-api-row">
          <div class="mk-api-header">
            <span class="mk-badge mk-badge-c">권장</span>
            <span class="mk-api-name">🟠 Claude API Key</span>
            
          </div>
          <input type="password" class="mk-input" id="modalKeyClaude" placeholder="sk-ant-..." oninput="onKeyInput()" onpaste="setTimeout(onKeyInput,10)" />
          <div class="mk-link-row"><a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> → Billing $5 충전 → API Keys</div>
        </div>

        <!-- GPT-4o (선택) -->
        <div class="mk-api-row">
          <div class="mk-api-header">
            <span class="mk-badge mk-badge-o">선택</span>
            <span class="mk-api-name">🔵 GPT-4o API Key</span>
            
          </div>
          <input type="password" class="mk-input" id="modalKeyOpenai" placeholder="sk-proj-..." oninput="onKeyInput()" onpaste="setTimeout(onKeyInput,10)" />
          <div class="mk-link-row"><a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a> → Billing $5 충전 → API Keys</div>
        </div>

        <div class="key-notice" style="margin-top:4px">
          🔒 API Key는 <span>브라우저에만 저장</span>되며 서버로 전송되지 않아요.<br>
          🔒 API Key는 <span>브라우저에만 저장</span>되며 서버로 전송되지 않아요.
        </div>
      </div>

      <div style="padding:14px 22px 22px">
        <button class="key-confirm-btn ripple-btn" id="keyConfirmBtn" onclick="confirmKey()" disabled>
          <span class="btn-icon">✓</span>
          <span class="btn-text">저장하고 시작하기</span>
        </button>
        <button class="key-skip-btn" onclick="document.getElementById('keyModal').classList.add('hidden')">
          나중에 설정할게요
        </button>
      </div>
    </div>
  </div>
</div>




<!-- 분석 모달 -->
<div class="overlay hidden" id="analysisModal">
  <div class="analysis-modal-inner">
    <div class="analysis-modal-head">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,rgba(3,199,90,.2),rgba(0,102,255,.15));border:1px solid rgba(3,199,90,.3);display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 0 20px rgba(3,199,90,.2)">🧠</div>
        <div>
          <div style="font-family:'Pretendard Variable','Pretendard',sans-serif;font-size:15px;font-weight:800;color:#fff">마케터 분석 리포트</div>
          <div style="font-size:10px;color:var(--text3);margin-top:2px">10년차 네이버 파워링크 전문가의 소재 전략 분석</div>
        </div>
      </div>
      <button onclick="document.getElementById('analysisModal').classList.add('hidden')" style="background:rgba(255,255,255,.07);border:1px solid var(--border);color:var(--text2);width:30px;height:30px;border-radius:50%;font-size:16px;cursor:pointer;flex-shrink:0;transition:all .15s">×</button>
    </div>
    <div class="analysis-modal-body" id="analysisModalBody">
      <div class="analysis-loading"><span class="spin-sm"></span> 분석 중...</div>
    </div>
  </div>
</div>

<!-- 헤더 -->
<header class="site-header">
  <div class="header-left">
    <div class="h-logo">N</div>
    <span class="h-title">파워링크 광고 소재 생성기</span>
    <span class="h-version">v9.0</span>
  </div>
  <div class="header-right">
    <div class="h-clock">
      <div class="h-clock-time" id="hClockTime">00:00:00</div>
      <div class="h-clock-date" id="hClockDate"></div>
    </div>
    <div class="h-div"></div>
    <div class="api-status" style="gap:10px">
      <div class="h3-dots">
        <div class="h3-api-item" id="dotG">
          <span class="h3-api-dot"></span><span class="h3-api-name">Gemini</span>
        </div>
        <div class="h3-api-item" id="dotC">
          <span class="h3-api-dot"></span><span class="h3-api-name">Claude</span>
        </div>
        <div class="h3-api-item" id="dotO">
          <span class="h3-api-dot"></span><span class="h3-api-name">GPT-4o</span>
        </div>
      </div>
    </div>
    <button class="h-btn" onclick="openKeyModal()">⚙ 설정</button>
  </div>
</header>

<!-- 히어로 -->
<section class="hero">
  <div class="hero-eyebrow">✦ Naver Powerlink · AI Copy Generator · Powered by Claude × Gemini × GPT-4o</div>
  <h1><em>AI가 클릭률 높은 파워링크 소재</em>를 자동으로 만들어 드립니다</h1>
  <p class="hero-sub"><strong>제목 30개 · 설명 10개</strong> 자동 생성 &nbsp;·&nbsp; 마케터 AI 분석 리포트 &nbsp;·&nbsp; 실시간 네이버 미리보기</p>
</section>

<div id="apiKeyBanner">
  <span>⚠️ API Key를 설정해주세요.</span>
  <button onclick="openKeyModal()" style="background:rgba(245,158,11,.2);border:1px solid rgba(245,158,11,.4);border-radius:5px;padding:3px 10px;font-size:11px;font-weight:700;cursor:pointer;font-family:inherit;color:var(--amber);margin-left:8px">🔑 설정하기</button>
</div>

<main class="app-main">

  <!-- ① 입력 패널 (sticky) -->
  <div class="sticky-panel">
    <!-- 상품 정보 입력창 헤더 — input-card 밖 -->
    <div class="section-header">
      <div class="section-label">상품 정보 입력창</div>
      <div class="section-div"></div>
    </div>
    <div class="input-card">
      <div class="pbar-strip">
        <div class="pbar-track"><div class="pbar-fill" id="pbarFill"></div></div>
        <div class="pbar-steps">
          <div class="pbar-step" id="pg1">
            <div class="pstep-dot"><span class="pstep-num">1</span><svg class="pstep-check" viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div class="pstep-lbl">상품 분석</div>
          </div>
          <div class="pbar-step" id="pg2">
            <div class="pstep-dot"><span class="pstep-num">2</span><svg class="pstep-check" viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div class="pstep-lbl">소재 작성</div>
          </div>
          <div class="pbar-step" id="pg3">
            <div class="pstep-dot"><span class="pstep-num">3</span><svg class="pstep-check" viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div class="pstep-lbl">리포트 분석</div>
          </div>
          <div class="pbar-step" id="pg4">
            <div class="pstep-dot"><span class="pstep-num">4</span><svg class="pstep-check" viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div class="pstep-lbl">완료</div>
          </div>
        </div>
        <div class="pbar-msg" id="pbarMsg">소재 생성 준비 완료</div>
      </div>

      

      <!-- 메인 입력 레이아웃: 옵션B 3+1 그리드 -->
      <div>

          <!-- 옵션B 레이아웃: 3컬럼 + 05패널(2행 span) -->
          <div class="input-grid-b">

            <!-- 01+02: 상품명 + 타겟 -->
            <div class="input-col" style="border-top:2px solid rgba(3,199,90,.55)">
              <div class="icol-head"><span class="icol-num icol-num-1">01</span><div><div class="icol-title">상품명<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">네이버 검색에 노출되는 핵심 키워드를 포함하세요<br><span style="color:rgba(3,199,90,.8)">예) 국산 냉장 블루베리 1kg 당일수확</span></span></span> <span class="badge-req">필수</span></div></div></div>
              <textarea class="inp inp-ta" id="productName" rows="3" oninput="this.classList.remove('empty-req');this.closest('.input-col')?.classList.remove('req-error')" placeholder=""></textarea>
              <div class="icol-head" style="margin-top:8px"><span class="icol-num icol-num-2">02</span><div><div class="icol-title">타겟 고객<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">광고를 보여줄 주요 고객층을 입력하세요<br><span style="color:rgba(3,199,90,.8)">예) 30대 직장인 여성, 소상공인</span></span></span> <span class="badge-opt">선택</span></div></div></div>
              <input type="text" class="inp" id="target" placeholder="" />
            </div>

            <!-- 03: 광고 내용 -->
            <div class="input-col" style="border-top:2px solid rgba(180,60,255,.55)">
              <div class="icol-head"><span class="icol-num icol-num-3">03</span><div><div class="icol-title">광고에 넣고 싶은 내용<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">강조하고 싶은 특징·혜택·가격 포인트<br><span style="color:rgba(3,199,90,.8)">예) 당일배송, 무료 증정품, 10년 AS 보장</span></span></span> <span class="badge-opt">선택</span></div></div></div>
              <div id="featSuggestWrap" style="display:none">
                <div class="feat-suggest-lbl" id="featSuggestLbl">💡 AI 추천</div>
                <div class="feat-suggest" id="featSuggest"></div>
              </div>
              <div class="feat-slots" id="featSlots">
                <div class="feat-slot"><span class="feat-slot-num">1</span><input type="text" placeholder="" /><button class="feat-slot-del" onclick="removeSlot(this)">✕</button></div>
                <div class="feat-slot"><span class="feat-slot-num">2</span><input type="text" placeholder="" /><button class="feat-slot-del" onclick="removeSlot(this)">✕</button></div>
                <div class="feat-slot"><span class="feat-slot-num">3</span><input type="text" placeholder="" /><button class="feat-slot-del" onclick="removeSlot(this)">✕</button></div>
              </div>
              <button class="feat-add-btn" id="featAddBtn" onclick="addSlot()">+ 항목 추가</button>
            </div>

            <!-- 04: 이미지 -->
            <div class="input-col" style="border-top:2px solid rgba(255,150,0,.55)">
              <div class="icol-head"><span class="icol-num icol-num-4">04</span><div><div class="icol-title">상세페이지 이미지<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">AI가 이미지를 직접 보고 광고 포인트를 추출해요<br><span style="color:rgba(3,199,90,.8)">GPT-4o가 상품 특징을 자동 분석합니다</span></span></span> <span class="badge-opt">선택</span></div></div></div>
              <div class="upload-zone" id="uploadZone">
                <input type="file" id="fileInput" accept="image/*" multiple onchange="onFile(event)" />
                <div class="upl-icon">🖼️</div>
                <div class="upl-text">드래그 또는 클릭 (최대 3장)</div>
                <div class="upl-count" id="uplCount" style="display:none"></div>
              </div>
              <div class="img-grid" id="imgGrid"></div>
              <div id="costCurrent" style="display:none;font-size:11px;color:var(--g);margin-top:5px;font-weight:600;text-align:center">
                📎 <span id="costImgCnt">0</span>장 등록됨
              </div>
            </div>

            <!-- 05: 분석 패널 (2행 span) -->
            <div class="input-col col-analysis analysis-panel-tall" style="grid-row:span 2">
              <div class="icol-head"><span class="icol-num icol-num-5">05</span><div><div class="icol-title">마케터 분석 리포트<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">소재 생성 후 Gemini AI가 자동으로<br>클릭률·전략·개선안을 분석해드려요</span></span> <span class="badge-auto">자동</span></div></div></div>
              <div class="analysis-status" id="analysisSideStatus" style="display:none"></div>

              <!-- ★ 통합 분석 패널 -->
              <div id="apPanel" style="padding:12px 14px 4px">

                <!-- 헤더 -->
                <div class="ap-unified-header">
                  <div class="ap-idle-logo" style="width:30px;height:30px;flex-shrink:0">
                    <svg width="22" height="22" viewBox="0 0 28 28" fill="none">
                      <path d="M14 2C14 8.627 8.627 14 2 14C8.627 14 14 19.373 14 26C14 19.373 19.373 14 26 14C19.373 14 14 8.627 14 2Z" fill="url(#gstarU)"/>
                      <defs><linearGradient id="gstarU" x1="2" y1="2" x2="26" y2="26" gradientUnits="userSpaceOnUse"><stop stop-color="#03C75A"/><stop offset="1" stop-color="#0066FF"/></linearGradient></defs>
                    </svg>
                    <div class="ap-idle-pulse"></div>
                  </div>
                  <div style="flex:1;min-width:0">
                    <div id="apHeaderTitle" style="font-size:12px;font-weight:700;color:var(--g)">Gemini AI 마케터</div>
                    <div id="apHeaderSub" style="font-size:10px;color:var(--text3);margin-top:1px">소재 생성 후 자동으로 분석을 시작해요</div>
                  </div>
                  <div id="apStatusBadge" class="ap-status-badge">대기</div>
                </div>

                <!-- ★ 실시간 로그 박스 -->
                <div id="apLogBox" class="ap-log-box">
                  <div id="apLogIdle" class="ap-log-idle-txt">분석 로그가 여기에 표시됩니다</div>
                  <div id="apLogStream" style="display:none;font-size:11px;line-height:1.75;color:var(--text2);white-space:pre-wrap;word-break:break-word"></div>
                </div>

                <div class="ap-timer" id="apTimerRow" style="margin-top:8px;display:none">예상 완료까지: <b id="apTimerVal">--</b></div>
              </div><!-- /apPanel -->

              <!-- 3줄 요약 (분석 완료 후 표시) -->
              <div class="analysis-preview" id="analysisSidePreview" style="display:none;margin:0 14px 8px;padding:10px 12px;background:rgba(3,199,90,.05);border:1px solid rgba(3,199,90,.12);border-radius:8px;font-size:12px;line-height:1.8;color:var(--text2)"></div>

              <!-- 전체 리포트 보기 버튼 (아래) -->
              <div style="padding:0 14px 14px">
                <button class="analysis-btn" id="analysisOpenBtn" onclick="openAnalysisModal()" disabled>📄 전체 리포트 보기</button>
              </div>
            </div>

            <!-- 하단 Row2: 금지어 / 시즌 / 어조 -->
            <div class="enhance-col" style="border-top:2px solid rgba(255,77,109,.4)">
              <div class="enhance-head"><span class="enhance-num">06</span><div><div class="enhance-title">금지어 설정<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">광고에 절대 쓰지 않을 단어를 지정해요<br><span style="color:rgba(3,199,90,.8)">예) 최고, 1위, 최저가</span><br><span style="color:rgba(220,232,248,.4)">입력 후 Enter로 추가</span></span></span> <span class="badge-opt">선택</span></div></div></div>
              <div class="enhance-inner">
                <input type="text" class="inp" id="denyInput" placeholder="금지어 입력 후 Enter" onkeydown="addDenyEnter(event)" />
                <div id="denyList" class="deny-list"></div>
              </div>
            </div>
            <div class="enhance-col" style="border-top:2px solid rgba(51,200,170,.4)">
              <div class="enhance-head"><span class="enhance-num">07</span><div><div class="enhance-title">시즌 · 이벤트<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">시즌 키워드를 선택하면 관련 문구가 반영돼요<br><span style="color:rgba(3,199,90,.8)">직접 입력도 가능합니다</span></span></span> <span class="badge-opt">선택</span></div></div></div>
              <div class="enhance-inner">
                <div class="season-chips" id="seasonChips">
                  <button class="schip" onclick="toggleSeason(this)">봄 시즌</button>
                  <button class="schip" onclick="toggleSeason(this)">여름 세일</button>
                  <button class="schip" onclick="toggleSeason(this)">추석</button>
                  <button class="schip" onclick="toggleSeason(this)">연말</button>
                  <button class="schip" onclick="toggleSeason(this)">설날</button>
                  <button class="schip" onclick="toggleSeason(this)">밸런타인</button>
                  <button class="schip" onclick="toggleSeason(this)">어버이날</button>
                </div>
                <input type="text" class="inp" id="eventInput" placeholder="" style="margin-top:5px" />
              </div>
            </div>
            <div class="enhance-col" style="border-top:2px solid rgba(150,100,255,.4)">
              <div class="enhance-head"><span class="enhance-num">08</span><div><div class="enhance-title">광고 어조<span class="tip-wrap"><span class="tip-q">?</span><span class="tip-box">광고의 감성 방향을 설정해요<br><span style="color:rgba(3,199,90,.8)">최대 2개 선택 가능</span><br><span style="color:rgba(220,232,248,.4)">선택할수록 타겟에 맞는 문구가 생성돼요</span></span></span> <span class="badge-opt">선택</span></div></div></div>
              <div class="enhance-inner">
                <div class="tone-grid" id="toneGrid">
                  <button class="tone-btn" onclick="toggleTone(this)" data-tone="긴급·희소성">⚡ 긴급·희소성</button>
                  <button class="tone-btn" onclick="toggleTone(this)" data-tone="신뢰·전문성">🏆 신뢰·전문성</button>
                  <button class="tone-btn" onclick="toggleTone(this)" data-tone="혜택·절약">💰 혜택·절약</button>
                  <button class="tone-btn" onclick="toggleTone(this)" data-tone="감성·공감">💝 감성·공감</button>
                </div>
              </div>
            </div>

          </div><!-- input-grid-b -->

      </div><!-- app-section wrapper -->

      <!-- 생성 버튼 -->
      <div class="input-footer" id="inputFooter">
        <button class="gen-btn ripple-btn" id="genBtn" onclick="generate()">
          <span id="genTxt">✨ 광고 소재 생성하기</span>
        </button>
        <!-- 분석 중 로그 요약 (버튼 옆) -->
        <div class="gen-log-wrap" id="genLogWrap">
          <div class="gen-log-item" id="genLogTxt">Gemini AI 연결 중...</div>
        </div>
        <!-- 분석 중 실시간 표시 패널 -->
        <div id="analyzingLabel" style="display:none" class="analyzing-label">
          <div class="analyzing-bar">
            <span></span><span></span><span></span><span></span><span></span><span></span>
          </div>
          <div class="analyzing-detail">
            <div class="analyzing-phase" id="analyzingPhase">준비 중...</div>
            <div class="analyzing-step" id="analyzingStep">Gemini AI 연결 중</div>
          </div>
          <div class="analyzing-timer-box">
            <div class="analyzing-timer-remain" id="analyzingRemain">--</div>
            <div class="analyzing-timer-lbl" id="analyzingTimerLbl">남음</div>
          </div>
        </div>
        <div class="footer-info" id="footerInfo">Gemini AI · 제목 30개 · 설명 10개 · 무료 API 사용 가능</div>
      </div>

    </div><!-- input-card -->
  </div><!-- sticky-panel -->

  <!-- ② 미리보기 + 소재 모니터 sticky 묶음 -->
  <div id="previewMonitorWrap" style="display:none">

    <!-- 광고 미리보기 -->
    <div id="previewSection">
      <div class="section-header">
        <div class="section-label">광고 미리보기</div>
        <div class="section-div"></div>
        <span class="pv-live" style="font-size:13px">실시간</span>
        <button class="pin-section-btn" id="pinPreviewBtn" onclick="togglePinSection('preview')">
          <span class="pin-icon">📌</span> 고정하기
        </button>
      </div>
      <div class="preview-grid">
        <!-- PC -->
        <div class="pv-card">
          <div class="pv-head"><h4>🖥 PC 미리보기</h4></div>
          <div class="pv-body">
            <div class="naver-ad">
              <div class="naver-ad-inner">
                <div class="naver-ad-header">
                  <div class="naver-ad-logo">S</div>
                  <span class="naver-ad-store">스마트스토어</span>
                  <span style="color:#ddd;font-size:9px">·</span>
                  <span class="naver-ad-url">smartstore.naver.com</span>
                  <span class="naver-ad-badge">광고</span>
                </div>
                <div class="naver-ad-row">
                  <div class="naver-ad-body">
                    <div class="naver-ad-title empty" id="pvPcTitles">제목을 선택하면 표시됩니다</div>
                    <div class="naver-ad-desc empty" id="pvPcDesc">설명을 선택하면 표시됩니다</div>
                    <div class="naver-ad-chips" id="pvPcChips"></div>
                  </div>
                  <div class="naver-ad-thumb" id="pvPcThumb">🏪</div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <!-- 모바일 -->
        <div class="pv-card">
          <div class="pv-head"><h4>📱 모바일 미리보기</h4></div>
          <div class="pv-body">
            <div class="naver-mob-ad">
              <div class="naver-mob-ad-inner" style="padding:0;min-height:32px">
                <div id="pvMobTitleList">
                  <div class="mob-ad-empty">
                    <div class="naver-mob-meta"><div class="naver-mob-logo">S</div><span class="naver-mob-store">스마트스토어</span><span class="naver-mob-badge">광고</span></div>
                    <div class="naver-mob-title empty">제목을 선택하면 표시됩니다</div>
                    <div class="naver-mob-desc empty">설명을 선택하면 표시됩니다</div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- 광고 소재 모니터 (원래 모습 복원 — sticky 안에서 항상 노출) -->
    <div id="monitorSection">
      <div class="section-header" style="margin-top:8px">
        <div class="section-label">광고 소재 모니터</div>
        <div class="section-div"></div>
        <button class="pin-section-btn" id="pinMonitorBtn" onclick="togglePinSection('monitor')">
          <span class="pin-icon">📌</span> 고정하기
        </button>
      </div>
      <div class="status-board">
        <!-- 1행: 선택 현황 -->
        <div class="sb-row-select">
          <div class="sb-sel-box sb-title">
            <div class="sb-sel-icon">📋</div>
            <div class="sb-sel-info">
              <div class="sb-sel-label">제목 선택</div>
              <div class="sb-sel-count">
                <span class="sb-sel-num" id="sbTitleNum">0</span>
                <span class="sb-sel-max">/ 15개</span>
              </div>
              <div class="sb-bar"><div class="sb-bar-fill sb-title-fill" id="sbTitleBar" style="width:0%"></div></div>
            </div>
          </div>
          <div class="sb-sel-box sb-desc">
            <div class="sb-sel-icon">📝</div>
            <div class="sb-sel-info">
              <div class="sb-sel-label">설명 선택</div>
              <div class="sb-sel-count">
                <span class="sb-sel-num" id="sbDescNum">0</span>
                <span class="sb-sel-max">/ 4개</span>
              </div>
              <div class="sb-bar"><div class="sb-bar-fill sb-desc-fill" id="sbDescBar" style="width:0%"></div></div>
            </div>
          </div>
        </div>
        <div class="sb-divider"></div>
        <!-- 2행: 고정 현황 -->
        <div class="sb-row-pin">
          <div class="sb-pin-box sb-t1" id="sbPinT1">
            <div class="sb-pin-label">제목 1 고정</div>
            <div class="sb-pin-num" id="sbPinT1Num">0</div>
            <div class="sb-pin-sub" id="sbPinT1Sub">없음</div>
          </div>
          <div class="sb-pin-box sb-t2" id="sbPinT2">
            <div class="sb-pin-label">제목 2 고정</div>
            <div class="sb-pin-num" id="sbPinT2Num">0</div>
            <div class="sb-pin-sub" id="sbPinT2Sub">없음</div>
          </div>
          <div class="sb-pin-box sb-t3" id="sbPinT3">
            <div class="sb-pin-label">제목 3 고정</div>
            <div class="sb-pin-num" id="sbPinT3Num">0</div>
            <div class="sb-pin-sub" id="sbPinT3Sub">없음</div>
          </div>
          <div class="sb-pin-box sb-d1" id="sbPinD1">
            <div class="sb-pin-label">설명 1 고정</div>
            <div class="sb-pin-num" id="sbPinD1Num">0</div>
            <div class="sb-pin-sub" id="sbPinD1Sub">없음</div>
          </div>
          <div class="sb-pin-box sb-d2" id="sbPinD2">
            <div class="sb-pin-label">설명 2 고정</div>
            <div class="sb-pin-num" id="sbPinD2Num">0</div>
            <div class="sb-pin-sub" id="sbPinD2Sub">없음</div>
          </div>
        </div>
        <div class="sb-divider"></div>
        <!-- 선택 목록 -->
        <div class="sb-lists">
          <div class="sb-list-col">
            <div class="sb-list-head">
              선택된 제목 <span class="sel-cnt" id="sTCnt">0개</span>
              <button class="more-sel-btn" id="moreSelBtn" onclick="openSelModal()" style="display:none">
                더보기 <span class="cnt-badge" id="moreTotalCnt">0</span>
              </button>
            </div>
            <div id="sTList"><div class="sel-empty">선택 없음</div></div>
          </div>
          <div class="sb-list-col">
            <div class="sb-list-head">선택된 설명 <span class="sel-cnt" id="sDCnt">0개</span></div>
            <div id="sDList"><div class="sel-empty">선택 없음</div></div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /previewMonitorWrap -->

  <!-- ③ 광고 소재 (아래) -->
  <div class="section-header" style="margin-top:14px">
    <div class="section-label">광고 소재</div>
    <div class="section-div"></div>
    <button id="clearAllBtn" class="clear-all-btn" onclick="clearAllSelection()">✕ 전체 취소</button>
    <button onclick="generate()" class="refresh-btn">🔄 새로고침</button>
  </div>
  <div class="result-card">
    <div id="emptyState" class="empty">
      <div class="empty-icon">✦</div>

    </div>
    <!-- analysisBody: hidden buffer for modal (not shown in main UI) -->
    <div id="analysisBody" style="display:none"></div>
    <div id="resultWrap" style="display:none">
      <!-- 제목 3컬럼 가로 나열 -->
      <div class="result-titles-3col">
        <!-- 그룹 1 -->
        <div class="rc-title-group">
          <div class="rc-head">
            <span class="tg-dot tg1"></span>
            <span class="rc-head-label" style="color:#03C75A">제목 1 위치 추천</span>
            <span class="rc-sel-count" id="tSelBadge" style="display:none"><span id="tSelNum">0</span>개 선택</span>
            <span class="sel-limit-badge" id="tLimitBadge">0/15</span>
            <span class="tg-sub" style="margin-left:auto">광고 첫 번째 제목에 최적</span>
          </div>
          <div id="titleGroup1"></div>
        </div>
        <!-- 그룹 2 -->
        <div class="rc-title-group">
          <div class="rc-head">
            <span class="tg-dot tg2"></span>
            <span class="rc-head-label" style="color:#3385ff">제목 2 위치 추천</span>
            <span class="tg-sub" style="margin-left:auto">광고 두 번째 제목에 최적</span>
          </div>
          <div id="titleGroup2"></div>
        </div>
        <!-- 그룹 3 -->
        <div class="rc-title-group">
          <div class="rc-head">
            <span class="tg-dot tg3"></span>
            <span class="rc-head-label" style="color:#ff9800">제목 3 위치 추천</span>
            <span class="tg-sub" style="margin-left:auto">광고 세 번째 제목에 최적</span>
          </div>
          <div id="titleGroup3"></div>
        </div>
      </div>
      <!-- 설명 2컬럼 -->
      <div class="rc-desc-2col">
        <!-- 설명 추천 1 -->
        <div class="rc-desc-group" style="border-right:1px solid var(--border)">
          <div class="rc-head">
            <span class="tg-dot tg1" style="background:#03C75A"></span>
            <span class="rc-head-label" style="color:#03C75A">설명 1번 추천</span>
            <span class="rc-sel-count" id="dSelBadge" style="display:none"><span id="dSelNum">0</span>개 선택</span>
            <span class="sel-limit-badge" id="dLimitBadge">0/4</span>
            <span class="tg-sub" style="margin-left:auto">설명 첫 번째 자리</span>
          </div>
          <div class="rc-desc-area" id="descGroup1"></div>
        </div>
        <!-- 설명 추천 2 -->
        <div class="rc-desc-group">
          <div class="rc-head">
            <span class="tg-dot tg2" style="background:#3385ff"></span>
            <span class="rc-head-label" style="color:#3385ff">설명 2번 추천</span>
            <span class="tg-sub" style="margin-left:auto">설명 두 번째 자리</span>
          </div>
          <div class="rc-desc-area" id="descGroup2"></div>
        </div>
      </div>
      <!-- badge hidden spans -->
      <span id="tBadge" style="display:none">0</span>
      <span id="dBadge" style="display:none">0</span>
    </div>
  </div>



<!-- ══ 더보기 모달 ══ -->
<div class="sel-modal-overlay" id="selModalOverlay" onclick="closeSelModal(event)">
  <div class="sel-modal">
    <div class="sel-modal-head">
      <h3>✦ 선택한 광고 소재</h3>
      <span id="selModalTotal" style="font-size:12px;color:rgba(220,232,248,.4)">제목 0개 · 설명 0개</span>
      <button class="sel-modal-close" onclick="closeSelModal()">✕</button>
    </div>
    <div class="sel-modal-body">
      <div class="sel-modal-col">
        <div class="sel-modal-col-title">제목 <span class="col-cnt" id="selModalTitleCnt">0개</span></div>
        <div id="selModalTitles"><div class="sel-modal-empty">아직 선택된 제목이 없어요</div></div>
      </div>
      <div class="sel-modal-col">
        <div class="sel-modal-col-title">설명 <span class="col-cnt" id="selModalDescCnt">0개</span></div>
        <div id="selModalDescs"><div class="sel-modal-empty">아직 선택된 설명이 없어요</div></div>
      </div>
    </div>
    <div class="sel-modal-footer">
      <span class="sel-modal-footer-info" id="selModalFooterInfo">제목과 설명을 선택하면 여기서 한눈에 볼 수 있어요</span>
      <button class="sel-modal-copy-all" onclick="copyAllSelected()">📋 전체 복사</button>
    </div>
  </div>
</div>

</main>

<script>



// ── 상태
const S = { titles:[], descs:[], kws:[], selT:new Set(), selD:new Set(), imgs:[] };
// 핀 저장소 (render() 재실행 시 값 유지)
const pinData = {};    // {titleIdx: '1'|'2'|'3'|''}
const descPinData = {}; // {descIdx: '1'|'2'|''}

// ── API Key 관리
let API_KEY    = localStorage.getItem('gemini_key')  || '';
let CLAUDE_KEY = localStorage.getItem('claude_key')  || '';
let OPENAI_KEY = localStorage.getItem('openai_key')  || '';


// ── API 상태 도트 업데이트
function updateApiDots() {
  const dG = document.getElementById('dotG');
  const dC = document.getElementById('dotC');
  const dO = document.getElementById('dotO');
  // 설정됨→초록(on), 미설정→빨간불(off)
  if(dG) dG.className = 'h3-api-item' + (API_KEY    ? ' on' : '');
  if(dC) dC.className = 'h3-api-item' + (CLAUDE_KEY ? ' on' : '');
  if(dO) dO.className = 'h3-api-item' + (OPENAI_KEY ? ' on' : '');

  // 기존 단일 도트 호환
  const dot = document.getElementById('claudeDot');
  if(dot) {
    dot.style.background = API_KEY ? '#03C75A' : '#ff4d6d';
    dot.style.boxShadow  = API_KEY ? '0 0 8px rgba(3,199,90,.6)' : '0 0 8px rgba(255,77,109,.6)';
    dot.style.animation  = API_KEY ? '' : 'pulse 1.5s ease infinite';
  }
}

window.addEventListener('DOMContentLoaded', () => {
  if (API_KEY && API_KEY.length > 5) {
    updateKeyHeader(true);
  } else {
    showApiKeyBanner();
  }
  // 저장된 Claude/OpenAI 키도 로드
  if (!CLAUDE_KEY) CLAUDE_KEY = localStorage.getItem('claude_key') || '';
  if (!OPENAI_KEY) OPENAI_KEY = localStorage.getItem('openai_key') || '';
  updateApiDots();
});

function showApiKeyBanner() {
  const banner = document.getElementById('apiKeyBanner');
  if (banner) banner.style.display = 'flex';
}
function hideApiKeyBanner() {
  const banner = document.getElementById('apiKeyBanner');
  if (banner) banner.style.display = 'none';
}


function updateConfirmBtn() {
  const inp = document.getElementById('modalKey');
  const ck = inp.value.trim();
  const btn = document.getElementById('keyConfirmBtn');
  // 마스킹 상태도 저장 가능 (기존 키 유지)
  const ok = ck.length >= 5 || inp.dataset.masked === 'true';
  btn.disabled = !ok;
  btn.classList.toggle('ready', ok);
}

function onKeyInput() {
  const geminiVal = (document.getElementById('modalKeyGemini')?.value||'').trim();
  const btn = document.getElementById('keyConfirmBtn');
  if (btn) btn.disabled = !geminiVal || geminiVal.length < 5;
}


function toggleModalKey() {
  const el = document.getElementById('modalKey');
  const iconOn  = document.getElementById('eyeIconOn');
  const iconOff = document.getElementById('eyeIconOff');

  if (el.dataset.masked === 'true') {
    // 마스킹 상태 → 실제 키 보여주기
    el.type = 'text';
    el.value = API_KEY || '';
    el.dataset.masked = 'false';
    el.dataset.revealed = 'true';
    if(iconOn)  iconOn.style.display = 'none';
    if(iconOff) iconOff.style.display = '';
  } else if (el.dataset.revealed === 'true') {
    // 실제 키 표시 중 → 다시 마스킹
    el.type = 'password';
    el.value = '●'.repeat(Math.min((API_KEY||'').length, 32));
    el.dataset.masked = 'true';
    el.dataset.revealed = 'false';
    if(iconOn)  iconOn.style.display = '';
    if(iconOff) iconOff.style.display = 'none';
  } else {
    // 일반 입력 중 토글
    const isHidden = el.type === 'password';
    el.type = isHidden ? 'text' : 'password';
    if(iconOn)  iconOn.style.display  = isHidden ? 'none' : '';
    if(iconOff) iconOff.style.display = isHidden ? '' : 'none';
  }
}

function confirmKey() {
  const geminiVal = (document.getElementById('modalKeyGemini')?.value||'').trim();
  const claudeVal = (document.getElementById('modalKeyClaude')?.value||'').trim();
  const openaiVal = (document.getElementById('modalKeyOpenai')?.value||'').trim();
  if (!geminiVal || geminiVal.length < 5) return;

  API_KEY = geminiVal;
  localStorage.setItem('gemini_key', geminiVal);

  if (claudeVal && claudeVal.length > 5) {
    CLAUDE_KEY = claudeVal;
    localStorage.setItem('claude_key', claudeVal);
  }
  if (openaiVal && openaiVal.length > 5) {
    OPENAI_KEY = openaiVal;
    localStorage.setItem('openai_key', openaiVal);
  }
  updateKeyHeader(true);
  updateApiDots();
  document.getElementById('keyModal').classList.add('hidden');
  hideApiKeyBanner();
}

function openKeyModal() {
  // 기존 저장된 키 미리 채우기
  const gEl = document.getElementById('modalKeyGemini');
  const cEl = document.getElementById('modalKeyClaude');
  const oEl = document.getElementById('modalKeyOpenai');
  if(gEl) gEl.value = API_KEY    || '';
  if(cEl) cEl.value = CLAUDE_KEY || '';
  if(oEl) oEl.value = OPENAI_KEY || '';
  onKeyInput();
  document.getElementById('keyModal').classList.remove('hidden');
  if(gEl) gEl.focus();
}

function updateKeyHeader(ok) {
  updateApiDots();
  hideApiKeyBanner();
}

// ── 이미지 업로드 (최대 10장, 자동 압축)
const MAX_IMGS = 3;
const IMG_MAX_PX = 800;   // 최대 가로/세로
const IMG_QUALITY = 0.65; // JPEG 품질 (65%)

function compressImage(file) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onload = ev => {
      const img = new Image();
      img.onload = () => {
        // 리사이즈 계산
        let w = img.width, h = img.height;
        if (w > IMG_MAX_PX || h > IMG_MAX_PX) {
          if (w >= h) { h = Math.round(h * IMG_MAX_PX / w); w = IMG_MAX_PX; }
          else        { w = Math.round(w * IMG_MAX_PX / h); h = IMG_MAX_PX; }
        }
        const canvas = document.createElement('canvas');
        canvas.width = w; canvas.height = h;
        canvas.getContext('2d').drawImage(img, 0, 0, w, h);
        const dataUrl = canvas.toDataURL('image/jpeg', IMG_QUALITY);
        const b64 = dataUrl.split(',')[1];
        const kb = Math.round(b64.length * 0.75 / 1024);
        resolve({ b64, type: 'image/jpeg', name: file.name, url: dataUrl, kb });
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  });
}

function onFile(e) {
  const files = Array.from(e.target.files).slice(0, MAX_IMGS - S.imgs.length);
  if (!files.length) return;
  files.forEach(async f => {
    const compressed = await compressImage(f);
    S.imgs.push(compressed);
    renderImgGrid();
  });
  e.target.value = '';
}
function updateCost() {
  const n = S.imgs.length;
  const el = document.getElementById('costCurrent');
  if (n === 0) { if(el) el.style.display='none'; return; }
  if(el) el.style.display = 'block';
  const cnt = document.getElementById('costImgCnt');
  if(cnt) cnt.textContent = n;
}

function removeImg(i) {
  S.imgs.splice(i, 1);
  renderImgGrid();
}
function renderImgGrid() {
  const grid = document.getElementById('imgGrid');
  const cnt  = document.getElementById('uplCount');
  const zone = document.getElementById('uploadZone');
  if (S.imgs.length === 0) {
    grid.innerHTML = '';
    cnt.style.display = 'none';
    zone.classList.remove('filled');
    updateCost();
    return;
  }
  zone.classList.add('filled');
  cnt.style.display = 'block';
  cnt.textContent = `${S.imgs.length}장 등록됨`;
  updateCost();
  grid.innerHTML = S.imgs.map((img, i) => `
    <div class="img-thumb">
      <img src="${img.url}" alt="${img.name}" />
      <button class="del-btn" onclick="removeImg(${i})" title="삭제">×</button>
      <span class="img-num">${i+1}</span>
    </div>`).join('');
}



// AI 특징 추천 (3개 제안)
async function suggestFeatures(name, cat, price) {
  if (!API_KEY) return;
  const wrap = document.getElementById('featSuggestWrap');
  const lbl  = document.getElementById('featSuggestLbl');
  const box  = document.getElementById('featSuggest');
  wrap.style.display = 'block';
  lbl.innerHTML = '💡 AI 추천 특징 분석 중... <span class="spin-sm"></span>';
  box.innerHTML = '';
  try {
    const raw = await callGemini(
      `당신은 네이버 파워링크 광고 전문가입니다.
상품 정보를 보고 광고에 써먹을 핵심 특징·강점 3가지를 뽑아주세요.
반드시 JSON 배열만 응답하세요. 예: ["특징1","특징2","특징3"]
각 항목은 15자 이내, 구체적이고 광고 소재에 바로 쓸 수 있는 문구로.`,
      `상품명: ${name}
카테고리: ${cat||'미상'}
가격: ${price||'미상'}`
    );
    const clean = raw.replace(/```json|```/g,'').trim();
    const feats = JSON.parse(clean);
    lbl.textContent = '💡 AI 추천 특징 (클릭하면 슬롯에 추가)';
    box.innerHTML = feats.map((f,i) =>
      `<span class="feat-chip" onclick="addFeatChip(this,'${esc(f)}')" id="fc${i}"><span class="chip-plus">+</span>${esc(f)}</span>`
    ).join('');
  } catch(e) {
    lbl.textContent = '💡 특징을 직접 입력해주세요';
    wrap.style.display = 'none';
  }
}

// 칩 클릭 → 빈 슬롯에 추가
function addFeatChip(chipEl, text) {
  if (chipEl.classList.contains('used')) return;
  const slots = document.querySelectorAll('#featSlots .feat-slot input');
  const empty = [...slots].find(el => !el.value.trim());
  if (!empty) { alert('슬롯이 모두 차있어요. 기존 내용을 지우고 다시 시도해주세요.'); return; }
  empty.value = text;
  chipEl.classList.add('used');
  chipEl.querySelector('.chip-plus').textContent = '✓';
}

// 슬롯 삭제 (X 클릭)
function removeSlot(btn) {
  const slot = btn.closest('.feat-slot');
  slot.remove();
  reNumberSlots();
  updateAddBtn();
  // 연결된 칩 복원
  const allVals = [...document.querySelectorAll('#featSlots .feat-slot input')].map(el=>el.value.trim());
  document.querySelectorAll('#featSuggest .feat-chip').forEach(c => {
    const chipVal = c.textContent.replace(/^[+✓]/,'').trim();
    if (!allVals.includes(chipVal)) {
      c.classList.remove('used');
      c.querySelector('.chip-plus').textContent = '+';
    }
  });
}

// 슬롯 번호 재정렬
function reNumberSlots() {
  document.querySelectorAll('#featSlots .feat-slot').forEach((slot, i) => {
    slot.querySelector('.feat-slot-num').textContent = i + 1;
  });
}

// + 버튼 상태 업데이트
function updateAddBtn() {
  const cnt = document.querySelectorAll('#featSlots .feat-slot').length;
  const btn = document.getElementById('featAddBtn');
  if (!btn) return;
  btn.disabled = cnt >= 6;
  btn.textContent = cnt >= 6 ? '최대 6개까지 추가 가능해요' : '+ 항목 추가';
}

// 슬롯 추가
function addSlot() {
  const slots = document.getElementById('featSlots');
  const cnt = slots.querySelectorAll('.feat-slot').length;
  if (cnt >= 6) return;
  const div = document.createElement('div');
  div.className = 'feat-slot';
  div.innerHTML = `<span class="feat-slot-num">${cnt+1}</span><input type="text" placeholder="강조하고 싶은 내용을 입력하세요" /><button class="feat-slot-del" onclick="removeSlot(this)">✕</button>`;
  slots.appendChild(div);
  div.querySelector('input').focus();
  updateAddBtn();
}








// ═══════════════════════════════════════════════════════════
// Claude Haiku API — 광고 문구 생성 전담
// ═══════════════════════════════════════════════════════════
async function callClaude(sys, userContent, onChunk, maxTokens) {
  if (!CLAUDE_KEY) return callGemini(sys, userContent, onChunk, maxTokens); // fallback
  const tokens = maxTokens || 1200;
  const ctrl = new AbortController();
  const tid  = setTimeout(() => ctrl.abort(), 90000);
  let messages;
  if (typeof userContent === 'string') {
    messages = [{ role:'user', content: userContent }];
  } else {
    const content = [];
    userContent.filter(x=>x.type==='image').forEach(img=>{
      content.push({type:'image',source:{type:'base64',media_type:img.source?.media_type||img.type||'image/jpeg',data:img.source?.data||img.b64}});
    });
    const t = userContent.find(x=>x.type==='text');
    if(t) content.push({type:'text',text:t.text});
    messages = [{role:'user',content}];
  }
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST', signal:ctrl.signal,
      headers:{'Content-Type':'application/json','x-api-key':CLAUDE_KEY,'anthropic-version':'2023-06-01'},
      body:JSON.stringify({model:'claude-haiku-4-5-20251001',max_tokens:tokens,system:sys||'',messages})
    });
    clearTimeout(tid);
    if(!res.ok){
      const e=await res.json();
      if(res.status===401) throw new Error('Claude API 키 오류. console.anthropic.com 확인해주세요.');
      if(res.status===429) throw new Error('Claude 한도 초과. 잠시 후 재시도해주세요.');
      throw new Error(e.error?.message||'Claude API 오류');
    }
    const d = await res.json();
    const text = d.content?.[0]?.text||'';
    if(typeof onChunk==='function') onChunk(text,text);
    return text;
  } catch(err){
    clearTimeout(tid);
    if(err.name==='AbortError') throw new Error('Claude 응답 시간 초과.');
    throw err;
  }
}

// ═══════════════════════════════════════════════════════════
// GPT-4o Vision — 이미지 분석 전담 (실패해도 계속 진행)
// ═══════════════════════════════════════════════════════════
async function analyzeWithGPT4o(imgs) {
  if (!OPENAI_KEY || !imgs || !imgs.length) return null;
  const ctrl = new AbortController();
  const tid  = setTimeout(() => ctrl.abort(), 60000);
  const imgContent = imgs.slice(0,5).map(img=>({
    type:'image_url',
    image_url:{url:`data:${img.type||'image/jpeg'};base64,${img.b64}`,detail:'low'}
  }));
  const prompt = `이 상품 이미지를 분석해서 네이버 파워링크 광고에 쓸 정보를 추출해주세요.
1. 상품 종류/카테고리
2. 주요 특징 3~5가지 (소재·색상·기능·디자인 등)
3. 광고 핵심 셀링포인트 2~3개
4. 추정 타겟 고객층
간결하게 한국어로 (총 200자 이내)`;
  try {
    const res = await fetch('https://api.openai.com/v1/chat/completions',{
      method:'POST', signal:ctrl.signal,
      headers:{'Content-Type':'application/json','Authorization':`Bearer ${OPENAI_KEY}`},
      body:JSON.stringify({model:'gpt-4o',max_tokens:400,
        messages:[{role:'user',content:[...imgContent,{type:'text',text:prompt}]}]})
    });
    clearTimeout(tid);
    if(!res.ok){ console.warn('GPT-4o 오류:', res.status); return null; }
    const d = await res.json();
    return d.choices?.[0]?.message?.content || null;
  } catch(err){
    clearTimeout(tid);
    console.warn('GPT-4o 분석 건너뜀:', err.message);
    return null;
  }
}

// ── Gemini API 호출 (마케터 분석 전담)
async function callGemini(sys, userContent, onChunk, maxTokens) {
  // userContent는 string 또는 array (이미지 포함)
  let parts = [];
  if (typeof userContent === 'string') {
    parts = [{ text: sys + '\n\n' + userContent }];
  } else {
    const textItem = userContent.find(c => c.type === 'text');
    const imgItems = userContent.filter(c => c.type === 'image');
    parts = [
      { text: sys },
      ...imgItems.map(c => ({
        inlineData: { mimeType: c.source.media_type, data: c.source.data }
      })),
      { text: textItem?.text || '' }
    ];
  }

  const tokens = maxTokens || 900;
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), tokens > 1000 ? 120000 : 90000);
  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

  try {
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      signal: controller.signal,
      body: JSON.stringify({
        contents: [{ role: 'user', parts }],
        generationConfig: { maxOutputTokens: tokens, temperature: 0.5 }
      })
    });
    if (!res.ok) {
      clearTimeout(timeoutId);
      const e = await res.json();
      const msg = e.error?.message || 'API 오류';
      if (msg.includes('API_KEY_INVALID') || msg.includes('API key')) throw new Error('API Key가 유효하지 않아요. aistudio.google.com에서 다시 발급해주세요.');
      if (msg.includes('quota') || msg.includes('RESOURCE_EXHAUSTED')) throw new Error('오늘 무료 한도를 초과했어요. 내일 다시 시도해주세요.');
      throw new Error(msg);
    }
    const d = await res.json();
    clearTimeout(timeoutId);
    const text = d.candidates?.[0]?.content?.parts?.[0]?.text || '';
    // onChunk가 있으면 완성된 텍스트를 한번에 전달 (UI 업데이트용)
    if (typeof onChunk === 'function') onChunk(text, text);
    return text;
  } catch(err) {
    clearTimeout(timeoutId);
    if(err.name === 'AbortError') throw new Error('응답 시간이 초과됐어요. 다시 시도해주세요.');
    throw err;
  }
}

// ── 단계 표시
// 단계별 메시지
const PG_MSGS = {
  '1-active': 'AI가 상품을 분석하고 있어요...',
  '2-active': '광고 소재 20개 + 설명 8개 작성 중...',
  '3-active': '결과를 정리하고 있어요...',
  '3-done':   '완성! 아래에서 소재를 선택해주세요 ✨'
};
const PBAR_WIDTH = {'1-active':5,'1-done':25,'2-active':30,'2-done':50,'3-active':55,'3-done':75,'4-active':80,'4-done':100};

function pg(n, s) {
  const el = document.getElementById('pg'+n);
  if (!el) return;
  el.className = 'pbar-step ' + (s||'');
  // 트래킹 바 너비
  const key = n+'-'+s;
  if (PBAR_WIDTH[key] !== undefined) {
    const fill = document.getElementById('pbarFill');
    if (fill) fill.style.width = PBAR_WIDTH[key] + '%';
  }
  // 메시지
  const msg = PG_MSGS[key];
  if (msg) {
    const el2 = document.getElementById('pbarMsg');
    if (el2) {
      el2.style.opacity = '0';
      setTimeout(() => { el2.textContent = msg; el2.style.opacity = '1'; }, 200);
    }
  }
}

// ── 마케터 분석 리포트 생성
async function generateAnalysis(name, feat, target, titles, descs, imgs) {
  imgs = imgs || [];
  const titleSample = titles.slice(0,5).join(', ');
  const descSample  = descs.slice(0,3).join(' / ');

  // 입력된 항목만 포함
  const inputLines = [`- 상품명: ${name}`];
  if (feat && feat.trim()) inputLines.push(`- 광고 포인트/장점: ${feat}`);
  if (target && target.trim()) inputLines.push(`- 타겟 고객: ${target}`);
  if (imgs.length > 0) inputLines.push(`- 상세페이지 이미지: ${imgs.length}장 첨부됨 (직접 분석할 것)`);
  inputLines.push(`- 생성된 제목 샘플: ${titleSample}`);
  inputLines.push(`- 생성된 설명 샘플: ${descSample}`);

  // 작성 지침 - 입력된 항목만 분석
  const guideLines = [];
  guideLines.push('1. 상품명에서 어떤 광고 포인트를 발견했는지 (구체적으로)');
  if (imgs.length > 0) guideLines.push('2. 첨부된 상세페이지 이미지를 직접 보고 — 어떤 제품인지, 어떤 특징이 보이는지, 이미지에서 발견한 광고 포인트를 구체적으로');
  if (feat && feat.trim()) guideLines.push(`${guideLines.length+1}. 입력된 광고 포인트(${feat})를 어떻게 해석하고 반영했는지`);
  if (target && target.trim()) guideLines.push(`${guideLines.length+1}. 타겟 고객(${target})의 언어·심리를 어떻게 광고 소재에 녹였는지`);
  guideLines.push(`${guideLines.length+1}. 제목 20개를 왜 이런 방향으로 구성했는지 — 어떤 각도들을 선택했고 그 이유`);
  guideLines.push(`${guideLines.length+1}. 설명 12개를 왜 이렇게 썼는지 — 45자 안에 어떤 정보와 감정을 담았는지`);

  // 금지어/시즌/어조 정보 수집
  const denyList = typeof S_DENY !== 'undefined' ? [...S_DENY] : [];
  const seasonUsed = typeof S_SEASON !== 'undefined' ? S_SEASON : '';
  const toneUsed = typeof S_TONE !== 'undefined' ? S_TONE : '';
  const eventUsed = typeof document !== 'undefined' && document.getElementById('eventInput') ? document.getElementById('eventInput').value.trim() : '';
  
  const contextParts = [];
  if(denyList.length) contextParts.push(`금지어 설정: ${denyList.join(', ')}`);
  if(seasonUsed) contextParts.push(`시즌/이벤트: ${seasonUsed}`);
  if(eventUsed) contextParts.push(`이벤트 문구: ${eventUsed}`);
  if(toneUsed) contextParts.push(`광고 어조: ${toneUsed}`);
  const contextStr = contextParts.length ? ('\n\n[광고 세팅 정보]\n' + contextParts.join('\n')) : '';

  // 어조별 구체적 지침
  const toneGuide = toneUsed ? `\n\n[선택된 광고 어조: ${toneUsed}]\n어조 적용 지침:
${toneUsed.includes('urgency') || toneUsed.includes('긴급') ? '- 긴급·희소성 어조: 지금 당장 행동해야 할 이유, 재고 한정·기간 한정 등 희소성 심리 자극 요소가 소재에 어떻게 반영되었는지 분석하세요.' : ''}
${toneUsed.includes('trust') || toneUsed.includes('신뢰') ? '- 신뢰·전문성 어조: 경력·수상·인증·데이터 등 신뢰 근거가 소재에 어떻게 녹아있는지, 전문가 권위를 어떻게 활용했는지 분석하세요.' : ''}
${toneUsed.includes('benefit') || toneUsed.includes('혜택') ? '- 혜택·절약 어조: 구체적 금액·할인율·무료 요소 등 경제적 이득이 소재에 얼마나 명확하게 전달되는지 분석하세요.' : ''}
${toneUsed.includes('emotion') || toneUsed.includes('감성') ? '- 감성·공감 어조: 고객의 감정·고충·바람에 공감하는 표현이 소재에 얼마나 자연스럽게 녹아있는지 분석하세요.' : ''}
${toneUsed.includes('proof') || toneUsed.includes('수치') ? '- 수치·증거 어조: 구체적 숫자·통계·비교 데이터가 소재의 신뢰도와 클릭률에 어떻게 기여하는지 분석하세요.' : ''}
${toneUsed.includes('action') || toneUsed.includes('행동') ? '- 행동유도·직접 어조: 명령형·행동 촉구 표현이 소재에서 얼마나 직접적으로 클릭을 유도하는지 분석하세요.' : ''}`.trim() : '';

  const analysisPrompt = `당신은 네이버 파워링크 광고 전문 마케터입니다.${contextStr}${toneGuide}

[분석 대상 — 아래 데이터만 사용, 없는 정보는 절대 추측 금지]
${inputLines.join('\n')}

⚠️ 절대 금지: 입력되지 않은 정보 추측, 상품명에 없는 특성 언급, 임의 소재 생성

아래 4개 섹션을 <section title="섹션제목">내용</section> 형태로 작성하세요.
각 섹션은 2~3문단, 총 500자 내외로 간결하게. 마크다운 금지. 중요 키워드는 <b>태그.

1. 🔍 상품·소재 분석 — 상품명 키워드 분석, 제목/설명 구성 평가 (2~3문단)
2. ⚡ 클릭률 TOP3 — 실제 생성된 소재 중 3개 직접 인용 + 이유
3. ✍️ 소재 표현 선택 이유 — 주요 표현 3~4개 직접 인용 + 마케팅 근거
4. 💡 개선 권고 — A/B 테스트 2개 제안 (수정 전→후 형태로)

규칙: 마케터 관점 판단은 <em>태그. 섹션별 50~150자 내외.`;

  // 실제 입력 데이터를 userContent에 포함
  const userContent = analysisPrompt;

  // 실시간 분석 로그 - 새 통합 패널 사용
  const idleEl   = document.getElementById('apLogIdle');
  const streamEl = document.getElementById('apLogStream');
  const badge    = document.getElementById('apStatusBadge');
  const headerSub= document.getElementById('apHeaderSub');
  const timerRow = document.getElementById('apTimerRow');

  // 분석 시작 상태 전환
  if(idleEl)   idleEl.style.display  = 'none';
  if(streamEl){ streamEl.style.display = 'block'; streamEl.textContent = ''; }
  if(badge)  { badge.textContent = '분석 중'; badge.className = 'ap-status-badge active'; }
  if(headerSub) headerSub.textContent = '소재 전략 심층 분석 중...';
  if(timerRow)  timerRow.style.display  = 'block';
  const logBox = document.getElementById('apLogBox');
  if(logBox) logBox.classList.add('analyzing');

  // ★ 실시간 단계 로그 — API 대기 중 단계별 표시
  const logLines = [];
  let logDone = false;
  function addLog(msg, color) {
    logLines.push({msg, color:color||null});
    if(streamEl) {
      streamEl.innerHTML = logLines.map(l=>
        l.color
          ? `<div style="color:${l.color};font-weight:600">${l.msg}</div>`
          : `<div>${l.msg}</div>`
      ).join('') + '<span class="ap-stream-cursor"></span>';
      const box = document.getElementById('apLogBox');
      if(box) box.scrollTop = box.scrollHeight;
    }
  }

  // 초기 입력 정보 로그
  addLog(`━━ 분석 시작 ━━`, '#03C75A');
  addLog(`📦 상품: ${name}`);
  if(feat) addLog(`✏️ 포인트: ${feat.slice(0,25)}...`);
  if(target) addLog(`🎯 타겟: ${target}`);
  addLog(`📋 제목 ${titles.length}개 · 설명 ${descs.length}개 준비됨`);

  // 단계별 로그 - 2초 간격, 총 ~40초 커버
  const logSteps = [
    {msg:`🔍 제목 ${titles.length}개 키워드 패턴 추출 중...`},
    {msg:`📊 상품명에서 핵심 검색어 분리 중...`},
    {msg:`⚡ 클릭률 높은 제목 3개 선별 중...`},
    {msg:`🧠 소비자 심리 반영도 평가 중...`},
    {msg:`📝 설명 ${descs.length}개 메시지 전달력 분석 중...`},
    {msg:`🔎 CTA(클릭유도) 표현 효과 측정 중...`},
    {msg:`💡 A/B 테스트 가설 수립 중...`},
    {msg:`📌 소재 표현 선택 이유 정리 중...`},
    {msg:`✍️ 개선 권고안 초안 작성 중...`},
    {msg:`🔄 마케터 관점 최종 검토 중...`},
    {msg:`📄 리포트 포맷 구성 중...`},
    {msg:`⏳ Gemini AI 응답 대기 중... (30~60초 소요)`, color:'#f59e0b'},
    {msg:`⏳ 계속 분석 중입니다...`, color:'#f59e0b'},
    {msg:`⏳ 거의 다 됐어요. 잠시만 기다려주세요`, color:'#f59e0b'},
  ];
  let stepIdx = 0;
  const logTimer = setInterval(()=>{
    if(logDone) return clearInterval(logTimer);
    if(stepIdx < logSteps.length){
      const s = logSteps[stepIdx++];
      addLog(s.msg, s.color||null);
    } else {
      // 루프: 마지막 대기 메시지 반복
      addLog(`⏳ AI가 열심히 작성 중...`, '#f59e0b');
    }
  }, 2200);

  function onAnalysisChunk(full) {
    logDone = true;
    clearInterval(logTimer);
    if(!streamEl) return;
    addLog(`━━ 분석 완료 · 리포트 생성됨 ━━`, '#03C75A');
    const clean = full
      .replace(/<section[^>]*title="([^"]*)">/g, '\n━━ $1 ━━\n')
      .replace(/<\/section>/g, '\n')
      .replace(/<b>|<\/b>|<em>|<\/em>/g, '')
      .replace(/\n{3,}/g, '\n\n')
      .trim();
    // 완성된 분석 내용을 로그박스에 미리보기로 표시
    if(streamEl){
      streamEl.innerHTML = logLines.map(l=>
        l.color
          ? `<div style="color:${l.color};font-weight:600">${l.msg}</div>`
          : `<div>${l.msg}</div>`
      ).join('')+`<div style="margin-top:6px;padding-top:6px;border-top:1px solid rgba(255,255,255,.08);color:var(--text2);white-space:pre-wrap;font-size:10px">${esc(clean).replace(/\n/g,'<br>')}</div>`;
      const box = document.getElementById('apLogBox');
      if(box) box.scrollTop = box.scrollHeight;
    }
    const sectionsDone = (full.match(/<\/section>/g)||[]).length;
    const msgs = ['🔍 소재 분석 중...', '⚡ TOP3 선정 중...', '💡 개선 권고 작성 중...'];
    if(msgs[sectionsDone]) {
      if(headerSub) headerSub.textContent = msgs[sectionsDone];
      setGenLog(msgs[sectionsDone]);
    }
  }

  const raw = await callGemini('', userContent, onAnalysisChunk, 2500);
  logDone = true;
  clearInterval(logTimer);

  // 섹션 파싱
  const sections = [...raw.matchAll(/<section title="([^"]+)">([\s\S]*?)<\/section>/g)];
  if (!sections.length) {
    const cleaned2 = raw.replace(/\*\*([^*]+)\*\*/g,'<b>$1</b>').replace(/\*([^*]+)\*/g,'<em>$1</em>');
    const escaped = cleaned2.replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>');
    return `<div class="analysis-section-content"><p>${escaped}</p></div>`;
  }
  return sections.map(([,title,body]) => {
    // 넘버링 목록 → 줄바꿈 처리
    const cleaned = body.trim()
      .replace(/\*\*([^*]+)\*\*/g, '<b>$1</b>')
      .replace(/\*([^*]+)\*/g, '<em>$1</em>');
    // 번호로 시작하는 줄 각각 단락으로
    const lines = cleaned.split('\n').filter(l => l.trim());
    const bodyHtml = lines.map(line => {
      if (/^\d+\.\s/.test(line.trim())) {
        return `<div class="ar-item">${line.trim()}</div>`;
      }
      return `<p>${line}</p>`;
    }).join('');
    return '<div class="analysis-section">'
      + '<div class="analysis-section-title">' + title + '</div>'
      + '<div class="analysis-section-content ar-body">' + bodyHtml + '</div>'
      + '</div>';
  }).join('');
}





// 분석 로그는 실제 AI 출력으로 대체됨

// ── 입력 강화 기능 ──
const S_DENY = new Set(); // 금지어
let S_SEASON = ''; // 선택 시즌
let S_EVENT = '';  // 이벤트
let S_TONE = '';        // 어조 (최대 2개, 쉼표 구분)
let S_TONE_ARR = [];   // 선택된 어조 배열

function toggleTone(btn) {
  const tone = btn.dataset.tone || btn.textContent.trim();
  const idx = S_TONE_ARR.indexOf(tone);
  if(idx >= 0){
    S_TONE_ARR.splice(idx,1);
    btn.classList.remove('on');
  } else {
    if(S_TONE_ARR.length >= 2){
      const first = S_TONE_ARR.shift();
      document.querySelectorAll('#toneGrid .tone-btn').forEach(b=>{
        if((b.dataset.tone||b.textContent.trim())===first) b.classList.remove('on');
      });
    }
    S_TONE_ARR.push(tone);
    btn.classList.add('on');
  }
  S_TONE = S_TONE_ARR.join(' + ');
}
// feat 힌트 제거됨 (선택 항목)

function addDenyEnter(e) {
  if (e.key !== 'Enter') return;
  e.preventDefault();
  const inp = document.getElementById('denyInput');
  const val = inp.value.trim();
  if (!val) return;
  S_DENY.add(val);
  inp.value = '';
  renderDenyList();
}
function renderDenyList() {
  const el = document.getElementById('denyList');
  if (!el) return;
  el.innerHTML = [...S_DENY].map(w =>
    `<span class="deny-tag">${esc(w)}<button class="deny-tag-x" onclick="removeDeny('${w}')">✕</button></span>`
  ).join('');
}
function removeDeny(w) { S_DENY.delete(w); renderDenyList(); }

function toggleSeason(btn) {
  const already = btn.classList.contains('on');
  document.querySelectorAll('#seasonChips .schip').forEach(b => b.classList.remove('on'));
  const eventInp = document.getElementById('eventInput');
  if (!already) {
    btn.classList.add('on');
    S_SEASON = btn.textContent.trim();
    if(eventInp) eventInp.value = S_SEASON;
  } else {
    S_SEASON = '';
    if(eventInp) eventInp.value = '';
  }
}


function switchResultTab(tab) {
  ['t','d'].forEach(t => {
    const btn = document.getElementById('rtab'+t.toUpperCase());
    const pane = document.getElementById('rpane'+t.toUpperCase());
    if (btn) btn.classList.toggle('active', t===tab);
    if (pane) pane.classList.toggle('active', t===tab);
  });
}

function switchPvTab(tab) {}

// ── 유틸
function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#39;')}

// ── Canvas 상품 썸네일 생성
function generateProductThumb(name) {
  const MAP = {
    '냉장고':['#0055AA','#003388','❄️'],'냉동':['#0066CC','#004499','🧊'],
    '에어컨':['#00AACC','#006699','💨'],'세탁기':['#3366CC','#224488','🫧'],
    '건조기':['#AA5500','#883300','🌀'],'디퓨저':['#8833CC','#5511AA','🌿'],
    '향수':['#CC3399','#AA1177','🌸'],'소파':['#7B5A14','#5A3E0A','🛋️'],
    '침대':['#445599','#223377','🛏️'],'책상':['#3A5A1A','#2A4010','🪑'],
    '노트북':['#2A2A2A','#0A0A0A','💻'],'스마트폰':['#1A1A2E','#0A0A1A','📱'],
    '운동':['#AA1111','#880000','🏋️'],'화장품':['#BB3366','#993344','💄'],
    '식품':['#228833','#116622','🍱'],'커피':['#5A2E1A','#3A1A0A','☕'],
    '강아지':['#AA7722','#884400','🐶'],'고양이':['#996633','#774411','🐱'],
    '가방':['#7A3A0A','#5A2A00','👜'],'신발':['#3A3A3A','#1A1A1A','👟'],
    '청소기':['#0055AA','#003388','🧹'],'공기청정기':['#22AACC','#118899','🌬️'],
    '업소용':['#1a3a5c','#0d2035','🏭'],'소상공인':['#0d4a2a','#062a18','🏪'],
    '간냉식':['#0044AA','#002288','❄️'],'냉동고':['#1155AA','#003388','🧊'],
    '주방':['#884400','#553300','🍳'],'밥솥':['#995522','#663311','🍚'],
    '전자레인지':['#222244','#111133','📡'],'오븐':['#663300','#441100','🔥'],
    '믹서':['#116633','#0a4422','🥤'],'정수기':['#006688','#004455','💧'],
    '선풍기':['#336699','#224477','🌀'],'제습기':['#117799','#005566','💧'],
    '가구':['#5A3E14','#3a2a0a','🪑'],'조명':['#888833','#666611','💡'],
    '카메라':['#111111','#000000','📷'],'TV':['#222233','#111122','📺'],
    '스피커':['#333344','#222233','🔊'],'헤드폰':['#222222','#111111','🎧'],
    '골프':['#115522','#0a3318','⛳'],'자전거':['#CC4400','#AA2200','🚴'],
    '등산':['#3A6622','#264411','🏔️'],'수영':['#0066CC','#004499','🏊'],
    '비타민':['#EE8800','#CC6600','💊'],'건강식품':['#228833','#116622','🌿'],
    '마스크':['#888888','#666666','😷'],'의약품':['#CC3333','#AA1111','💊'],
    '유아':['#FF9999','#FF6666','👶'],'장난감':['#FF6600','#CC4400','🧸'],
    '책':['#8B4513','#5C2D0A','📚'],'문구':['#2255AA','#1133AA','✏️'],
    '꽃':['#CC33AA','#AA1188','💐'],'식물':['#228833','#116622','🌱'],
    '펫':['#AA7722','#884400','🐾'],'사료':['#AA8833','#776622','🦴'],
  };
  let bg=['#1a3a5c','#0d2035'], icon='🏪';
  for(const [k,[c1,c2,em]] of Object.entries(MAP)){
    if((name||'').includes(k)){bg=[c1,c2];icon=em;break;}
  }
  const cv=document.createElement('canvas');
  cv.width=cv.height=160;
  const ctx=cv.getContext('2d');
  const grd=ctx.createLinearGradient(0,0,160,160);
  grd.addColorStop(0,bg[0]);grd.addColorStop(1,bg[1]);
  ctx.fillStyle=grd;
  ctx.beginPath();
  if(ctx.roundRect) ctx.roundRect(0,0,160,160,12);
  else ctx.rect(0,0,160,160);
  ctx.fill();
  ctx.font='72px serif';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(icon,80,80);
  return cv.toDataURL();
}

function updatePreviewThumbs() {
  const name = document.getElementById('productName')?.value?.trim() || '';
  if(S.imgs.length) return; // 실제 이미지 있으면 패스
  const url = generateProductThumb(name);
  const pc = document.getElementById('pvPcThumb');
  if(pc) pc.innerHTML = `<img src="${url}" style="width:100%;height:100%;object-fit:cover;border-radius:4px">`;
}

function cpKw(el){ el.textContent && navigator.clipboard && navigator.clipboard.writeText(el.textContent); el.classList.add('kw-on'); setTimeout(()=>el.classList.remove('kw-on'),1200); }

function copySelItem(btn, text) {
  const decoded = text.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"');
  navigator.clipboard && navigator.clipboard.writeText(decoded).then(()=>{
    btn.textContent = '✅';
    btn.classList.add('copied');
    setTimeout(()=>{ btn.textContent='📋'; btn.classList.remove('copied'); }, 1500);
  });
}

// ── 시계
(function initClock(){
  function tick(){
    const now=new Date();
    const t=document.getElementById('hClockTime');
    const d=document.getElementById('hClockDate');
    if(t) t.textContent=now.toLocaleTimeString('ko-KR',{hour12:false});
    if(d) d.textContent=now.toLocaleDateString('ko-KR',{month:'short',day:'numeric',weekday:'short'});
  }
  tick(); setInterval(tick,1000);
})();

// ── 분석 모달 열기
function openAnalysisModal(){
  const m=document.getElementById('analysisModal');
  const b=document.getElementById('analysisBody');
  const mb=document.getElementById('analysisModalBody');
  if(!m) return;
  if(b && mb) mb.innerHTML = b.innerHTML || '<div class="analysis-loading"><span class="spin-sm"></span> 분석 중...</div>';
  m.classList.remove('hidden');
}

// ── 렌더링
function render(){
  // 제목 3그룹 렌더 (각 10개씩, 총 30개)
  [1,2,3].forEach(g=>{
    const el=document.getElementById('titleGroup'+g);
    if(!el) return;
    el.innerHTML='';
    const size = 10;
    const start=(g-1)*size;
    const end=Math.min(g*size, S.titles.length);
    S.titles.slice(start,end).forEach((t,li)=>{
      const i=start+li, on=S.selT.has(i);
      const len=[...t].length, over=len>15;
      const pin=pinData[i]||'';
      let itemCls='item';
      if(pin) itemCls+=' pin'+pin;
      else if(on) itemCls+=' on';
      el.insertAdjacentHTML('beforeend',`<div class="${itemCls}" id="t${i}">
        <button class="plus" onclick="tog('t',${i})">${on?'✓':'+'}</button>
        <div class="txt-wrap" style="flex:1;min-width:0">
          <div class="txt">${esc(t)}</div>
          <div class="meta" style="display:flex;align-items:center;gap:6px;margin-top:3px;flex-wrap:wrap">
            <span class="grp-badge g${g}">${g}번 추천</span>
            <span class="cc${over?' over':''}">${len}/15자${over?' ⚠️':''}</span>
            ${pin?`<span class="badge-tag" style="font-size:10px;background:${pin==='1'?'rgba(3,199,90,.2)':pin==='2'?'rgba(51,133,255,.2)':'rgba(255,152,0,.2)'};color:${pin==='1'?'#03C75A':pin==='2'?'#3385ff':'#ff9800'}">제목${pin} 고정</span>`:''}
          </div>
        </div>
        <select class="pin-sel${pin?' pin'+pin:''}" id="pin${i}" onchange="onPinChange(${i},this)">
          <option value=""${!pin?' selected':''}>위치 고정</option>
          <option value="1"${pin==='1'?' selected':''}>제목 1</option>
          <option value="2"${pin==='2'?' selected':''}>제목 2</option>
          <option value="3"${pin==='3'?' selected':''}>제목 3</option>
        </select>
      </div>`);
    });
  });
  const tSel=document.getElementById('tSelBadge');
  const tNum=document.getElementById('tSelNum');
  if(tSel){
    tSel.style.display=S.selT.size?'':'none';
    if(tNum) tNum.textContent=S.selT.size;
  }
  const lb=document.getElementById('tLimitBadge');
  if(lb){
    const isFull=S.selT.size>=MAX_TITLE_SEL;
    lb.textContent=`${S.selT.size}/15`;
    lb.className=isFull?'sel-limit-badge full':'sel-limit-badge';
  }
  const tb=document.getElementById('tBadge');
  if(tb) tb.textContent=S.titles.length;

  // titleItems 없어도 kwCol 렌더는 아래에서 처리
  const dEl1=document.getElementById('descGroup1');
  const dEl2=document.getElementById('descGroup2');
  if(dEl1 && dEl2){
    dEl1.innerHTML=''; dEl2.innerHTML='';
    const dTotal = S.descs.length;
    const dHalf = Math.ceil(dTotal/2);
    S.descs.forEach((d,i)=>{
      const len=[...d].length, over=len>45;
      const on=S.selD.has(i);
      const pinVal=descPinData[i]||'';
      const dg = i < dHalf ? 1 : 2;
      let itemCls='item-desc';
      if(pinVal) itemCls+=' pin'+pinVal;
      else if(on) itemCls+=' on';
      const html=`<div class="${itemCls}" id="d${i}">
        <button class="plus" onclick="tog('d',${i})">${on?'✓':'+'}</button>
        <div class="txt-wrap">
          <div class="txt" contenteditable="true" oninput="onDescEdit(${i},this)" onblur="onDescEdit(${i},this)">${esc(d)}</div>
          <div class="meta" style="flex-wrap:wrap">
            <span class="cc${over?' over':''}" style="font-size:12px">${len}/45자${over?' ⚠️':''}</span>
            ${pinVal?`<span class="badge-tag" style="font-size:11px;background:${pinVal==='1'?'rgba(3,199,90,.2)':'rgba(51,133,255,.2)'};color:${pinVal==='1'?'#03C75A':'#3385ff'}">설명${pinVal} 고정</span>`:''}
          </div>
        </div>
        <select class="pin-sel${pinVal?' pin'+pinVal:''}" id="dpin${i}" onchange="onDescPinChange(${i},this)">
          <option value=""${!pinVal?' selected':''}>위치 고정</option>
          <option value="1"${pinVal==='1'?' selected':''}>설명 1</option>
          <option value="2"${pinVal==='2'?' selected':''}>설명 2</option>
        </select>
      </div>`;
      (dg===1 ? dEl1 : dEl2).insertAdjacentHTML('beforeend', html);
    });
    const db=document.getElementById('dBadge');
    if(db) db.textContent=S.descs.length;
    const dSel=document.getElementById('dSelBadge');
    const dNum=document.getElementById('dSelNum');
    if(dSel){
      dSel.style.display=S.selD.size?'':'none';
      if(dNum) dNum.textContent=S.selD.size;
    }
    const dlb=document.getElementById('dLimitBadge');
    if(dlb){
      const isFull=S.selD.size>=MAX_DESC_SEL;
      dlb.textContent=S.selD.size+'/4';
      dlb.className=isFull?'sel-limit-badge full':'sel-limit-badge';
    }
  }

  // kwCol 제거됨 (그룹 렌더로 대체)

  // 선택 목록
  updateSelList();
  sync();
}


// ── 전체 취소
function clearAllSelection(){
  S.selT.clear();
  S.selD.clear();
  // 핀 데이터도 전부 초기화
  Object.keys(pinData).forEach(k=>delete pinData[k]);
  Object.keys(descPinData).forEach(k=>delete descPinData[k]);
  render();
  sync();
  // 버튼 숨기기
  const btn=document.getElementById('clearAllBtn');
  if(btn) btn.classList.remove('visible');
  showLimitToast('✓ 선택한 소재가 모두 취소되었습니다');
}

function updateSelList(){
  const ts=[...S.selT].sort((a,b)=>a-b);
  const ds=[...S.selD].sort((a,b)=>a-b);

  // 선택 목록 업데이트 (원래 IDs)
  const tl=document.getElementById('sTList');
  const tc=document.getElementById('sTCnt');
  const dl=document.getElementById('sDList');
  const dc=document.getElementById('sDCnt');
  if(tl) tl.innerHTML=ts.length
    ? ts.map(i=>`<div class="sel-item"><span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(S.titles[i])}</span><button class="sel-copy" onclick="copySelItem(this,'${esc(S.titles[i])}')" title="복사">📋</button><button class="sel-x" onclick="tog('t',${i})">✕</button></div>`).join('')
    : '<div class="sel-empty">선택 없음</div>';
  if(tc) tc.textContent=ts.length+'개';
  if(dl) dl.innerHTML=ds.length
    ? ds.map(i=>`<div class="sel-item"><span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(S.descs[i])}</span><button class="sel-copy" onclick="copySelItem(this,'${esc(S.descs[i])}')" title="복사">📋</button><button class="sel-x" onclick="tog('d',${i})">✕</button></div>`).join('')
    : '<div class="sel-empty">선택 없음</div>';
  if(dc) dc.textContent=ds.length+'개';

  // ── 현황판 업데이트
  const sbTN=document.getElementById('sbTitleNum');
  const sbDN=document.getElementById('sbDescNum');
  const sbTB=document.getElementById('sbTitleBar');
  const sbDB=document.getElementById('sbDescBar');
  if(sbTN) sbTN.textContent=ts.length;
  if(sbDN) sbDN.textContent=ds.length;
  if(sbTB) sbTB.style.width=(ts.length/15*100)+'%';
  if(sbDB) sbDB.style.width=(ds.length/4*100)+'%';

  // 고정 현황
  const pinCounts={t1:0,t2:0,t3:0,d1:0,d2:0};
  Object.values(pinData).forEach(v=>{ if(v==='1')pinCounts.t1++; else if(v==='2')pinCounts.t2++; else if(v==='3')pinCounts.t3++; });
  Object.values(descPinData).forEach(v=>{ if(v==='1')pinCounts.d1++; else if(v==='2')pinCounts.d2++; });

  const pinnedT={t1:'',t2:'',t3:''};
  Object.entries(pinData).forEach(([idx,v])=>{if(v&&S.titles[idx])pinnedT['t'+v]=S.titles[idx];});
  const pinnedD={d1:'',d2:''};
  Object.entries(descPinData).forEach(([idx,v])=>{if(v&&S.descs[idx])pinnedD['d'+v]=S.descs[idx];});

  ['t1','t2','t3','d1','d2'].forEach(k=>{
    const box=document.getElementById('sbPin'+k.toUpperCase());
    const num=document.getElementById('sbPin'+k.toUpperCase()+'Num');
    const sub=document.getElementById('sbPin'+k.toUpperCase()+'Sub');
    const n=pinCounts[k];
    const txt=(k.startsWith('t')?pinnedT[k]:pinnedD[k])||'';
    if(num) num.textContent=n;
    if(sub) sub.textContent=n?(txt?txt.slice(0,8)+(txt.length>8?'…':''):'고정됨'):'없음';
    if(box){ if(n>0){box.classList.add('active');}else{box.classList.remove('active');} }
  });
  // 전체 취소 버튼 표시/숨김
  const cab=document.getElementById('clearAllBtn');
  if(cab){
    if(S.selT.size>0||S.selD.size>0) cab.classList.add('visible');
    else cab.classList.remove('visible');
  }
  // 더보기 버튼 + 플로팅 패널 동기화
  _updateMoreBtn();
}

// ── 선택 토글
const MAX_TITLE_SEL = 15;
const MAX_DESC_SEL  = 4;

// ── 경고 토스트
function showLimitToast(msg){
  let t=document.getElementById('limitToast');
  if(!t){
    t=document.createElement('div'); t.id='limitToast';
    t.style.cssText='position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background:#1a1a2e;border:1px solid rgba(255,77,100,.5);color:#ff6b6b;font-size:13px;font-weight:700;padding:10px 22px;border-radius:30px;z-index:9999;opacity:0;transition:all .25s;box-shadow:0 8px 32px rgba(0,0,0,.5);text-align:center;white-space:nowrap';
    document.body.appendChild(t);
  }
  t.textContent=msg;
  t.style.opacity='1'; t.style.transform='translateX(-50%) translateY(0)';
  clearTimeout(t._tid);
  t._tid=setTimeout(()=>{t.style.opacity='0'; t.style.transform='translateX(-50%) translateY(20px)';},2500);
}

function tog(type, i){
  const set=type==='t'?S.selT:S.selD;
  if(set.has(i)){
    set.delete(i);
  } else {
    if(type==='t' && S.selT.size >= MAX_TITLE_SEL){
      showLimitToast('⚠️ 광고 제목은 최대 15개까지 선택 가능합니다');
      const lb=document.getElementById('tLimitBadge');
      if(lb){lb.textContent='15개 초과!';lb.classList.add('full');setTimeout(()=>{lb.textContent=S.selT.size+'/15';lb.classList.remove('full');},2000);}
      return;
    }
    if(type==='d' && S.selD.size >= MAX_DESC_SEL){
      showLimitToast('⚠️ 광고 설명은 최대 4개까지 선택 가능합니다');
      return;
    }
    set.add(i);
  }
  render();
}

// ── 핀 변경
function onPinChange(i,sel){
  const wasEmpty = !sel.value;
  // 핀 해제는 항상 허용
  if(!sel.value){
    pinData[i]='';
    render(); sync(); return;
  }
  // 핀 설정 시: 아직 선택 안 된 상태에서 15개 초과면 경고
  if(!S.selT.has(i) && S.selT.size >= MAX_TITLE_SEL){
    showLimitToast('⚠️ 광고 제목은 최대 15개까지 선택 가능합니다');
    sel.value=''; // 선택 취소
    return;
  }
  pinData[i]=sel.value;
  if(!S.selT.has(i)) S.selT.add(i);
  render(); sync();
}
function onDescPinChange(i,sel){
  // 핀 해제는 항상 허용
  if(!sel.value){
    descPinData[i]='';
    render(); sync(); return;
  }
  // 핀 설정 시: 아직 선택 안 된 상태에서 4개 초과면 경고
  if(!S.selD.has(i) && S.selD.size >= MAX_DESC_SEL){
    showLimitToast('⚠️ 광고 설명은 최대 4개까지 선택 가능합니다');
    sel.value=''; // 선택 취소
    return;
  }
  descPinData[i]=sel.value;
  if(!S.selD.has(i)) S.selD.add(i);
  render(); sync();
}
function onDescEdit(i,el){
  const txt=el.textContent||'';
  S.descs[i]=[...txt].slice(0,45).join('');
  const cc=el.closest('.item-desc')?.querySelector('.cc');
  if(cc){const l=[...S.descs[i]].length;cc.textContent=l+'/45자'+(l>45?' ⚠️':'');cc.className='cc'+(l>45?' over':'');}
  sync();
}

// ── 미리보기 동기화
function sync(){
  const ts=[...S.selT].sort((a,b)=>a-b).map(i=>S.titles[i]);
  const ds=[...S.selD].sort((a,b)=>a-b).map(i=>S.descs[i]);

  // 핀맵 - pinData 저장소 사용
  const pinMap={1:[],2:[],3:[]};
  Object.entries(pinData).forEach(([idx,val])=>{
    const i=parseInt(idx);
    if(val && S.selT.has(i)) pinMap[parseInt(val)].push(S.titles[i]);
  });
  const descPinMap={1:null,2:null};
  Object.entries(descPinData).forEach(([idx,val])=>{
    const i=parseInt(idx);
    if(val && S.selD.has(i)) descPinMap[parseInt(val)]=S.descs[i];
  });

  const unpinned=ts.filter(t=>{
    const idx=S.titles.indexOf(t);
    return !pinData[idx];
  });
  const allSlots=[
    ...(pinMap[1].length?pinMap[1]:unpinned.slice(0,1)),
    ...(pinMap[2].length?pinMap[2]:unpinned.slice(1,2)),
    ...(pinMap[3].length?pinMap[3]:unpinned.slice(2,3))
  ].slice(0,3);

  const pvDTxt1 = descPinMap[1]||(ds[0]||'');
  const pvDTxt2 = descPinMap[2]||(ds[1]||'');

  // ── PC 미리보기: 제목을 · 로 연결해서 한 줄로 (실제 네이버 파워링크 UI)
  const pvPcT=document.getElementById('pvPcTitles');
  if(pvPcT){
    if(allSlots.length){
      pvPcT.className='naver-ad-title';
      pvPcT.innerHTML=`<div style="font-size:14px;font-weight:700;color:#0068c3;line-height:1.55;word-break:keep-all">${allSlots.map(t=>esc(t)).join('<span style="color:#aaa;margin:0 3px">·</span>')}</div>`;
    } else {
      pvPcT.className='naver-ad-title empty';
      pvPcT.textContent='제목을 선택하면 표시됩니다';
    }
  }
  // 설명1 + 설명2 이어서 표시 (실제 네이버 광고처럼 연속 텍스트)
  const pvPcD=document.getElementById('pvPcDesc');
  if(pvPcD){
    const combined=[pvDTxt1,pvDTxt2].filter(Boolean).join(' ');
    if(combined){
      pvPcD.className='naver-ad-desc';
      pvPcD.textContent=combined;
    } else {
      pvPcD.className='naver-ad-desc empty';
      pvPcD.textContent='설명을 선택하면 표시됩니다';
    }
  }
  // 칩(키워드 네모칸) 없음
  const pvPcChips=document.getElementById('pvPcChips');
  if(pvPcChips) pvPcChips.innerHTML='';
  const pvPcThumb=document.getElementById('pvPcThumb');
  if(pvPcThumb){
    const pcUrl=generateProductThumb(document.getElementById('productName')?.value?.trim()||'');
    pvPcThumb.innerHTML=`<img src="${pcUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:4px"/>`;
  }

  // ── 모바일 미리보기: 설명1+2 이어서 표시
  const mobContainer=document.getElementById('pvMobTitleList');
  if(mobContainer){
    if(allSlots.length){
      const thumbUrl = generateProductThumb(document.getElementById('productName')?.value?.trim()||'');
      const thumbHtml=`<div class="naver-mob-thumb"><img src="${thumbUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:5px"/></div>`;
      const titleLine=allSlots.map(t=>esc(t)).join('<span style="color:#aaa;margin:0 3px">·</span>');
      const combinedDesc=[pvDTxt1,pvDTxt2].filter(Boolean).join(' ');
      const descHtml=combinedDesc
        ? `<div style="font-size:11px;color:#444;line-height:1.55;word-break:keep-all;margin-top:4px">${esc(combinedDesc)}</div>`
        : `<div class="naver-mob-desc empty" style="margin-top:4px">설명을 선택하면 표시됩니다</div>`;
      mobContainer.innerHTML=`
        <div class="mob-ad-card">
          <div class="naver-mob-meta">
            <div class="naver-mob-logo">S</div>
            <span class="naver-mob-store">스마트스토어</span>
            <span style="color:#ccc;font-size:9px;margin:0 2px">·</span>
            <span class="naver-mob-url">smartstore.naver.com</span>
            <span class="naver-mob-badge">광고</span>
          </div>
          <div class="naver-mob-row">
            <div class="naver-mob-body">
              <div class="naver-mob-title" style="font-size:14px;font-weight:700;color:#0068c3;word-break:keep-all;line-height:1.55">${titleLine}</div>
              ${descHtml}
            </div>
            ${thumbHtml}
          </div>
        </div>`;
    } else {
      mobContainer.innerHTML=`<div class="mob-ad-empty">
        <div class="naver-mob-meta"><div class="naver-mob-logo">S</div><span class="naver-mob-store">스마트스토어</span><span class="naver-mob-badge">광고</span></div>
        <div class="naver-mob-title empty">제목을 선택하면 표시됩니다</div>
        <div class="naver-mob-desc empty">설명을 선택하면 표시됩니다</div>
      </div>`;
    }
  }
}

// ── 메인 생성 함수
async function generate(){
  if(!API_KEY){openKeyModal();return;}

  // ── 유효성 검사 ──
  const name=document.getElementById('productName').value.trim();
  const featInputs=[...document.querySelectorAll('#featSlots .feat-slot input')].map(el=>el.value.trim()).filter(Boolean);
  
  let valid = true;
  let focusEl = null;

  // 상품명 필수
  const nameEl = document.getElementById('productName');
  const nameCol = nameEl?.closest('.input-col');
  if(!name){
    nameEl?.classList.add('empty-req');
    nameCol?.classList.add('req-error');
    valid = false;
    if(!focusEl) focusEl = nameEl;
  } else {
    nameEl?.classList.remove('empty-req');
    nameCol?.classList.remove('req-error');
  }

  // 광고 내용 — 선택 항목, 유효성 검사 없음

  if(!valid){
    if(focusEl) { focusEl.focus(); focusEl.scrollIntoView({behavior:'smooth',block:'center'}); }
    return;
  }
  // 상품명 기반 썸네일 미리 생성
  updatePreviewThumbs();

  const feat=featInputs.join(', '); // featInputs already computed above
  const target=document.getElementById('target')?.value.trim()||'';
  const event=document.getElementById('eventInput')?.value.trim()||'';
  const denyWords=[...S_DENY];

  const btn=document.getElementById('genBtn');
  btn.disabled=true;
  document.getElementById('genTxt').innerHTML='<span class="spin"></span> 분석 중...';
  document.getElementById('pbarFill').style.width='0%';
  document.getElementById('emptyState').style.display='none';
  document.getElementById('resultWrap').style.display='none';

  // ── 입력 전체 잠금
  function lockInputs(lock){
    const ids=['productName','target','denyInput','eventInput'];
    ids.forEach(id=>{ const el=document.getElementById(id); if(el) el.disabled=lock; });
    document.querySelectorAll('#featSlots input, #featSlots button').forEach(el=>el.disabled=lock);
    document.querySelectorAll('#seasonChips .schip').forEach(el=>el.disabled=lock);
    document.querySelectorAll('#toneGrid .tone-btn').forEach(el=>el.disabled=lock);
    document.getElementById('featAddBtn') && (document.getElementById('featAddBtn').disabled=lock);
    document.getElementById('uploadZone') && (document.getElementById('uploadZone').style.pointerEvents=lock?'none':'');
    const card=document.querySelector('.input-card');
    if(card) card.classList.toggle('inputs-locked', lock);
  }
  lockInputs(true);
  const footer = document.getElementById('inputFooter');
  const analyzingLabel = document.getElementById('analyzingLabel');
  const footerInfo = document.getElementById('footerInfo');
  if(footer) footer.classList.add('analyzing');
  if(analyzingLabel) analyzingLabel.style.display='flex';
  if(footerInfo) footerInfo.style.display='none';
  // 분석 패널 글로우
  const analysisPanel = document.querySelector('.analysis-panel-tall');
  if(analysisPanel) analysisPanel.classList.add('analyzing-active');

  // ── 단계별 실시간 메시지 시스템
  const phaseEl  = document.getElementById('analyzingPhase');
  const stepEl   = document.getElementById('analyzingStep');
  const remainEl = document.getElementById('analyzingRemain');
  const lblEl    = document.getElementById('analyzingTimerLbl');

  // 단계 메시지 세팅 함수
  let aLabelTimer = null;
  function setPhase(phase, steps, intervalMs=2200){
    if(phaseEl) phaseEl.textContent = phase;
    if(aLabelTimer) clearInterval(aLabelTimer);
    let si=0;
    function showStep(){ if(stepEl){ stepEl.style.opacity='0'; setTimeout(()=>{ stepEl.textContent=steps[si]; stepEl.style.opacity='1'; si=(si+1)%steps.length; },160); } }
    showStep();
    aLabelTimer = setInterval(showStep, intervalMs);
  }

  // 초기 단계 - 실제 진행 내용 기반
  setPhase('① 준비 중', [
    `"${name.slice(0,12)}${name.length>12?'...':''}" 상품명 읽는 중...`,
    '입력하신 내용을 정리하고 있어요...',
    'Gemini API에 연결하는 중...',
  ]);

  function stopAnalyzingUI(){
    lockInputs(false);
    btn.classList.remove('analyzing');
    if(footer) footer.classList.remove('analyzing');
    if(analyzingLabel) analyzingLabel.style.display='none';
    if(footerInfo) footerInfo.style.display='';
    if(analysisPanel) analysisPanel.classList.remove('analyzing-active');
    if(aLabelTimer) clearInterval(aLabelTimer);
    document.getElementById('genTxt').innerHTML='✨ 광고 소재 생성하기';
    // 버튼 옆 로그 숨기기
    const glw = document.getElementById('genLogWrap');
    if(glw) glw.style.display='none';
  }

  S.selT=new Set(); S.selD=new Set();
  // 핀 데이터 초기화
  Object.keys(pinData).forEach(k=>delete pinData[k]);
  Object.keys(descPinData).forEach(k=>delete descPinData[k]);

  // 대기 화면 → 분석 중 전환 (apPanel은 항상 보임, 내부만 업데이트)
  const badge = document.getElementById('apStatusBadge');
  if(badge) { badge.textContent = '생성 중'; badge.className = 'ap-status-badge active'; }
  const headerSub0 = document.getElementById('apHeaderSub');
  if(headerSub0) headerSub0.textContent = '소재 생성 중...';

  // 버튼 옆 로그 표시
  const genLogWrap = document.getElementById('genLogWrap');
  const genLogTxt = document.getElementById('genLogTxt');
  if(genLogWrap) genLogWrap.style.display='block';

  function setGenLog(msg) {
    if(!genLogTxt) return;
    genLogTxt.style.opacity='0';
    setTimeout(()=>{ genLogTxt.textContent=msg; genLogTxt.style.opacity='1'; }, 200);
  }
  const sideStatus = document.getElementById('analysisSideStatus');
  const sidePreview=document.getElementById('analysisSidePreview');
  const sideBtn=document.getElementById('analysisOpenBtn');
  const apProg=document.getElementById('apPanel');
  if(sideStatus){ sideStatus.style.display='block'; sideStatus.textContent='분석 시작...'; sideStatus.classList.add('running'); }
  setGenLog('Gemini AI 연결 중...');
  if(sidePreview) sidePreview.style.display='none';
  if(sideBtn) sideBtn.disabled=true;
  if(apProg) apProg.style.display='block';

  // ── 3분 카운트다운 타이머
  const TOTAL_SEC = 180; // 3분
  let remain = TOTAL_SEC;
  let timerDone = false;
  let phase2Started = false;

  function fmtRemain(s){
    s = Math.max(0, Math.round(s));
    return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
  }

  function setTimerDisplay(text, subText, warn){
    if(remainEl){
      remainEl.textContent = text;
      remainEl.style.color = warn ? '#ff9800' : '';
    }
    if(lblEl) lblEl.textContent = subText || '남음';
    const cd = document.querySelector('#genBtn .btn-countdown');
    if(cd){
      cd.textContent = text;
      cd.style.color = warn ? '#ffcc44' : '';
    }
  }

  // 초기 표시
  setTimerDisplay(fmtRemain(TOTAL_SEC), '남음', false);
  document.getElementById('genTxt').innerHTML = `<span class="spin"></span> 분석 중... <span class="btn-countdown">${fmtRemain(TOTAL_SEC)}</span>`;

  // 패널 타이머 행 업데이트
  const apTimerRowEl = document.getElementById('apTimerRow');
  if(apTimerRowEl) { apTimerRowEl.style.display='block'; apTimerRowEl.innerHTML = `예상 완료까지: <b id="apElapsedVal">${fmtRemain(TOTAL_SEC)}</b>`; }
  function updatePanelTimer(text){ const el=document.getElementById('apElapsedVal'); if(el) el.textContent=text; }

  const countdownInterval = setInterval(()=>{
    if(timerDone) return;
    remain--;
    if(remain > 0){
      setTimerDisplay(fmtRemain(remain), '남음', false);
      updatePanelTimer(fmtRemain(remain));
    } else {
      // 3분 초과 → 초과 경고
      const over = Math.abs(remain);
      const overSec = over + 1;
      setTimerDisplay(`+${overSec}초`, '조금만 더', true);
      updatePanelTimer(`+${overSec}초 초과`);
      const status = document.getElementById('analysisSideStatus');
      if(status && status.textContent !== '⚠️ 조금 더 기다려주세요'){
        status.textContent = '⚠️ 조금 더 기다려주세요';
      }
    }
  }, 1000);

  window._stopCountdown = ()=>{
    timerDone = true;
    clearInterval(countdownInterval);
    const elapsed = TOTAL_SEC - remain;
    if(remain > 30){
      // 2분 30초 이전 완료 → 빠르게 완료
      setTimerDisplay('빠름!', '✓ 완료', false);
      updatePanelTimer('예정보다 빨리 완료!');
    } else if(remain >= 0){
      // 3분 이내 완료
      setTimerDisplay(fmtRemain(TOTAL_SEC - remain), '✓ 완료', false);
      updatePanelTimer(`${fmtRemain(TOTAL_SEC - remain)} 소요`);
    } else {
      // 3분 초과 완료
      setTimerDisplay(fmtRemain(elapsed), '✓ 완료', false);
      updatePanelTimer(`${fmtRemain(elapsed)} 소요`);
    }
    const cd = document.querySelector('#genBtn .btn-countdown');
    if(cd) cd.style.color = '';
  };

  window._startPhase2Timer = ()=>{ phase2Started = true; };

  // sideStatus 업데이트
  function updateStatus(msg) {
    if(sideStatus) sideStatus.textContent = msg;
    const subEl = document.getElementById('apHeaderSub');
    if(subEl) { subEl.style.opacity='0'; setTimeout(()=>{ subEl.textContent=msg; subEl.style.opacity='1'; },160); }
    setGenLog(msg);
    if(stepEl) { stepEl.style.opacity='0'; setTimeout(()=>{ stepEl.textContent=msg; stepEl.style.opacity='1'; },160); }
  }

  let fieldTimer = null;
  pg(1,'active');

  try{
    // ── STEP 0: GPT-4o 이미지 분석
    let gpt4oAnalysis = null;
    if (S.imgs.length > 0 && OPENAI_KEY) {
      updateStatus('🔍 GPT-4o 이미지 분석 중...');
      setGenLog('GPT-4o 이미지 분석 중...');
      gpt4oAnalysis = await analyzeWithGPT4o(S.imgs);
      if (gpt4oAnalysis) updateStatus('✅ 이미지 분석 완료 → 광고 포인트 추출됨');
    }

    // Claude 키 있으면 Claude, 없으면 Gemini fallback
    const useClaudeForCopy = !!CLAUDE_KEY;
    const copyFn     = useClaudeForCopy ? callClaude : callGemini;
    const copyApiName = useClaudeForCopy ? 'Claude Haiku' : 'Gemini';

    const promptParts=[`상품명: ${name}`];
    if (gpt4oAnalysis) promptParts.push(`[GPT-4o 이미지 분석]\n${gpt4oAnalysis}`);
    if(feat) promptParts.push(`핵심 특징: ${feat}`);
    if(target) promptParts.push(`타겟 고객: ${target}`);
    if(S_SEASON) promptParts.push(`시즌/이벤트: ${S_SEASON}`);
    if(event) promptParts.push(`이벤트 문구: ${event}`);
    if(S_TONE) promptParts.push(`광고 어조: ${S_TONE}`);
    if(denyWords.length) promptParts.push(`절대 사용 금지 단어: ${denyWords.join(', ')}`);
    const prompt=promptParts.join('\n')+'\n\n위 상품의 네이버 파워링크 광고 소재를 생성해주세요.';

    let content;
    if(S.imgs.length>0){
      // 최대 3장 전송 (MAX_IMGS=3 기준, 3장 이내면 전체 전송)
      content=S.imgs.map(img=>({type:'image',source:{type:'base64',media_type:img.type||'image/jpeg',data:img.b64}}));
      content.push({type:'text',text:prompt});
    } else {
      content=prompt;
    }

    pg(1,'done');pg(2,'active');
    document.getElementById('genTxt').innerHTML='<span class="spin"></span> 소재 작성 중...';

    const phase1Msgs = [
      `상품명 "${name.slice(0,10)}${name.length>10?'...':''}" 핵심 키워드 분석 중...`,
      '제목·설명 병렬 생성 중... (속도 2배)',
      target ? `"${target.slice(0,16)}" 타겟에 맞게 조정 중...` : '클릭률 높은 문구 선별 중...',
    ];
    setPhase('① 소재 작성 중', phase1Msgs, 2800);

    const streamElCopy = document.getElementById('apLogStream');
    const liveLogCopy = document.getElementById('apLogBox');
      if(liveLogCopy) liveLogCopy.style.display = 'block';
    if(streamElCopy) streamElCopy.innerHTML = `⚡ ${copyApiName}로 제목 + 설명 생성 중...<span class="ap-stream-cursor"></span>`;
    updateStatus(`✍️ ${copyApiName}로 광고 소재 생성 중...`);
    setGenLog(`${copyApiName} AI 연결 중...`);

    const sysCopy = `당신은 네이버 파워링크 광고 전문가입니다.
반드시 순수 JSON만 응답하세요. 코드블록·설명·다른 텍스트 절대 금지.
금지 표현: 최고·최저·1위·최상·특가·최대·최저가·압도적·완벽·탁월·보장·무조건 등 최상급 표현.`;

    const promptBase = promptParts.join('\n');

    // ★ 제목과 설명을 병렬로 동시에 생성 — 속도 2배
    // 이미지가 있으면 제목 생성에만 이미지 첨부 (설명엔 불필요)
    const titlesContent = S.imgs.length > 0
      ? [...S.imgs.map(img=>({type:'image',source:{type:'base64',media_type:img.type||'image/jpeg',data:img.b64}})),
         {type:'text', text: promptBase + '\n\n제목 30개를 생성하세요. 규칙: 15자 이내, 숫자·혜택·타겟 활용. 제목1위치추천 10개, 제목2위치추천 10개, 제목3위치추천 10개 순서로.\n형식: {"titles":["..."]}'}]
      : promptBase + '\n\n제목 30개를 생성하세요. 규칙: 15자 이내, 숫자·혜택·타겟 활용. 제목1위치추천 10개, 제목2위치추천 10개, 제목3위치추천 10개 순서로.\n형식: {"titles":["..."]}';

    const [titlesRaw, descsRaw] = await Promise.all([
      copyFn(sysCopy,
        titlesContent,
        (full) => {
          if(streamElCopy) {
            const n = (full.match(/"[^"]{1,15}"/g)||[]).length;
            streamElCopy.innerHTML = `✍️ 제목 생성 중... ${Math.min(n,30)}/30개<span class="ap-stream-cursor"></span>`;
          }
          updateStatus(`✍️ 제목 ${Math.min((full.match(/"[^"]{1,15}"/g)||[]).length,30)}/30개 생성 중...`);
        }
      ),
      copyFn(sysCopy,
        promptBase + '\n\n설명 10개를 생성하세요.\n⚠️ 아래 규칙을 반드시 모두 지키세요:\n- 글자 수: 정확히 40~45자 (한글 1자=1자, 공백 포함, 미달·초과 모두 금지)\n- 완결성: 단어 중간에 절대 끊으면 안 됨. 문장이 완전히 끝나야 함\n- 끝맺음: 마지막 글자가 조사·명사·동사 어미로 자연스럽게 마무리\n- 생성 후 반드시 글자 수를 직접 세어 40~45자인지 확인하고 틀리면 수정할 것\n- 나쁜 예(끊김): "소상공인을 위한 간냉식 45박스 냉장고, 지금 구" → 단어 끊김\n- 좋은 예(완결): "소상공인을 위한 간냉식 냉장고, 지금 바로 확인해보세요" (44자)\n형식: {"descs":["..."]}',
        null
      )
    ]);

    let parsedTitles, parsedDescs;
    try { parsedTitles = JSON.parse(titlesRaw.replace(/```json|```/g,'').trim()); } catch(e) { throw new Error('제목 파싱 실패. 다시 시도해주세요.'); }
    try { parsedDescs  = JSON.parse(descsRaw.replace(/```json|```/g,'').trim()); } catch(e) { throw new Error('설명 파싱 실패. 다시 시도해주세요.'); }

    S.titles = (parsedTitles.titles || []).map(t=>[...t].slice(0,15).join(''));
    S.descs  = (parsedDescs.descs   || []).map(d=>[...d].slice(0,45).join(''));
    S.kws = [];

    pg(2,'done');
    // ★ 소재 생성 완료 즉시 결과 표시 (리포트 기다리지 않음)
    render();
    document.getElementById('resultWrap').style.display='block';
    document.getElementById('previewMonitorWrap').style.display='block';
    document.getElementById('emptyState').style.display='none';
    pg(3,'active');
    pg(4,'active');
    document.getElementById('pbarFill').style.width='100%';
    setTimeout(()=>document.getElementById('resultWrap').scrollIntoView({behavior:'smooth',block:'start'}),300);
    document.getElementById('genTxt').innerHTML='<span class="spin"></span> 리포트 분석 중...';
    if(sideStatus) sideStatus.textContent='리포트 분석 중...';
    if(stepEl) { stepEl.style.opacity='0'; setTimeout(()=>{ stepEl.textContent='리포트 분석 중...'; stepEl.style.opacity='1'; },160); }
    if(window._startPhase2Timer) window._startPhase2Timer();

    // 마케터 리포트 분석 — 실제 분석 단계 메시지
    const titleCount = S.titles.length;
    const descCount = S.descs.length;
    const hasImg = S.imgs.length > 0;
    const phase2Steps = [
      `${titleCount}개 제목의 클릭 유도 방식 분석 중...`,
      `${descCount}개 설명문에서 핵심 메시지 추출 중...`,
      target ? `"${target.slice(0,14)}" 타겟 심리와 구매 동기 분석 중...` : '타겟 고객의 구매 심리 분석 중...',
      S_TONE ? `"${S_TONE}" 어조 전략이 얼마나 효과적인지 검토 중...` : '광고 어조 일관성 검토 중...',
      hasImg ? '이미지 분석 결과가 소재에 잘 녹아들었는지 확인 중...' : '키워드 커버리지와 검색 의도 일치 확인 중...',
      '가장 클릭률 높을 소재 TOP3 선정 중... 거의 다 왔어요!',
      '개선 권고사항 정리 중... 곧 완료됩니다!',
    ];
    setPhase('② 마케터 리포트 분석', phase2Steps, 2500);

    const aBody=document.getElementById('analysisBody');aBody.style.display='none';
    if(sideStatus) sideStatus.textContent='리포트 작성 중...';

    generateAnalysis(name, feat, target, S.titles, S.descs, S.imgs).then(html=>{
      document.getElementById('analysisBody').innerHTML=html;
      document.getElementById('analysisBody').style.display='none';
      if(apProg) apProg.style.display='none';
      const thinkEl = document.getElementById('apPanel_noop');
      if(thinkEl) thinkEl.style.display='none';
      clearInterval(fieldTimer);
      
      // 3줄 요약 표시
      const preview=document.getElementById('analysisSidePreview');
      if(preview){
        preview.style.display='block';
        const tmp=document.createElement('div'); tmp.innerHTML=html;
        let rawLines=[];
        tmp.querySelectorAll('.analysis-section-content').forEach(el=>{
          el.textContent.split(/[.。]\s+/).map(s=>s.trim()).filter(s=>s.length>10).forEach(s=>{
            if(rawLines.length<3) rawLines.push(s);
          });
        });
        const bullets=['●','●','●'];
        const colors=['#03C75A','#3385ff','#ff9800'];
        preview.innerHTML = rawLines.slice(0,3).map((l,i)=>
          `<div style="display:flex;gap:6px;margin-bottom:5px"><span style="color:${colors[i]};flex-shrink:0;font-size:11px;margin-top:2px">${bullets[i]}</span><span>${l.slice(0,60)}${l.length>60?'...':''}</span></div>`
        ).join('');
      }

      // 리포트 완료 - 결과는 이미 표시됨, 패널만 업데이트
      pg(3,'done');pg(4,'done');
      // fieldRows 다시 표시
      document.getElementById('genTxt').innerHTML='✨ 광고 소재 생성하기';
      btn.disabled=false;
      stopAnalyzingUI();
      if(window._stopCountdown) window._stopCountdown();
      const status=document.getElementById('analysisSideStatus');
      const openBtn=document.getElementById('analysisOpenBtn');
      if(status){ status.textContent='✓ 분석 완료'; status.classList.remove('running'); }
      if(openBtn){openBtn.disabled=false;openBtn.classList.add('done');setTimeout(()=>openBtn.classList.remove('done'),5000);}
      const lb=document.getElementById('apLogBox'); if(lb) lb.classList.remove('analyzing');
    }).catch(()=>{
      document.getElementById('analysisBody').innerHTML='<div>분석을 불러오지 못했어요.</div>';
      pg(3,'done');pg(4,'done');
      document.getElementById('genTxt').innerHTML='✨ 광고 소재 생성하기';
      btn.disabled=false;
      stopAnalyzingUI();
      if(window._stopCountdown) window._stopCountdown();
      if(apProg) apProg.style.display='none';
      clearInterval(fieldTimer);
    });

  } catch(e){
    document.getElementById('emptyState').style.display='';
    if(apProg) apProg.style.display='none';
    clearInterval(fieldTimer);
    stopAnalyzingUI();
    if(window._stopCountdown) window._stopCountdown();
    console.error(e);
    alert('오류: '+e.message);
    btn.disabled=false;
    document.getElementById('genTxt').innerHTML='✨ 광고 소재 생성하기';
  }
}



// ════════════════════════════════════════════════════════════
// 섹션별 독립 sticky 고정 토글
// ════════════════════════════════════════════════════════════
const _pinState = { preview: false, monitor: false };

function togglePinSection(type) {
  _pinState[type] = !_pinState[type];
  const sectionId = type === 'preview' ? 'previewSection' : 'monitorSection';
  const btnId     = type === 'preview' ? 'pinPreviewBtn' : 'pinMonitorBtn';
  const section   = document.getElementById(sectionId);
  const btn       = document.getElementById(btnId);
  const hh        = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--hh')) || 52;

  if (_pinState[type]) {
    section.classList.add('pinned');
    if (btn) { btn.classList.add('pinned'); btn.innerHTML = '<span class="pin-icon">📌</span> 고정 해제'; }
  } else {
    section.classList.remove('pinned');
    if (btn) { btn.classList.remove('pinned'); btn.innerHTML = '<span class="pin-icon">📌</span> 고정하기'; }
  }
  _recalcStickyTops();
}

// 두 섹션이 모두 고정될 때 top 값 동적 계산
function _recalcStickyTops() {
  const hh      = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--hh')) || 52;
  const preview = document.getElementById('previewSection');
  const monitor = document.getElementById('monitorSection');
  const gap     = 6;

  // 미리보기는 항상 헤더 바로 아래
  if (preview) preview.style.top = _pinState.preview ? (hh + gap) + 'px' : '';

  // 모니터: 미리보기도 고정이면 그 아래, 아니면 헤더 바로 아래
  if (monitor) {
    if (_pinState.monitor) {
      if (_pinState.preview) {
        const previewH = preview.getBoundingClientRect().height;
        monitor.style.top = (hh + gap + previewH + 4) + 'px';
      } else {
        monitor.style.top = (hh + gap) + 'px';
      }
    } else {
      monitor.style.top = '';
    }
  }
}

// 창 리사이즈 시 재계산
window.addEventListener('resize', _recalcStickyTops);

// ── 더보기 버튼 표시 연동
function _updateMoreBtn() {
  const btn   = document.getElementById('moreSelBtn');
  const cnt   = document.getElementById('moreTotalCnt');
  const total = S.selT.size + S.selD.size;
  if (btn) {
    btn.style.display = total > 0 ? 'inline-flex' : 'none';
    if (cnt) cnt.textContent = total;
  }
}

// ── 더보기 모달 열기
function openSelModal() {
  const overlay = document.getElementById('selModalOverlay');
  if (!overlay) return;

  const ts = [...S.selT].sort((a,b) => a-b);
  const ds = [...S.selD].sort((a,b) => a-b);

  const titlesEl = document.getElementById('selModalTitles');
  const titleCnt = document.getElementById('selModalTitleCnt');
  if (titleCnt) titleCnt.textContent = ts.length + '개';
  if (titlesEl) {
    titlesEl.innerHTML = ts.length
      ? ts.map((i,n) => {
          const pinVal   = pinData[i] || '';
          const pinLabel = pinVal ? `<span class="sel-modal-item-pin">📌 제목${pinVal} 고정</span>` : '';
          return `<div class="sel-modal-item">
            <div class="sel-modal-item-num">#${n+1}</div>
            <div class="sel-modal-item-txt">${esc(S.titles[i])}</div>
            <div class="sel-modal-item-meta">
              <span class="sel-modal-item-len">${[...S.titles[i]].length}자</span>
              ${pinLabel}
            </div>
          </div>`;
        }).join('')
      : '<div class="sel-modal-empty">선택된 제목이 없어요</div>';
  }

  const descsEl = document.getElementById('selModalDescs');
  const descCnt = document.getElementById('selModalDescCnt');
  if (descCnt) descCnt.textContent = ds.length + '개';
  if (descsEl) {
    descsEl.innerHTML = ds.length
      ? ds.map((i,n) => {
          const pinVal   = descPinData[i] || '';
          const pinLabel = pinVal ? `<span class="sel-modal-item-pin">📌 설명${pinVal} 고정</span>` : '';
          const len = [...S.descs[i]].length;
          const lenStyle = len < 40 ? 'style="background:rgba(245,158,11,.1);color:#f59e0b"'
                         : len > 45 ? 'style="background:rgba(255,77,109,.1);color:#ff4d6d"' : '';
          return `<div class="sel-modal-item">
            <div class="sel-modal-item-num">#${n+1}</div>
            <div class="sel-modal-item-txt">${esc(S.descs[i])}</div>
            <div class="sel-modal-item-meta">
              <span class="sel-modal-item-len" ${lenStyle}>${len}자</span>
              ${pinLabel}
            </div>
          </div>`;
        }).join('')
      : '<div class="sel-modal-empty">선택된 설명이 없어요</div>';
  }

  const total = document.getElementById('selModalTotal');
  if (total) total.textContent = `제목 ${ts.length}개 · 설명 ${ds.length}개`;
  const footerInfo = document.getElementById('selModalFooterInfo');
  if (footerInfo) footerInfo.textContent = ts.length + ds.length > 0
    ? `총 ${ts.length + ds.length}개 소재 선택됨`
    : '제목과 설명을 선택하면 여기서 한눈에 볼 수 있어요';

  overlay.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeSelModal(e) {
  if (e && e.target !== document.getElementById('selModalOverlay')) return;
  document.getElementById('selModalOverlay')?.classList.remove('open');
  document.body.style.overflow = '';
}

function copyAllSelected() {
  const ts = [...S.selT].sort((a,b) => a-b).map(i => S.titles[i]);
  const ds = [...S.selD].sort((a,b) => a-b).map(i => S.descs[i]);
  const lines = [];
  if (ts.length) { lines.push('▶ 제목'); ts.forEach((t,i) => lines.push(`${i+1}. ${t}`)); }
  if (ds.length) { if (ts.length) lines.push(''); lines.push('▶ 설명'); ds.forEach((d,i) => lines.push(`${i+1}. ${d}`)); }
  if (!lines.length) return;
  navigator.clipboard.writeText(lines.join('\n')).then(() => {
    showLimitToast('✓ 전체 소재가 클립보드에 복사되었습니다');
  });
}

// ESC 키로 모달 닫기
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeSelModal();
});

</script>
</body>
</html>
