<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>íŒŒì›Œë§í¬ ê´‘ê³  ì†Œì¬ ìƒì„±ê¸° | AIë§ˆì¼€íŒ…ì „ëµì—°êµ¬ì†Œ</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800;900&display=swap" rel="stylesheet">
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

/* â”€â”€ ë¦¬ì…‹ & ê¸°ë³¸ â”€â”€ */
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --g:#03C75A;--g2:#00e676;--g-dim:rgba(3,199,90,.12);--g-glow:rgba(3,199,90,.35);
  --b:#0066ff;--b2:#3385ff;
  --bg:#060d17;--bg2:#091320;--bg3:#0d1a2d;
  --glass:rgba(255,255,255,.04);--glass2:rgba(255,255,255,.07);
  --border:rgba(255,255,255,.08);--border2:rgba(255,255,255,.12);
  --text:#e8f0fe;--text2:rgba(232,240,254,.65);--text3:rgba(232,240,254,.3);
  --red:#ff4d6d;--amber:#f59e0b;
  --shadow:0 8px 32px rgba(0,0,0,.5);
  --shadow-g:0 0 30px rgba(3,199,90,.2);
  --r:12px;--r2:8px;
  --hh:48px;
}
html{scroll-behavior:smooth}
body{
  font-family:'Pretendard',-apple-system,sans-serif;
  background:var(--bg);color:var(--text);font-size:13px;line-height:1.55;
  min-height:100vh;overflow-x:hidden;
}

/* â•â• ì˜¤ë¡œë¼ ë°°ê²½ â•â• */
.aurora{
  position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;
}
.aurora-1{
  position:absolute;width:900px;height:600px;
  top:-200px;left:-200px;
  background:radial-gradient(ellipse,rgba(3,199,90,.07) 0%,transparent 65%);
  animation:auroraMov1 18s ease-in-out infinite alternate;
}
.aurora-2{
  position:absolute;width:700px;height:500px;
  top:30%;right:-200px;
  background:radial-gradient(ellipse,rgba(0,102,255,.08) 0%,transparent 65%);
  animation:auroraMov2 22s ease-in-out infinite alternate;
}
.aurora-3{
  position:absolute;width:600px;height:400px;
  bottom:-100px;left:30%;
  background:radial-gradient(ellipse,rgba(3,199,90,.05) 0%,transparent 65%);
  animation:auroraMov3 15s ease-in-out infinite alternate;
}
@keyframes auroraMov1{from{transform:translate(0,0) scale(1)}to{transform:translate(120px,60px) scale(1.15)}}
@keyframes auroraMov2{from{transform:translate(0,0) scale(1)}to{transform:translate(-80px,100px) scale(1.1)}}
@keyframes auroraMov3{from{transform:translate(0,0) scale(1)}to{transform:translate(-60px,-80px) scale(1.2)}}

/* ë…¸ì´ì¦ˆ ì˜¤ë²„ë ˆì´ */
.noise{
  position:fixed;inset:0;z-index:1;pointer-events:none;opacity:.025;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

/* â•â• ëª¨ë‹¬ â•â• */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(12px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn .2s ease}
.overlay.hidden{display:none!important}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{opacity:0;transform:translateY(24px) scale(.97)}to{opacity:1;transform:none}}

/* API Key ëª¨ë‹¬ */
.key-modal{background:linear-gradient(160deg,#0a1628,#0f1f38);border:1px solid var(--border2);border-radius:20px;max-width:480px;width:100%;box-shadow:0 24px 80px rgba(0,0,0,.6),0 0 0 1px rgba(3,199,90,.08);animation:slideUp .3s cubic-bezier(.34,1.56,.64,1);overflow:hidden}
.key-modal-head{background:linear-gradient(135deg,#0a1628 0%,rgba(3,199,90,.06) 100%);padding:26px 28px 22px;position:relative;border-bottom:1px solid var(--border)}
.key-modal-head::after{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at top right,rgba(3,199,90,.08),transparent 60%);pointer-events:none}
.key-modal-head .logo-mark{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#029e48,var(--g));display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:22px;font-weight:900;color:#fff;margin-bottom:14px;box-shadow:0 4px 16px var(--g-glow)}
.key-modal-head h2{font-family:'Syne',sans-serif;font-size:19px;font-weight:800;color:#fff;margin-bottom:5px}
.key-modal-head p{font-size:12px;color:var(--text3);line-height:1.6}
.key-modal-body{padding:20px 28px}
.step-guide{margin-bottom:16px}
.step-guide-title{font-size:10px;font-weight:700;color:var(--text3);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px}
.step-row{display:flex;gap:10px;align-items:flex-start;margin-bottom:8px}
.step-num{width:20px;height:20px;border-radius:50%;background:var(--g-dim);border:1.5px solid rgba(3,199,90,.4);color:var(--g);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
.step-text{font-size:12px;color:var(--text2);line-height:1.6}
.step-text a{color:var(--g);text-decoration:none;font-weight:600}
.key-input-wrap{background:rgba(0,0,0,.3);border:1.5px solid var(--border);border-radius:10px;padding:10px 14px;margin-bottom:6px;display:flex;align-items:center;gap:10px;transition:border-color .2s,box-shadow .2s}
.key-input-wrap:focus-within{border-color:rgba(3,199,90,.5);box-shadow:0 0 0 3px rgba(3,199,90,.08)}
.key-input-wrap input{flex:1;border:none;background:none;outline:none;font-family:inherit;font-size:12px;color:var(--text);letter-spacing:.5px}
.key-input-wrap input::placeholder{color:var(--text3)}
.eye-btn{background:none;border:none;cursor:pointer;color:var(--text3);font-size:14px;padding:0;transition:color .15s}
.eye-btn:hover{color:var(--text2)}
.key-notice{font-size:11px;color:var(--text3);line-height:1.7;margin-bottom:16px}
.key-notice span{color:var(--g);font-weight:600}
.key-confirm-btn{width:100%;padding:11px;background:linear-gradient(135deg,#029e48,var(--g));border:none;border-radius:10px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;font-family:inherit;transition:all .2s;opacity:.4;letter-spacing:.2px}
.key-confirm-btn.ready{opacity:1;box-shadow:0 4px 16px var(--g-glow)}
.key-confirm-btn.ready:hover{transform:translateY(-1px);box-shadow:0 8px 24px var(--g-glow)}
.key-confirm-btn:disabled{cursor:not-allowed}
.key-skip-btn{width:100%;padding:7px;background:none;border:none;color:var(--text3);font-size:11px;cursor:pointer;margin-top:6px;font-family:inherit;transition:color .15s}
.key-skip-btn:hover{color:var(--text2)}

/* ë¶„ì„ ëª¨ë‹¬ */
.analysis-modal-inner{background:linear-gradient(160deg,#080f1c,#0d1c30);border:1px solid var(--border2);border-radius:18px;max-width:640px;width:100%;max-height:88vh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,.6),var(--shadow-g)}
.analysis-modal-head{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:linear-gradient(135deg,rgba(3,199,90,.05),transparent)}
.analysis-modal-body{padding:20px 24px;overflow-y:auto;flex:1}
.analysis-modal-body::-webkit-scrollbar{width:4px}
.analysis-modal-body::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:2px}
.analysis-section{margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--border)}
.analysis-section:last-child{border-bottom:none}
.analysis-section-title{font-size:11px;font-weight:800;color:var(--g);letter-spacing:.5px;text-transform:uppercase;margin-bottom:6px;display:flex;align-items:center;gap:6px}
.analysis-section-content{font-size:12px;color:var(--text2);line-height:1.75}
.analysis-loading{color:var(--text3);font-size:12px;display:flex;align-items:center;gap:10px;padding:8px 0}

/* â•â• í—¤ë” â•â• */
.site-header{
  position:sticky;top:0;z-index:100;height:var(--hh);
  background:rgba(6,13,23,.85);backdrop-filter:blur(20px) saturate(180%);
  border-bottom:1px solid var(--border);
  padding:0 20px;display:flex;align-items:center;justify-content:space-between;
}
.header-left{display:flex;align-items:center;gap:10px}
.h-logo{
  width:28px;height:28px;border-radius:8px;
  background:linear-gradient(135deg,#029e48,var(--g));
  display:flex;align-items:center;justify-content:center;
  font-family:'Syne',sans-serif;font-size:15px;font-weight:900;color:#fff;
  box-shadow:0 2px 10px var(--g-glow);
}
.h-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--text);letter-spacing:-.3px}
.h-version{font-size:9px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:4px;padding:2px 7px;font-weight:700;letter-spacing:.3px}
.header-right{display:flex;align-items:center;gap:12px}
.h-clock{display:flex;flex-direction:column;align-items:flex-end;line-height:1.2}
.h-clock-time{font-family:'Syne',sans-serif;font-size:16px;font-weight:700;letter-spacing:2px;color:var(--g);font-variant-numeric:tabular-nums;filter:drop-shadow(0 0 8px var(--g-glow))}
.h-clock-date{font-size:9px;color:var(--text3);letter-spacing:.3px}
.h-div{width:1px;height:24px;background:var(--border)}
.api-status{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--text3)}
.s-dot{width:7px;height:7px;border-radius:50%;background:var(--g);box-shadow:0 0 8px var(--g-glow);animation:pulse 2s ease infinite}
.s-dot.off{background:var(--text3);box-shadow:none;animation:none}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 8px var(--g-glow)}50%{opacity:.6;box-shadow:0 0 4px var(--g-glow)}}
.h-btn{background:var(--glass);border:1px solid var(--border);color:var(--text2);border-radius:7px;padding:5px 12px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s}
.h-btn:hover{background:var(--glass2);border-color:var(--border2);color:var(--text)}

/* â•â• íˆì–´ë¡œ â•â• */
.hero{
  position:relative;z-index:2;text-align:center;padding:36px 20px 28px;overflow:hidden;
}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:6px;
  font-size:10px;font-weight:700;letter-spacing:2px;color:var(--g);text-transform:uppercase;
  background:var(--g-dim);border:1px solid rgba(3,199,90,.2);border-radius:20px;
  padding:4px 14px;margin-bottom:16px;
  animation:fadeSlideUp .6s ease .1s both;
}
.hero h1{
  font-family:'Syne',sans-serif;font-size:32px;font-weight:900;
  color:#fff;line-height:1.15;margin-bottom:10px;letter-spacing:-1px;
  animation:fadeSlideUp .6s ease .2s both;
}
.hero h1 em{
  color:transparent;font-style:normal;
  background:linear-gradient(135deg,var(--g),#00e676,var(--b2));
  -webkit-background-clip:text;background-clip:text;
}
.hero-sub{
  font-size:13px;color:var(--text3);margin-bottom:22px;line-height:1.7;
  animation:fadeSlideUp .6s ease .3s both;
}
.hero-sub strong{color:var(--text2)}
.hero-stats{
  display:inline-flex;align-items:stretch;
  background:var(--glass);border:1px solid var(--border);border-radius:14px;
  overflow:hidden;animation:fadeSlideUp .6s ease .4s both;
  box-shadow:0 4px 24px rgba(0,0,0,.3);
}
.hero-stat{display:flex;flex-direction:column;align-items:center;padding:12px 24px;gap:2px;position:relative}
.hero-stat::after{content:'';position:absolute;right:0;top:20%;height:60%;width:1px;background:var(--border)}
.hero-stat:last-child::after{display:none}
.hero-stat-num{font-family:'Syne',sans-serif;font-size:22px;font-weight:900;color:var(--g);line-height:1;filter:drop-shadow(0 0 8px var(--g-glow))}
.hero-stat-lbl{font-size:9px;color:var(--text3);font-weight:500;letter-spacing:.3px}
@keyframes fadeSlideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}

/* â•â• API ë°°ë„ˆ â•â• */
#apiKeyBanner{
  display:none;background:rgba(245,158,11,.08);border-bottom:1px solid rgba(245,158,11,.2);
  padding:6px 20px;align-items:center;justify-content:center;gap:10px;
  font-size:11px;color:var(--amber);position:relative;z-index:2;
}

/* â•â• ë©”ì¸ â•â• */
.app-main{max-width:1200px;margin:0 auto;padding:0 16px 40px;position:relative;z-index:2}

/* â•â• ì…ë ¥ íŒ¨ë„ (sticky) â•â• */
.sticky-panel{
  position:sticky;top:var(--hh);z-index:50;
  margin-bottom:14px;
}
.input-card{
  background:linear-gradient(160deg,rgba(9,19,32,.96),rgba(13,26,45,.96));
  backdrop-filter:blur(20px) saturate(150%);
  border:1px solid var(--border2);border-radius:var(--r);
  box-shadow:0 8px 40px rgba(0,0,0,.5),0 0 0 1px rgba(3,199,90,.04);
  overflow:hidden;
}

/* ì§„í–‰ ë°” */
.pbar-strip{
  background:rgba(0,0,0,.25);border-bottom:1px solid var(--border);
  padding:8px 20px;display:flex;align-items:center;gap:16px;
}
.pbar-track{height:2px;background:rgba(255,255,255,.07);border-radius:1px;flex:1;overflow:hidden}
.pbar-fill{height:100%;background:linear-gradient(90deg,var(--g),var(--b2));width:0%;transition:width .7s cubic-bezier(.4,0,.2,1);border-radius:1px;box-shadow:0 0 8px var(--g-glow)}
.pbar-steps{display:flex;gap:20px;align-items:center;flex-shrink:0}
.pbar-step{display:flex;align-items:center;gap:5px}
.pstep-dot{
  width:20px;height:20px;border-radius:50%;
  background:rgba(255,255,255,.05);border:1.5px solid rgba(255,255,255,.12);
  display:flex;align-items:center;justify-content:center;
  transition:all .4s cubic-bezier(.34,1.56,.64,1);flex-shrink:0;position:relative;
}
.pstep-num{font-size:8px;font-weight:800;color:var(--text3);transition:opacity .2s}
.pstep-check{width:8px;height:8px;position:absolute;opacity:0;transition:opacity .2s}
.pstep-lbl{font-size:9px;color:var(--text3);font-weight:500;white-space:nowrap;transition:color .3s}
.pbar-step.active .pstep-dot{background:rgba(3,199,90,.15);border-color:var(--g);animation:pDot 1.5s ease infinite}
.pbar-step.active .pstep-num{color:var(--g)}
.pbar-step.active .pstep-lbl{color:#fff;font-weight:700}
.pbar-step.done .pstep-dot{background:var(--g);border-color:var(--g);animation:pDone .4s cubic-bezier(.34,1.56,.64,1)}
.pbar-step.done .pstep-num{opacity:0}
.pbar-step.done .pstep-check{opacity:1}
.pbar-step.done .pstep-lbl{color:var(--g);font-weight:600}
@keyframes pDot{0%,100%{box-shadow:0 0 0 0 rgba(3,199,90,.4)}50%{box-shadow:0 0 0 5px rgba(3,199,90,0)}}
@keyframes pDone{0%{transform:scale(.5)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
.pbar-msg{font-size:9px;color:var(--text3);min-width:130px;text-align:right;transition:all .3s}

/* ì»¬ëŸ¼ ë¼ë²¨ ë°” */
.col-labels{
  display:grid;grid-template-columns:1fr 1fr 1fr 1fr;
  border-bottom:1px solid var(--border);
}
.col-lbl{
  padding:5px 16px;font-size:9px;font-weight:700;
  color:var(--text3);letter-spacing:.6px;text-transform:uppercase;
  display:flex;align-items:center;gap:5px;
}
.col-lbl:not(:last-child){border-right:1px solid var(--border)}
.col-lbl-dot{width:5px;height:5px;border-radius:50%;background:var(--g);opacity:.5}

/* ì…ë ¥ ê·¸ë¦¬ë“œ */
.input-grid{
  display:grid;grid-template-columns:1fr 1fr 1fr 1fr;
  border-bottom:1px solid var(--border);
}
.input-col{padding:12px 16px;display:flex;flex-direction:column;gap:8px}
.input-col:not(:last-child){border-right:1px solid var(--border)}

/* í¼ ìš”ì†Œ */
.lbl{font-size:10px;font-weight:700;color:var(--text2);display:flex;align-items:center;gap:4px;margin-bottom:2px}
.req{color:var(--g);font-size:9px}
.lbl-desc{font-size:9px;color:var(--text3);margin-bottom:5px}
.inp{
  width:100%;padding:7px 10px;
  background:rgba(0,0,0,.3);border:1.5px solid var(--border);
  border-radius:var(--r2);font-size:11px;font-family:inherit;color:var(--text);outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.inp:focus{border-color:rgba(3,199,90,.45);box-shadow:0 0 0 3px rgba(3,199,90,.07);background:rgba(0,0,0,.4)}
.inp::placeholder{color:var(--text3)}
textarea.inp{resize:none;line-height:1.5}

/* feat slots */
.feat-slot{display:flex;align-items:center;gap:5px;background:rgba(0,0,0,.2);border:1px solid var(--border);border-radius:5px;padding:4px 7px;margin-bottom:3px;transition:border-color .15s}
.feat-slot:focus-within{border-color:rgba(3,199,90,.3)}
.feat-slot-num{font-size:9px;font-weight:700;color:var(--g);width:12px;flex-shrink:0}
.feat-slot input{flex:1;background:none;border:none;outline:none;font-size:10px;color:var(--text);font-family:inherit}
.feat-slot input::placeholder{color:var(--text3)}
.feat-slot-del{background:none;border:none;color:var(--text3);cursor:pointer;font-size:11px;padding:0 2px;transition:color .15s}
.feat-slot-del:hover{color:var(--red)}
.feat-add-btn{background:none;border:1px dashed rgba(255,255,255,.12);color:var(--text3);border-radius:5px;padding:4px 0;font-size:10px;cursor:pointer;font-family:inherit;width:100%;transition:all .2s;margin-top:2px}
.feat-add-btn:hover{border-color:rgba(3,199,90,.4);color:var(--g);background:var(--g-dim)}
.feat-suggest{display:flex;flex-wrap:wrap;gap:3px;margin-bottom:5px}
.feat-chip{font-size:9px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:4px;padding:2px 6px;cursor:pointer;transition:all .15s}
.feat-chip:hover{background:rgba(3,199,90,.2)}
.feat-chip.used{background:var(--glass);border-color:var(--border);color:var(--text3);cursor:default}
.feat-suggest-lbl{font-size:9px;color:var(--text3);margin-bottom:3px}

/* ì´ë¯¸ì§€ ì—…ë¡œë“œ */
.upload-zone{
  border:1.5px dashed rgba(255,255,255,.12);border-radius:var(--r2);
  padding:8px;text-align:center;cursor:pointer;transition:all .2s;
  position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;
  background:rgba(0,0,0,.2);min-height:56px;
}
.upload-zone:hover{border-color:rgba(3,199,90,.4);background:var(--g-dim)}
.upload-zone.filled{border-color:rgba(3,199,90,.3);background:rgba(3,199,90,.04)}
.upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%}
.upl-icon{font-size:16px;filter:drop-shadow(0 0 6px var(--g-glow))}
.upl-text{font-size:9px;color:var(--text3)}
.upl-count{font-size:9px;color:var(--g);font-weight:700}
.img-grid{display:flex;flex-wrap:wrap;gap:4px;margin-top:5px}
.img-thumb{position:relative;width:44px;height:44px;flex-shrink:0;border-radius:5px;overflow:hidden;border:1.5px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,.3);transition:transform .15s}
.img-thumb:hover{transform:scale(1.05)}
.img-thumb img{width:100%;height:100%;object-fit:cover;display:block}
.del-btn{position:absolute;top:2px;right:2px;width:14px;height:14px;border-radius:50%;background:rgba(229,62,62,.9);color:#fff;font-size:8px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700;transition:background .15s}
.del-btn:hover{background:var(--red)}
.img-num{position:absolute;bottom:2px;left:3px;font-size:7px;font-weight:700;color:#fff;background:rgba(0,0,0,.5);border-radius:2px;padding:0 3px;line-height:14px}

/* ë¶„ì„ ì»¬ëŸ¼ */
.col-analysis{background:linear-gradient(160deg,rgba(3,199,90,.04),rgba(0,102,255,.03))}
.analysis-head{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.analysis-orb{
  width:32px;height:32px;border-radius:50%;flex-shrink:0;
  background:linear-gradient(135deg,rgba(3,199,90,.2),rgba(0,102,255,.15));
  border:1px solid rgba(3,199,90,.25);
  display:flex;align-items:center;justify-content:center;font-size:15px;
  box-shadow:0 0 16px rgba(3,199,90,.15);animation:orbPulse 3s ease infinite;
}
@keyframes orbPulse{0%,100%{box-shadow:0 0 16px rgba(3,199,90,.15)}50%{box-shadow:0 0 24px rgba(3,199,90,.25)}}
.analysis-title-sm{font-size:10px;font-weight:800;color:var(--text)}
.analysis-sub-sm{font-size:8px;color:var(--text3);margin-top:1px}
.analysis-status{font-size:9px;color:var(--text3);padding:3px 7px;background:rgba(0,0,0,.2);border-radius:4px;border:1px solid var(--border);display:inline-block;margin-bottom:6px}
.analysis-preview{
  font-size:9px;color:var(--text2);line-height:1.7;flex:1;
  display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical;overflow:hidden;
  margin-bottom:8px;min-height:60px;
}
.analysis-btn{
  background:linear-gradient(135deg,var(--g-dim),rgba(0,102,255,.08));
  border:1px solid rgba(3,199,90,.25);color:var(--g);border-radius:6px;
  padding:6px 10px;font-size:10px;font-weight:700;cursor:pointer;font-family:inherit;
  width:100%;transition:all .2s;
}
.analysis-btn:hover{background:rgba(3,199,90,.15);box-shadow:0 0 12px rgba(3,199,90,.15)}
.analysis-btn:disabled{background:var(--glass);border-color:var(--border);color:var(--text3);cursor:not-allowed;box-shadow:none}

/* í‘¸í„° í–‰ (ìƒì„± ë²„íŠ¼) */
.input-footer{
  padding:10px 16px;display:flex;align-items:center;gap:12px;
  background:rgba(0,0,0,.15);
}
.gen-btn{
  padding:10px 28px;
  background:linear-gradient(135deg,#029e48,var(--g));
  border:none;border-radius:var(--r2);
  font-family:'Syne',sans-serif;font-size:12px;font-weight:800;color:#fff;
  cursor:pointer;letter-spacing:.3px;transition:all .2s;
  box-shadow:0 4px 16px var(--g-glow);white-space:nowrap;
  position:relative;overflow:hidden;
}
.gen-btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,transparent,rgba(255,255,255,.15),transparent);
  transform:translateX(-100%);transition:transform .4s ease;
}
.gen-btn:hover::before{transform:translateX(100%)}
.gen-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px var(--g-glow)}
.gen-btn:active{transform:translateY(0)}
.gen-btn:disabled{background:rgba(255,255,255,.06);box-shadow:none;cursor:not-allowed;color:var(--text3)}
.gen-btn:disabled::before{display:none}
.footer-info{font-size:9px;color:var(--text3);flex:1}

/* â•â• ì„¹ì…˜ í—¤ë” â•â• */
.section-header{
  display:flex;align-items:center;gap:10px;
  padding:10px 0 8px;
}
.section-label{
  font-family:'Syne',sans-serif;font-size:11px;font-weight:700;
  color:var(--text2);letter-spacing:.5px;text-transform:uppercase;
  display:flex;align-items:center;gap:6px;
}
.section-label::before{content:'';width:3px;height:14px;background:var(--g);border-radius:2px;box-shadow:0 0 8px var(--g-glow)}
.section-div{flex:1;height:1px;background:var(--border)}

/* â•â• ê´‘ê³  ë¯¸ë¦¬ë³´ê¸° â•â• */
.preview-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.pv-card{
  background:var(--glass);backdrop-filter:blur(12px);
  border:1px solid var(--border);border-radius:var(--r);
  overflow:hidden;transition:border-color .2s,box-shadow .2s;
}
.pv-card:hover{border-color:var(--border2);box-shadow:0 4px 24px rgba(0,0,0,.3)}
.pv-head{padding:8px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:6px;background:rgba(0,0,0,.15)}
.pv-head h4{font-size:10px;font-weight:700;color:var(--text2);flex:1}
.pv-live{font-size:8px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:3px;padding:1px 5px;font-weight:700;animation:blink 2s ease infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.6}}
.pv-body{padding:12px 14px}

/* ë„¤ì´ë²„ PC ê´‘ê³  */
.naver-ad{background:#fff;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.08)}
.naver-ad-inner{padding:12px 14px}
.naver-ad-header{display:flex;align-items:center;gap:3px;margin-bottom:7px;flex-wrap:wrap}
.naver-ad-logo{width:14px;height:14px;border-radius:3px;background:#03C75A;display:flex;align-items:center;justify-content:center;font-size:7px;font-weight:900;color:#fff;flex-shrink:0}
.naver-ad-store{font-size:10px;color:#555;font-weight:500}
.naver-ad-url{font-size:10px;color:#777}
.naver-ad-badge{font-size:7px;color:#888;border:1px solid #ccc;border-radius:2px;padding:1px 3px;line-height:1.2;margin-left:2px}
.naver-ad-row{display:flex;gap:10px;align-items:flex-start}
.naver-ad-body{flex:1;min-width:0}
.naver-ad-title{font-size:14px;font-weight:700;color:#1a73e8;line-height:1.4;margin-bottom:4px}
.naver-ad-title.empty{color:#ccc;font-weight:400;font-size:11px}
.naver-ad-desc{font-size:11px;color:#444;line-height:1.55}
.naver-ad-desc.empty{color:#ccc;font-size:10px}
.naver-ad-thumb{width:72px;height:72px;border-radius:5px;background:#f8f8f8;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;overflow:hidden;border:1px solid #eee}
.naver-ad-thumb img{width:100%;height:100%;object-fit:cover}
.naver-ad-chips{display:flex;flex-wrap:wrap;gap:3px;margin-top:6px}
.naver-ad-chip{background:#f3f3f3;border:1px solid #e5e5e5;border-radius:2px;padding:2px 6px;font-size:9px;color:#555}

/* ë„¤ì´ë²„ ëª¨ë°”ì¼ */
.naver-mob-ad{background:#fff;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.08)}
.naver-mob-ad-inner{padding:12px 14px}
.naver-mob-meta{display:flex;align-items:center;gap:4px;margin-bottom:8px;flex-wrap:wrap}
.naver-mob-logo{width:16px;height:16px;border-radius:50%;background:#03C75A;display:flex;align-items:center;justify-content:center;font-size:7px;font-weight:900;color:#fff;flex-shrink:0}
.naver-mob-store{font-size:11px;color:#555;font-weight:500}
.naver-mob-url{font-size:10px;color:#888}
.naver-mob-badge{font-size:8px;color:#888;border:1px solid #ccc;border-radius:2px;padding:1px 3px;line-height:1.2;margin-left:2px}
.naver-mob-row{display:flex;gap:10px;align-items:flex-start;margin-bottom:8px}
.naver-mob-body{flex:1;min-width:0}
.naver-mob-title{font-size:15px;font-weight:700;color:#1a73e8;line-height:1.4;margin-bottom:5px;word-break:keep-all}
.naver-mob-title.empty{color:#ccc;font-weight:400;font-size:12px}
.naver-mob-desc{font-size:12px;color:#444;line-height:1.55}
.naver-mob-desc.empty{color:#ccc;font-size:11px}
.naver-mob-thumb{width:72px;height:72px;border-radius:6px;background:#f8f8f8;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;overflow:hidden;border:1px solid #eee}
.naver-mob-thumb img{width:100%;height:100%;object-fit:cover}
.naver-mob-chips{display:flex;flex-wrap:wrap;gap:5px;margin-top:4px}
.naver-mob-chip{background:#f5f5f5;border:1px solid #e0e0e0;border-radius:14px;padding:3px 11px;font-size:11px;color:#444;cursor:pointer;transition:background .1s}
.naver-mob-chip:hover{background:#ebebeb}
.pv-note{font-size:8px;color:var(--text3);margin-top:6px;text-align:center}

/* â•â• ê²°ê³¼ ì¹´ë“œ â•â• */
.result-wrap{margin-bottom:14px}
.result-card{
  background:var(--glass);backdrop-filter:blur(12px);
  border:1px solid var(--border);border-radius:var(--r);overflow:hidden;
}
.result-tabs{display:flex;border-bottom:1px solid var(--border);background:rgba(0,0,0,.2)}
.rtab{
  flex:1;padding:9px 0;font-size:11px;font-weight:700;color:var(--text3);
  border:none;background:none;cursor:pointer;
  border-bottom:2px solid transparent;transition:all .2s;font-family:inherit;
  display:flex;align-items:center;justify-content:center;gap:6px;
}
.rtab.active{color:var(--text);border-bottom-color:var(--g)}
.rpane{display:none}
.rpane.active{display:block}

/* ì•„ì´í…œ */
.sec-bar{
  display:flex;align-items:center;gap:6px;padding:6px 12px;
  border-bottom:1px solid var(--border);background:rgba(0,0,0,.15);
  position:sticky;top:0;z-index:1;
}
.sec-title{font-size:10px;font-weight:700;color:var(--text2);display:flex;align-items:center;gap:5px;flex:1}
.badge{font-size:9px;background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2);border-radius:3px;padding:1px 6px;font-weight:700}
.badge.sel{background:rgba(0,102,255,.1);color:var(--b2);border-color:rgba(0,102,255,.2)}
.item{display:flex;align-items:center;gap:8px;padding:7px 12px;border-bottom:1px solid var(--border);transition:background .15s;cursor:pointer}
.item:hover{background:rgba(255,255,255,.03)}
.item.on{background:rgba(3,199,90,.04)}
.plus{
  width:22px;height:22px;border-radius:50%;
  border:1.5px solid var(--border);background:none;color:var(--text3);
  font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .2s;flex-shrink:0;
}
.plus:hover{border-color:var(--g);color:var(--g);background:var(--g-dim)}
.item.on .plus{background:var(--g);border-color:var(--g);color:#fff}
.txt-wrap{flex:1;min-width:0}
.txt{font-size:11px;color:var(--text);line-height:1.4;outline:none}
.txt:focus{outline:1px solid rgba(3,199,90,.4);border-radius:2px;padding:1px 2px}
.meta{display:flex;align-items:center;gap:5px;margin-top:2px}
.cc{font-size:9px;color:var(--text3)}
.cc.over{color:var(--red);font-weight:700}
.badge-tag{font-size:8px;background:var(--g-dim);color:var(--g);border-radius:2px;padding:1px 5px;font-weight:700}
.pin-sel{
  background:rgba(0,0,0,.2);border:1px solid var(--border);color:var(--text2);
  border-radius:4px;padding:2px 6px;font-size:9px;cursor:pointer;font-family:inherit;
  flex-shrink:0;transition:border-color .15s;
}
.pin-sel:focus{outline:none;border-color:rgba(3,199,90,.4)}
.pin-sel.pinned{border-color:rgba(0,102,255,.4);color:var(--b2);background:rgba(0,102,255,.06)}

/* ë¹ˆ ìƒíƒœ */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:10px}
.empty-icon{font-size:32px;opacity:.2;filter:grayscale(1)}
.empty-txt{text-align:center;font-size:12px;color:var(--text3);line-height:1.8}
.empty-txt strong{color:var(--text2)}

/* ì„ íƒ ì¹´ë“œ */
.sel-card{
  background:var(--glass);backdrop-filter:blur(12px);
  border:1px solid var(--border);border-radius:var(--r);padding:12px 16px;
}
.sel-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.sel-head{font-size:9px;font-weight:700;color:var(--text3);display:flex;justify-content:space-between;margin-bottom:5px;text-transform:uppercase;letter-spacing:.4px}
.sel-cnt{color:var(--g);font-weight:700}
.sel-item{font-size:10px;color:var(--text2);background:rgba(0,0,0,.2);border-radius:4px;padding:4px 8px;margin-bottom:3px;display:flex;align-items:center;gap:4px;border:1px solid var(--border)}
.sel-empty{font-size:10px;color:var(--text3)}
.sel-x{background:none;border:none;cursor:pointer;color:var(--text3);font-size:11px;margin-left:auto;padding:0 2px;flex-shrink:0;transition:color .15s}
.sel-x:hover{color:var(--red)}

/* â•â• ìŠ¤í”¼ë„ˆ â•â• */
.spin,.spin-sm{display:inline-block;border-radius:50%;border:2px solid rgba(255,255,255,.1);border-top-color:var(--g);animation:spin .6s linear infinite}
.spin{width:14px;height:14px}
.spin-sm{width:10px;height:10px;border-width:1.5px}
@keyframes spin{to{transform:rotate(360deg)}}

/* ê¸°íƒ€ */
.notice{font-size:11px;border-radius:6px;padding:7px 11px;margin:4px 0}
.n-error{background:rgba(255,77,109,.08);color:var(--red);border:1px solid rgba(255,77,109,.2)}
.n-warn{background:rgba(245,158,11,.08);color:var(--amber);border:1px solid rgba(245,158,11,.2)}
.n-info{background:var(--g-dim);color:var(--g);border:1px solid rgba(3,199,90,.2)}
.kw-chip{font-size:9px;background:var(--glass);border:1px solid var(--border);border-radius:3px;padding:2px 6px;cursor:pointer;color:var(--text3);transition:all .15s}
.kw-chip:hover{background:var(--g-dim);border-color:rgba(3,199,90,.3);color:var(--g)}
.divider{height:1px;background:var(--border);margin:4px 0}
.ripple-btn{position:relative;overflow:hidden}
</style>
</head>
<body>

<div class="aurora"><div class="aurora-1"></div><div class="aurora-2"></div><div class="aurora-3"></div></div>
<div class="noise"></div>

<!-- â”€â”€ API Key ëª¨ë‹¬ â”€â”€ -->
<div class="overlay hidden" id="keyModal">
  <div class="key-modal">
    <div class="key-modal-head">
      <button onclick="document.getElementById('keyModal').classList.add('hidden')" style="position:absolute;top:14px;right:16px;background:rgba(255,255,255,.15);border:none;color:#fff;width:28px;height:28px;border-radius:50%;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;z-index:1">Ã—</button>
      <div class="logo-mark">N</div>
      <h2>íŒŒì›Œë§í¬ ê´‘ê³  ì†Œì¬ ìƒì„±ê¸°</h2>
      <p>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ URL í•˜ë‚˜ë¡œ íŒŒì›Œë§í¬ ê´‘ê³  ë¬¸êµ¬ë¥¼<br>AIê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤</p>
    </div>
    <div class="key-modal-body">

      <!-- Gemini íƒ­ -->
      <div class="tab-pane active" id="tab-claude">
        <div class="step-guide">
          <div class="step-guide-title">Google Gemini API Key ë°œê¸‰ (ë¬´ë£Œ)</div>
          <div class="step-row">
            <div class="step-num">1</div>
            <div class="step-text"><a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com</a> ì ‘ì† (êµ¬ê¸€ ê³„ì • ë¡œê·¸ì¸)</div>
          </div>
          <div class="step-row">
            <div class="step-num">2</div>
            <div class="step-text"><b>Create API Key</b> í´ë¦­ â†’ í”„ë¡œì íŠ¸ ì„ íƒ í›„ ìƒì„±</div>
          </div>
          <div class="step-row">
            <div class="step-num">3</div>
            <div class="step-text">ìƒì„±ëœ <b>AIza...</b> í˜•íƒœì˜ í‚¤ë¥¼ ë³µì‚¬í•´ì„œ ì•„ë˜ì— ë¶™ì—¬ë„£ê¸°</div>
          </div>
        </div>
        <div class="key-input-wrap">
          <input type="password" id="modalKey" placeholder="AIzaSy..." oninput="onKeyInput()" onpaste="setTimeout(onKeyInput,10)" />
          <button class="key-toggle-btn" onclick="toggleModalKey()">ğŸ‘</button>
        </div>
        <div class="key-notice">
          ğŸ”’ API KeyëŠ” <span>ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥</span>ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šì•„ìš”.<br>
          ğŸ’š Gemini 2.0 Flash ê¸°ì¤€ <span>í•˜ë£¨ 1,500íšŒ ì™„ì „ ë¬´ë£Œ</span>ì…ë‹ˆë‹¤
        </div>
      </div>

      <div style="padding:20px 32px 28px">
        <button class="key-confirm-btn ripple-btn" id="keyConfirmBtn" onclick="confirmKey()" disabled>
          <span class="btn-icon">âœ“</span>
          <span class="btn-text">ì €ì¥í•˜ê³  ì‹œì‘í•˜ê¸°</span>
        </button>
        <button class="key-skip-btn" onclick="document.getElementById('keyModal').classList.add('hidden')">
          ë‚˜ì¤‘ì— ì„¤ì •í• ê²Œìš”
        </button>
      </div>

      
    </div>
  </div>
</div>




<!-- ë¶„ì„ ëª¨ë‹¬ -->
<div class="overlay hidden" id="analysisModal">
  <div class="analysis-modal-inner">
    <div class="analysis-modal-head">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,rgba(3,199,90,.2),rgba(0,102,255,.15));border:1px solid rgba(3,199,90,.3);display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 0 20px rgba(3,199,90,.2)">ğŸ§ </div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:800;color:#fff">ë§ˆì¼€í„° ë¶„ì„ ë¦¬í¬íŠ¸</div>
          <div style="font-size:10px;color:var(--text3);margin-top:2px">10ë…„ì°¨ ë„¤ì´ë²„ íŒŒì›Œë§í¬ ì „ë¬¸ê°€ì˜ ì†Œì¬ ì „ëµ ë¶„ì„</div>
        </div>
      </div>
      <button onclick="document.getElementById('analysisModal').classList.add('hidden')" style="background:rgba(255,255,255,.07);border:1px solid var(--border);color:var(--text2);width:30px;height:30px;border-radius:50%;font-size:16px;cursor:pointer;flex-shrink:0;transition:all .15s">Ã—</button>
    </div>
    <div class="analysis-modal-body" id="analysisModalBody">
      <div class="analysis-loading"><span class="spin-sm"></span> ë¶„ì„ ì¤‘...</div>
    </div>
  </div>
</div>

<!-- í—¤ë” -->
<header class="site-header">
  <div class="header-left">
    <div class="h-logo">N</div>
    <span class="h-title">íŒŒì›Œë§í¬ ê´‘ê³  ì†Œì¬ ìƒì„±ê¸°</span>
    <span class="h-version">v3.0</span>
  </div>
  <div class="header-right">
    <div class="h-clock">
      <div class="h-clock-time" id="hClockTime">00:00:00</div>
      <div class="h-clock-date" id="hClockDate"></div>
    </div>
    <div class="h-div"></div>
    <div class="api-status">
      <span class="s-dot" id="claudeDot"></span>
      <span>Gemini API</span>
    </div>
    <button class="h-btn" onclick="openKeyModal()">âš™ ì„¤ì •</button>
  </div>
</header>

<!-- íˆì–´ë¡œ -->
<section class="hero">
  <div class="hero-eyebrow">âœ¦ Naver Powerlink Â· AI Copy Generator</div>
  <h1>ê´‘ê³  ì†Œì¬, <em>ì´ì œ AIê°€</em><br>ë§Œë“¤ì–´ë“œë ¤ìš”</h1>
  <p class="hero-sub">ìƒí’ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ <strong>ì œëª© 30ê°œ Â· ì„¤ëª… 12ê°œ</strong>ë¥¼ ì¦‰ì‹œ ìƒì„±í•´ë“œë ¤ìš”<br>Gemini AI Â· AIë§ˆì¼€íŒ…ì „ëµì—°êµ¬ì†Œ</p>
  <div class="hero-stats">
    <div class="hero-stat"><span class="hero-stat-num">30</span><span class="hero-stat-lbl">ê´‘ê³  ì œëª©</span></div>
    <div class="hero-stat"><span class="hero-stat-num">12</span><span class="hero-stat-lbl">ê´‘ê³  ì„¤ëª…</span></div>
    <div class="hero-stat"><span class="hero-stat-num">AI</span><span class="hero-stat-lbl">ë¶„ì„ ë¦¬í¬íŠ¸</span></div>
  </div>
</section>

<div id="apiKeyBanner">
  <span>âš ï¸ Gemini API Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ì–´ìš”.</span>
  <button onclick="openKeyModal()" style="background:rgba(245,158,11,.2);border:1px solid rgba(245,158,11,.4);border-radius:5px;padding:3px 10px;font-size:11px;font-weight:700;cursor:pointer;font-family:inherit;color:var(--amber);margin-left:8px">ğŸ”‘ ì„¤ì •í•˜ê¸°</button>
</div>

<main class="app-main">

  <!-- â‘  ì…ë ¥ íŒ¨ë„ (sticky) -->
  <div class="sticky-panel">
    <div class="input-card">

      <!-- ì§„í–‰ ë°” -->
      <div class="pbar-strip">
        <div class="pbar-track"><div class="pbar-fill" id="pbarFill"></div></div>
        <div class="pbar-steps">
          <div class="pbar-step" id="pg1">
            <div class="pstep-dot"><span class="pstep-num">1</span><svg class="pstep-check" viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div class="pstep-lbl">ìƒí’ˆ ë¶„ì„</div>
          </div>
          <div class="pbar-step" id="pg2">
            <div class="pstep-dot"><span class="pstep-num">2</span><svg class="pstep-check" viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div class="pstep-lbl">ì†Œì¬ ì‘ì„±</div>
          </div>
          <div class="pbar-step" id="pg3">
            <div class="pstep-dot"><span class="pstep-num">3</span><svg class="pstep-check" viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div class="pstep-lbl">ì™„ë£Œ</div>
          </div>
        </div>
        <div class="pbar-msg" id="pbarMsg">ì†Œì¬ ìƒì„± ì¤€ë¹„ ì™„ë£Œ</div>
      </div>

      <!-- ì»¬ëŸ¼ ë¼ë²¨ -->
      <div class="col-labels">
        <div class="col-lbl"><span class="col-lbl-dot"></span>ìƒí’ˆëª… Â· íƒ€ê²Ÿ</div>
        <div class="col-lbl"><span class="col-lbl-dot"></span>ê´‘ê³ ì— ë„£ê³  ì‹¶ì€ ë‚´ìš©</div>
        <div class="col-lbl"><span class="col-lbl-dot"></span>ìƒì„¸í˜ì´ì§€ ì´ë¯¸ì§€</div>
        <div class="col-lbl"><span class="col-lbl-dot"></span>ë§ˆì¼€í„° ë¶„ì„ ë¦¬í¬íŠ¸</div>
      </div>

      <!-- 4ì»¬ëŸ¼ ì…ë ¥ -->
      <div class="input-grid">

        <!-- ìƒí’ˆëª… + íƒ€ê²Ÿ -->
        <div class="input-col">
          <div>
            <div class="lbl">ìƒí’ˆëª… <span class="req">*</span></div>
            <div class="lbl-desc">í•µì‹¬ í‚¤ì›Œë“œ í¬í•¨</div>
            <input type="text" class="inp" id="productName" placeholder="ì˜ˆ: ì•„ë¡œë§ˆ ë””í“¨ì € 200ml ìš°ë“œí–¥" />
          </div>
          <div>
            <div class="lbl">íƒ€ê²Ÿ ê³ ê°</div>
            <div class="lbl-desc">ì„±ë³„Â·ë‚˜ì´Â·ì§ì—… ë“±</div>
            <input type="text" class="inp" id="target" placeholder="ì˜ˆ: 30ëŒ€ ì—¬ì„±, ì†Œìƒê³µì¸" />
          </div>
        </div>

        <!-- ê´‘ê³  ë‚´ìš© -->
        <div class="input-col">
          <div class="lbl">ê´‘ê³ ì— ë„£ê³  ì‹¶ì€ ë‚´ìš©</div>
          <div class="lbl-desc">íŠ¹ì§•Â·í˜œíƒÂ·ê°•ì¡° í¬ì¸íŠ¸</div>
          <div id="featSuggestWrap" style="display:none">
            <div class="feat-suggest-lbl" id="featSuggestLbl">ğŸ’¡ AI ì¶”ì²œ</div>
            <div class="feat-suggest" id="featSuggest"></div>
          </div>
          <div class="feat-slots" id="featSlots">
            <div class="feat-slot"><span class="feat-slot-num">1</span><input type="text" placeholder="ì˜ˆ: ì²œì—° ì—ì„¼ì…œì˜¤ì¼ 100% ì‚¬ìš©" /><button class="feat-slot-del" onclick="removeSlot(this)">âœ•</button></div>
            <div class="feat-slot"><span class="feat-slot-num">2</span><input type="text" placeholder="ì˜ˆ: 12ì‹œê°„ ì€ì€í•˜ê²Œ ì§€ì†" /><button class="feat-slot-del" onclick="removeSlot(this)">âœ•</button></div>
          </div>
          <button class="feat-add-btn" id="featAddBtn" onclick="addSlot()">+ í•­ëª© ì¶”ê°€</button>
        </div>

        <!-- ì´ë¯¸ì§€ -->
        <div class="input-col">
          <div class="lbl">ìƒì„¸í˜ì´ì§€ ì´ë¯¸ì§€</div>
          <div class="lbl-desc">AI ì§ì ‘ ë¶„ì„ (ìµœëŒ€ 20ì¥)</div>
          <div class="upload-zone" id="uploadZone">
            <input type="file" id="fileInput" accept="image/*" multiple onchange="onFile(event)" />
            <div class="upl-icon">ğŸ–¼ï¸</div>
            <div class="upl-text">ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</div>
            <div class="upl-count" id="uplCount" style="display:none"></div>
          </div>
          <div class="img-grid" id="imgGrid"></div>
          <div id="costCurrent" style="display:none;font-size:9px;color:var(--text3);margin-top:3px">
            í˜„ì¬ <b id="costImgCnt" style="color:var(--g)">0</b>ì¥ â†’ ì•½ <b id="costAmt" style="color:var(--g)">-</b>
          </div>
        </div>

        <!-- ë¶„ì„ ë¦¬í¬íŠ¸ -->
        <div class="input-col col-analysis">
          <div class="analysis-head">
            <div class="analysis-orb">ğŸ§ </div>
            <div>
              <div class="analysis-title-sm">ë§ˆì¼€í„° ë¶„ì„ ë¦¬í¬íŠ¸</div>
              <div class="analysis-sub-sm">AIë§ˆì¼€íŒ…ì „ëµì—°êµ¬ì†Œ</div>
            </div>
          </div>
          <div class="analysis-status" id="analysisSideStatus">ì†Œì¬ ìƒì„± í›„ ìë™ ë¶„ì„ë©ë‹ˆë‹¤</div>
          <div class="analysis-preview" id="analysisSidePreview">ê´‘ê³  ì†Œì¬ë¥¼ ìƒì„±í•˜ë©´ ì—¬ê¸°ì— ë§ˆì¼€í„°ì˜ ë¶„ì„ì´ ìš”ì•½ë˜ì–´ í‘œì‹œë©ë‹ˆë‹¤</div>
          <button class="analysis-btn" id="analysisOpenBtn" onclick="openAnalysisModal()" disabled>ğŸ“„ ì „ì²´ ë¦¬í¬íŠ¸ ë³´ê¸°</button>
        </div>

      </div><!-- input-grid -->

      <!-- ìƒì„± ë²„íŠ¼ -->
      <div class="input-footer">
        <button class="gen-btn ripple-btn" id="genBtn" onclick="generate()">
          <span id="genTxt">âœ¨ ê´‘ê³  ì†Œì¬ ìƒì„±í•˜ê¸°</span>
        </button>
        <div class="footer-info">Gemini AI Â· ì œëª© 30ê°œ Â· ì„¤ëª… 12ê°œ Â· ë¬´ë£Œ API ì‚¬ìš© ê°€ëŠ¥</div>
      </div>

    </div><!-- input-card -->
  </div><!-- sticky-panel -->

  <!-- â‘¡ ê´‘ê³  ë¯¸ë¦¬ë³´ê¸° -->
  <div class="section-header">
    <div class="section-label">ê´‘ê³  ë¯¸ë¦¬ë³´ê¸°</div>
    <div class="section-div"></div>
  </div>
  <div class="preview-grid">
    <div class="pv-card">
      <div class="pv-head"><h4>ğŸ–¥ PC ë¯¸ë¦¬ë³´ê¸°</h4><span class="pv-live">ì‹¤ì‹œê°„</span></div>
      <div class="pv-body">
        <div class="naver-ad">
          <div class="naver-ad-inner">
            <div class="naver-ad-header">
              <div class="naver-ad-logo">S</div>
              <span class="naver-ad-store">ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´</span>
              <span style="color:#ddd;font-size:9px">Â·</span>
              <span class="naver-ad-url">smartstore.naver.com</span>
              <span class="naver-ad-badge">ê´‘ê³ </span>
            </div>
            <div class="naver-ad-row">
              <div class="naver-ad-body">
                <div class="naver-ad-title empty" id="pvPcTitles">ì œëª©ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤</div>
                <div class="naver-ad-desc empty" id="pvPcDesc">ì„¤ëª…ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤</div>
                <div class="naver-ad-chips" id="pvPcChips"></div>
              </div>
              <div class="naver-ad-thumb" id="pvPcThumb">ğŸª</div>
            </div>
          </div>
        </div>
        <div class="pv-note">â€» í‚¤ì›Œë“œì— ë”°ë¼ ì´ë¯¸ì§€ ë¯¸ë…¸ì¶œ ê°€ëŠ¥</div>
      </div>
    </div>
    <div class="pv-card">
      <div class="pv-head"><h4>ğŸ“± ëª¨ë°”ì¼ ë¯¸ë¦¬ë³´ê¸°</h4><span class="pv-live">ì‹¤ì‹œê°„</span></div>
      <div class="pv-body">
        <div class="naver-mob-ad">
          <div class="naver-mob-ad-inner">
            <div class="naver-mob-meta">
              <div class="naver-mob-logo">S</div>
              <span class="naver-mob-store">ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´</span>
              <span style="color:#ddd;font-size:9px">Â·</span>
              <span class="naver-mob-url">smartstore.naver.com</span>
              <span class="naver-mob-badge">ê´‘ê³ </span>
            </div>
            <div class="naver-mob-row">
              <div class="naver-mob-body">
                <div class="naver-mob-title empty" id="pvMobTitles">ì œëª©ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤</div>
                <div class="naver-mob-desc empty" id="pvMobDesc">ì„¤ëª…ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤</div>
              </div>
              <div class="naver-mob-thumb" id="pvMobThumb">ğŸª</div>
            </div>
            <div class="naver-mob-chips" id="pvMobChips"></div>
          </div>
        </div>
        <div class="pv-note">â€» í•€ ê¸°ëŠ¥ìœ¼ë¡œ ì›í•˜ëŠ” ì• ì…‹ ê³ ì • ê¶Œì¥</div>
      </div>
    </div>
  </div>

  <!-- â‘¢ ê´‘ê³  ì†Œì¬ ê²°ê³¼ -->
  <div class="section-header">
    <div class="section-label">ê´‘ê³  ì†Œì¬</div>
    <div class="section-div"></div>
  </div>
  <div class="result-wrap">
    <div class="result-card">
      <div id="emptyState" class="empty">
        <div class="empty-icon">âœ¦</div>
        <div class="empty-txt">ìƒí’ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  <strong>ìƒì„± ë²„íŠ¼</strong>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”<br><span style="font-size:10px;opacity:.5">âœ“ ì œëª© 30ê°œ Â· ì„¤ëª… 12ê°œ Â· ë§ˆì¼€í„° ë¶„ì„ ë¦¬í¬íŠ¸</span></div>
      </div>
      <div id="analysisBody" style="display:none"></div>
      <div id="resultWrap" style="display:none">
        <div class="result-tabs">
          <button class="rtab active" id="rtabT" onclick="switchResultTab('t')">
            ê´‘ê³  ì œëª© <span class="badge" id="tBadge">0</span> <span class="badge sel" id="tSelBadge" style="display:none"></span>
          </button>
          <button class="rtab" id="rtabD" onclick="switchResultTab('d')">
            ê´‘ê³  ì„¤ëª… <span class="badge" id="dBadge">0</span> <span class="badge sel" id="dSelBadge" style="display:none"></span>
          </button>
        </div>
        <div class="rpane active" id="rpaneT"><div class="items" id="titleItems"></div></div>
        <div class="rpane" id="rpaneD"><div class="items" id="descItems"></div></div>
      </div>
    </div>
  </div>

  <!-- ì„ íƒ ëª©ë¡ -->
  <div class="sel-card">
    <div class="sel-grid">
      <div>
        <div class="sel-head">ì„ íƒëœ ì œëª© <span class="sel-cnt" id="sTCnt">0ê°œ</span></div>
        <div id="sTList"><div class="sel-empty">ì„ íƒ ì—†ìŒ</div></div>
      </div>
      <div>
        <div class="sel-head">ì„ íƒëœ ì„¤ëª… <span class="sel-cnt" id="sDCnt">0ê°œ</span></div>
        <div id="sDList"><div class="sel-empty">ì„ íƒ ì—†ìŒ</div></div>
      </div>
    </div>
  </div>

</main>

<script>



// â”€â”€ ìƒíƒœ
const S = { titles:[], descs:[], kws:[], selT:new Set(), selD:new Set(), imgs:[] };

// â”€â”€ API Key ê´€ë¦¬
let API_KEY     = localStorage.getItem('claude_key') || '';


window.addEventListener('DOMContentLoaded', () => {
  // ëª¨ë‹¬ì€ HTMLì—ì„œ hiddenìœ¼ë¡œ ì‹œì‘ - ìë™ìœ¼ë¡œ ì—´ì§€ ì•ŠìŒ
  if (API_KEY && API_KEY.length > 5) {
    updateKeyHeader(true);
  } else {
    showApiKeyBanner();
  }
});

function showApiKeyBanner() {
  const banner = document.getElementById('apiKeyBanner');
  if (banner) banner.style.display = 'flex';
}
function hideApiKeyBanner() {
  const banner = document.getElementById('apiKeyBanner');
  if (banner) banner.style.display = 'none';
}


function updateConfirmBtn() {
  const inp = document.getElementById('modalKey');
  const ck = inp.value.trim();
  const btn = document.getElementById('keyConfirmBtn');
  // ë§ˆìŠ¤í‚¹ ìƒíƒœë„ ì €ì¥ ê°€ëŠ¥ (ê¸°ì¡´ í‚¤ ìœ ì§€)
  const ok = ck.length >= 5 || inp.dataset.masked === 'true';
  btn.disabled = !ok;
  btn.classList.toggle('ready', ok);
}

function onKeyInput() { updateConfirmBtn(); }


function toggleModalKey() {
  const el = document.getElementById('modalKey');
  el.type = el.type === 'password' ? 'text' : 'password';
}

function confirmKey() {
  const inp = document.getElementById('modalKey');
  const ck = inp.value.trim();
  // ë§ˆìŠ¤í‚¹ ìƒíƒœ(ë³„í‘œ)ì´ê±°ë‚˜ ë¹ˆì¹¸ì´ë©´ ê¸°ì¡´ í‚¤ ìœ ì§€í•˜ê³  ë‹«ê¸°
  if (inp.dataset.masked === 'true' || !ck || ck.startsWith('â—')) {
    if (API_KEY && API_KEY.length > 5) {
      document.getElementById('keyModal').classList.add('hidden');
      return;
    }
    inp.style.borderColor = 'var(--red)';
    inp.placeholder = 'API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
    inp.focus();
    setTimeout(() => { inp.style.borderColor = ''; inp.placeholder = 'AIzaSy...'; }, 1800);
    return;
  }
  if (ck.length < 5) return;
  API_KEY = ck;
  localStorage.setItem('claude_key', ck);
  document.getElementById('keyModal').classList.add('hidden');
  updateKeyHeader(true);
  hideApiKeyBanner();
}

function openKeyModal() {
  const inp = document.getElementById('modalKey');
  // í‚¤ê°€ ë“±ë¡ëœ ìƒíƒœë©´ ë§ˆìŠ¤í‚¹ëœ ë³„í‘œë¡œ í‘œì‹œ
  if (API_KEY && API_KEY.length > 5) {
    inp.value = 'â—'.repeat(Math.min(API_KEY.length, 32));
    inp.dataset.masked = 'true';
    // í´ë¦­í•˜ë©´ ì§€ì›Œì§€ê³  ìƒˆë¡œ ì…ë ¥ ê°€ëŠ¥
    inp.onclick = function() {
      if (inp.dataset.masked === 'true') {
        inp.value = '';
        inp.dataset.masked = 'false';
        inp.placeholder = 'AIzaSy...';
        inp.onclick = null;
        updateConfirmBtn();
      }
    };
  } else {
    inp.value = '';
    inp.dataset.masked = 'false';
    inp.placeholder = 'AIzaSy...';
    inp.onclick = null;
  }
  document.getElementById('keyModal').classList.remove('hidden');
  updateConfirmBtn();
  inp.focus();
}

function updateKeyHeader(ok) {
  document.getElementById('claudeDot').className = 'status-dot' + (ok ? ' ok' : '');
}

// â”€â”€ íŒŒì¼ ì—…ë¡œë“œ (ìµœëŒ€ 20ì¥)
const MAX_IMGS = 20;
function onFile(e) {
  const files = Array.from(e.target.files).slice(0, MAX_IMGS - S.imgs.length);
  if (!files.length) return;
  files.forEach(f => {
    const r = new FileReader();
    r.onload = ev => {
      const raw = ev.target.result;
      const b64 = raw.split(',')[1];
      const type = f.type || 'image/jpeg';
      S.imgs.push({ b64, type, name: f.name, url: raw });
      renderImgGrid();
    };
    r.readAsDataURL(f);
  });
  // input ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥í•˜ê²Œ)
  e.target.value = '';
}
function updateCost() {
  const n = S.imgs.length;
  const el = document.getElementById('costCurrent');
  if (n === 0) { el.style.display='none'; return; }
  const secs = 3 + n * 2;
  const over = n > 10;
  el.style.display = 'block';
  if (document.getElementById('costImgCnt')) document.getElementById('costImgCnt').textContent = n;
  if (document.getElementById('costAmt')) document.getElementById('costAmt').innerHTML = `<span class="${over?'c-over':''}">ì•½ ${secs}ì´ˆ${over?' (ëŠë¦´ ìˆ˜ ìˆìŒ)':''}</span>`;
}

function removeImg(i) {
  S.imgs.splice(i, 1);
  renderImgGrid();
}
function renderImgGrid() {
  const grid = document.getElementById('imgGrid');
  const cnt  = document.getElementById('uplCount');
  const zone = document.getElementById('uploadZone');
  if (S.imgs.length === 0) {
    grid.innerHTML = '';
    cnt.style.display = 'none';
    zone.classList.remove('filled');
    updateCost();
    return;
  }
  zone.classList.add('filled');
  cnt.style.display = 'block';
  cnt.textContent = `âœ“ ${S.imgs.length}ì¥ ì„ íƒë¨ (ìµœëŒ€ ${MAX_IMGS}ì¥)`;
  updateCost();
  grid.innerHTML = S.imgs.map((img, i) => `
    <div class="img-thumb">
      <img src="${img.url}" alt="${img.name}" />
      <button class="del-btn" onclick="removeImg(${i})" title="ì‚­ì œ">Ã—</button>
      <span class="img-num">${i+1}</span>
    </div>`).join('');
}



// AI íŠ¹ì§• ì¶”ì²œ (3ê°œ ì œì•ˆ)
async function suggestFeatures(name, cat, price) {
  if (!API_KEY) return;
  const wrap = document.getElementById('featSuggestWrap');
  const lbl  = document.getElementById('featSuggestLbl');
  const box  = document.getElementById('featSuggest');
  wrap.style.display = 'block';
  lbl.innerHTML = 'ğŸ’¡ AI ì¶”ì²œ íŠ¹ì§• ë¶„ì„ ì¤‘... <span class="spin-sm"></span>';
  box.innerHTML = '';
  try {
    const raw = await callClaude(
      `ë‹¹ì‹ ì€ ë„¤ì´ë²„ íŒŒì›Œë§í¬ ê´‘ê³  ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ìƒí’ˆ ì •ë³´ë¥¼ ë³´ê³  ê´‘ê³ ì— ì¨ë¨¹ì„ í•µì‹¬ íŠ¹ì§•Â·ê°•ì  3ê°€ì§€ë¥¼ ë½‘ì•„ì£¼ì„¸ìš”.
ë°˜ë“œì‹œ JSON ë°°ì—´ë§Œ ì‘ë‹µí•˜ì„¸ìš”. ì˜ˆ: ["íŠ¹ì§•1","íŠ¹ì§•2","íŠ¹ì§•3"]
ê° í•­ëª©ì€ 15ì ì´ë‚´, êµ¬ì²´ì ì´ê³  ê´‘ê³  ì†Œì¬ì— ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ë¬¸êµ¬ë¡œ.`,
      `ìƒí’ˆëª…: ${name}
ì¹´í…Œê³ ë¦¬: ${cat||'ë¯¸ìƒ'}
ê°€ê²©: ${price||'ë¯¸ìƒ'}`
    );
    const clean = raw.replace(/```json|```/g,'').trim();
    const feats = JSON.parse(clean);
    lbl.textContent = 'ğŸ’¡ AI ì¶”ì²œ íŠ¹ì§• (í´ë¦­í•˜ë©´ ìŠ¬ë¡¯ì— ì¶”ê°€)';
    box.innerHTML = feats.map((f,i) =>
      `<span class="feat-chip" onclick="addFeatChip(this,'${esc(f)}')" id="fc${i}"><span class="chip-plus">+</span>${esc(f)}</span>`
    ).join('');
  } catch(e) {
    lbl.textContent = 'ğŸ’¡ íŠ¹ì§•ì„ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”';
    wrap.style.display = 'none';
  }
}

// ì¹© í´ë¦­ â†’ ë¹ˆ ìŠ¬ë¡¯ì— ì¶”ê°€
function addFeatChip(chipEl, text) {
  if (chipEl.classList.contains('used')) return;
  const slots = document.querySelectorAll('#featSlots .feat-slot input');
  const empty = [...slots].find(el => !el.value.trim());
  if (!empty) { alert('ìŠ¬ë¡¯ì´ ëª¨ë‘ ì°¨ìˆì–´ìš”. ê¸°ì¡´ ë‚´ìš©ì„ ì§€ìš°ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); return; }
  empty.value = text;
  chipEl.classList.add('used');
  chipEl.querySelector('.chip-plus').textContent = 'âœ“';
}

// ìŠ¬ë¡¯ ì‚­ì œ (X í´ë¦­)
function removeSlot(btn) {
  const slot = btn.closest('.feat-slot');
  slot.remove();
  reNumberSlots();
  updateAddBtn();
  // ì—°ê²°ëœ ì¹© ë³µì›
  const allVals = [...document.querySelectorAll('#featSlots .feat-slot input')].map(el=>el.value.trim());
  document.querySelectorAll('#featSuggest .feat-chip').forEach(c => {
    const chipVal = c.textContent.replace(/^[+âœ“]/,'').trim();
    if (!allVals.includes(chipVal)) {
      c.classList.remove('used');
      c.querySelector('.chip-plus').textContent = '+';
    }
  });
}

// ìŠ¬ë¡¯ ë²ˆí˜¸ ì¬ì •ë ¬
function reNumberSlots() {
  document.querySelectorAll('#featSlots .feat-slot').forEach((slot, i) => {
    slot.querySelector('.feat-slot-num').textContent = i + 1;
  });
}

// + ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
function updateAddBtn() {
  const cnt = document.querySelectorAll('#featSlots .feat-slot').length;
  const btn = document.getElementById('featAddBtn');
  if (!btn) return;
  btn.disabled = cnt >= 6;
  btn.textContent = cnt >= 6 ? 'ìµœëŒ€ 6ê°œê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥í•´ìš”' : '+ í•­ëª© ì¶”ê°€';
}

// ìŠ¬ë¡¯ ì¶”ê°€
function addSlot() {
  const slots = document.getElementById('featSlots');
  const cnt = slots.querySelectorAll('.feat-slot').length;
  if (cnt >= 6) return;
  const div = document.createElement('div');
  div.className = 'feat-slot';
  div.innerHTML = `<span class="feat-slot-num">${cnt+1}</span><input type="text" placeholder="ê°•ì¡°í•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" /><button class="feat-slot-del" onclick="removeSlot(this)">âœ•</button>`;
  slots.appendChild(div);
  div.querySelector('input').focus();
  updateAddBtn();
}







function setNotice(type, msg) {
  const el = document.getElementById('fetchNotice');
  el.innerHTML = msg ? `<div class="notice n-${type}">${msg}</div>` : '';
}

// â”€â”€ Gemini API í˜¸ì¶œ
async function callClaude(sys, userContent) {
  // userContentëŠ” string ë˜ëŠ” array (ì´ë¯¸ì§€ í¬í•¨)
  let parts = [];
  if (typeof userContent === 'string') {
    parts = [{ text: sys + '\n\n' + userContent }];
  } else {
    // ì´ë¯¸ì§€ ë°°ì—´ + í…ìŠ¤íŠ¸
    const textItem = userContent.find(c => c.type === 'text');
    const imgItems = userContent.filter(c => c.type === 'image');
    parts = [
      { text: sys },
      ...imgItems.map(c => ({
        inlineData: { mimeType: c.source.media_type, data: c.source.data }
      })),
      { text: textItem?.text || '' }
    ];
  }

  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
  const res = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      contents: [{ role: 'user', parts }],
      generationConfig: { maxOutputTokens: 2000, temperature: 0.7 }
    })
  });
  if (!res.ok) {
    const e = await res.json();
    const msg = e.error?.message || 'API ì˜¤ë¥˜';
    if (msg.includes('API_KEY_INVALID') || msg.includes('API key')) throw new Error('API Keyê°€ ìœ íš¨í•˜ì§€ ì•Šì•„ìš”. aistudio.google.comì—ì„œ ë‹¤ì‹œ ë°œê¸‰í•´ì£¼ì„¸ìš”.');
    if (msg.includes('quota') || msg.includes('RESOURCE_EXHAUSTED')) throw new Error('ì˜¤ëŠ˜ ë¬´ë£Œ í•œë„(1,500íšŒ)ë¥¼ ì´ˆê³¼í–ˆì–´ìš”. ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    throw new Error(msg);
  }
  const d = await res.json();
  return d.candidates?.[0]?.content?.parts?.[0]?.text || '';
}

// â”€â”€ ë‹¨ê³„ í‘œì‹œ
// ë‹¨ê³„ë³„ ë©”ì‹œì§€
const PG_MSGS = {
  '1-active': 'AIê°€ ìƒí’ˆì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”...',
  '2-active': 'ê´‘ê³  ì†Œì¬ 30ê°œ + ì„¤ëª… 12ê°œ ì‘ì„± ì¤‘...',
  '3-active': 'ê²°ê³¼ë¥¼ ì •ë¦¬í•˜ê³  ìˆì–´ìš”...',
  '3-done':   'ì™„ì„±! ì•„ë˜ì—ì„œ ì†Œì¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” âœ¨'
};
const PBAR_WIDTH = {'1-active':8,'1-done':33,'2-active':40,'2-done':66,'3-active':75,'3-done':100};

function pg(n, s) {
  const el = document.getElementById('pg'+n);
  if (!el) return;
  el.className = 'pbar-step ' + (s||'');
  // íŠ¸ë˜í‚¹ ë°” ë„ˆë¹„
  const key = n+'-'+s;
  if (PBAR_WIDTH[key] !== undefined) {
    const fill = document.getElementById('pbarFill');
    if (fill) fill.style.width = PBAR_WIDTH[key] + '%';
  }
  // ë©”ì‹œì§€
  const msg = PG_MSGS[key];
  if (msg) {
    const el2 = document.getElementById('pbarMsg');
    if (el2) {
      el2.style.opacity = '0';
      setTimeout(() => { el2.textContent = msg; el2.style.opacity = '1'; }, 200);
    }
  }
}

// â”€â”€ ë§ˆì¼€í„° ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±
async function generateAnalysis(name, feat, target, titles, descs, imgs) {
  imgs = imgs || [];
  const titleSample = titles.slice(0,5).join(', ');
  const descSample  = descs.slice(0,3).join(' / ');

  // ì…ë ¥ëœ í•­ëª©ë§Œ í¬í•¨
  const inputLines = [`- ìƒí’ˆëª…: ${name}`];
  if (feat && feat.trim()) inputLines.push(`- ê´‘ê³  í¬ì¸íŠ¸/ì¥ì : ${feat}`);
  if (target && target.trim()) inputLines.push(`- íƒ€ê²Ÿ ê³ ê°: ${target}`);
  if (imgs.length > 0) inputLines.push(`- ìƒì„¸í˜ì´ì§€ ì´ë¯¸ì§€: ${imgs.length}ì¥ ì²¨ë¶€ë¨ (ì§ì ‘ ë¶„ì„í•  ê²ƒ)`);
  inputLines.push(`- ìƒì„±ëœ ì œëª© ìƒ˜í”Œ: ${titleSample}`);
  inputLines.push(`- ìƒì„±ëœ ì„¤ëª… ìƒ˜í”Œ: ${descSample}`);

  // ì‘ì„± ì§€ì¹¨ - ì…ë ¥ëœ í•­ëª©ë§Œ ë¶„ì„
  const guideLines = [];
  guideLines.push('1. ìƒí’ˆëª…ì—ì„œ ì–´ë–¤ ê´‘ê³  í¬ì¸íŠ¸ë¥¼ ë°œê²¬í–ˆëŠ”ì§€ (êµ¬ì²´ì ìœ¼ë¡œ)');
  if (imgs.length > 0) guideLines.push('2. ì²¨ë¶€ëœ ìƒì„¸í˜ì´ì§€ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ë³´ê³  â€” ì–´ë–¤ ì œí’ˆì¸ì§€, ì–´ë–¤ íŠ¹ì§•ì´ ë³´ì´ëŠ”ì§€, ì´ë¯¸ì§€ì—ì„œ ë°œê²¬í•œ ê´‘ê³  í¬ì¸íŠ¸ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ');
  if (feat && feat.trim()) guideLines.push(`${guideLines.length+1}. ì…ë ¥ëœ ê´‘ê³  í¬ì¸íŠ¸(${feat})ë¥¼ ì–´ë–»ê²Œ í•´ì„í•˜ê³  ë°˜ì˜í–ˆëŠ”ì§€`);
  if (target && target.trim()) guideLines.push(`${guideLines.length+1}. íƒ€ê²Ÿ ê³ ê°(${target})ì˜ ì–¸ì–´Â·ì‹¬ë¦¬ë¥¼ ì–´ë–»ê²Œ ê´‘ê³  ì†Œì¬ì— ë…¹ì˜€ëŠ”ì§€`);
  guideLines.push(`${guideLines.length+1}. ì œëª© 30ê°œë¥¼ ì™œ ì´ëŸ° ë°©í–¥ìœ¼ë¡œ êµ¬ì„±í–ˆëŠ”ì§€ â€” ì–´ë–¤ ê°ë„ë“¤ì„ ì„ íƒí–ˆê³  ê·¸ ì´ìœ `);
  guideLines.push(`${guideLines.length+1}. ì„¤ëª… 12ê°œë¥¼ ì™œ ì´ë ‡ê²Œ ì¼ëŠ”ì§€ â€” 45ì ì•ˆì— ì–´ë–¤ ì •ë³´ì™€ ê°ì •ì„ ë‹´ì•˜ëŠ”ì§€`);

  const analysisPrompt = `ë‹¹ì‹ ì€ 10ë…„ì°¨ ë„¤ì´ë²„ íŒŒì›Œë§í¬ ê´‘ê³  ì „ë¬¸ ë§ˆì¼€í„°ì´ì ì¹´í”¼ë¼ì´í„°ì…ë‹ˆë‹¤.

ì•„ë˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê´‘ê³  ì†Œì¬ë¥¼ ì œì‘í–ˆìŠµë‹ˆë‹¤. ê´‘ê³ ì£¼ê°€ ë‚©ë“í•  ìˆ˜ ìˆë„ë¡ ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.

[ì…ë ¥ ì •ë³´]
${inputLines.join('\n')}

[ì‘ì„± ì§€ì¹¨]
ê°€ì¥ ë¨¼ì € <section title="ğŸ“‹ 5ì¤„ ìš”ì•½">í•µì‹¬ ë‚´ìš©ì„ 5ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½. ê° ë¬¸ì¥ì€ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„.</section> ì„ ì‘ì„±í•˜ì„¸ìš”.
ê·¸ ë‹¤ìŒ ì•„ë˜ í•­ëª©ë“¤ì„ ê°ê° <section> ìœ¼ë¡œ ì‘ì„±:
${guideLines.join('\n')}

ê° ì„¹ì…˜ì„ <section title="ì„¹ì…˜ì œëª©">ë‚´ìš©</section> í˜•íƒœë¡œ êµ¬ë¶„í•´ì„œ ì‘ë‹µí•˜ì„¸ìš”.
ì„¹ì…˜ ì œëª©ì€ ì´ëª¨ì§€ í¬í•¨í•´ì„œ ì§§ê²Œ. ë‚´ìš©ì€ 3~5ë¬¸ì¥. ê´‘ê³ ì£¼ê°€ "ì•„, ì´ë˜ì„œ ì´ëŸ° ì†Œì¬ê°€ ë‚˜ì™”êµ¬ë‚˜" í•˜ê³  ë‚©ë“í•  ìˆ˜ ìˆë„ë¡ êµ¬ì²´ì ìœ¼ë¡œ. ë§ˆí¬ë‹¤ìš´ ê¸ˆì§€.`;

  // ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€ì™€ í•¨ê»˜ ì „ë‹¬
  let userContent;
  if (imgs.length > 0) {
    userContent = imgs.slice(0, 5).map(img => ({  // ìµœëŒ€ 5ì¥ë§Œ (ë¶„ì„ìš©)
      type: 'image',
      source: { type: 'base64', media_type: img.type || 'image/jpeg', data: img.b64 }
    }));
    userContent.push({ type: 'text', text: analysisPrompt });
  } else {
    userContent = analysisPrompt;
  }

  const raw = await callClaude('', userContent);

  // ì„¹ì…˜ íŒŒì‹±
  const sections = [...raw.matchAll(/<section title="([^"]+)">([\s\S]*?)<\/section>/g)];
  if (!sections.length) {
    // fallback - ê·¸ëƒ¥ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
    const cleaned2 = raw.replace(/\*\*([^*]+)\*\*/g,'$1').replace(/\*([^*]+)\*/g,'$1');
    const escaped = cleaned2.replace(/\n\n/g,'<br><br>').replace(/\n/g,'<br>');
    return `<div class="analysis-section-content">${escaped}</div>`;
  }
  return sections.map(([,title,body]) => {
    const cleaned = body.trim()
      .replace(/\*\*([^*]+)\*\*/g, '$1')  // ** bold ì œê±°
      .replace(/\*([^*]+)\*/g, '$1');       // * italic ì œê±°
    const bodyHtml = cleaned.split('\n').join('<br>');
    return '<div class="analysis-section">'
      + '<div class="analysis-section-title">' + title + '</div>'
      + '<div class="analysis-section-content">' + bodyHtml + '</div>'
      + '</div>';
  }).join('');
}




function switchResultTab(tab) {
  ['t','d'].forEach(t => {
    document.getElementById('rtab'+t.toUpperCase()).classList.toggle('active', t===tab);
    document.getElementById('rpane'+t.toUpperCase()).classList.toggle('active', t===tab);
  });
}

function switchPvTab(tab) {
  const pc = document.getElementById('pvPcWrap');
  const mob = document.getElementById('pvMobWrap');
  const tabPc = document.getElementById('tabPc');
  const tabMob = document.getElementById('tabMob');
  if (tab === 'pc') {
    if (pc) pc.style.display=''; if (mob) mob.style.display='none';
    if (tabPc) tabPc.classList.add('active'); if (tabMob) tabMob.classList.remove('active');
  } else {
    if (pc) pc.style.display='none'; if (mob) mob.style.display='';
    if (tabPc) tabPc.classList.remove('active'); if (tabMob) tabMob.classList.add('active');
  }
}

function openAnalysisModal() {
  const body = document.getElementById('analysisModalBody');
  const src  = document.getElementById('analysisBody').innerHTML;
  body.innerHTML = src || '<div class="analysis-loading">ë¶„ì„ ë‚´ìš©ì´ ì—†ì–´ìš”.</div>';
  document.getElementById('analysisModal').classList.remove('hidden');
}

// â”€â”€ ìƒì„±
async function generate() {
  if (!API_KEY) { openKeyModal(); return; }
  const name = document.getElementById('productName').value.trim();
  if (!name) { alert('ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  const featSlots = [...document.querySelectorAll('#featSlots .feat-slot input')]
    .map(el => el.value.trim()).filter(Boolean);
  const feat = featSlots.join(', ');
  const target = document.getElementById('target').value.trim();
  const url    = '';

  const btn = document.getElementById('genBtn');
  btn.disabled = true;
  document.getElementById('genTxt').innerHTML = '<span class="spin"></span> ìƒì„± ì¤‘...';
  const pb = document.getElementById('progressBar');
  if (pb) { document.getElementById('pbarFill').style.width='0%'; }
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('resultWrap').style.display = 'none';

  S.selT = new Set(); S.selD = new Set();
  const sideStatus = document.getElementById('analysisSideStatus');
  const sidePreview = document.getElementById('analysisSidePreview');
  const sideBtn = document.getElementById('analysisOpenBtn');
  if (sideStatus) sideStatus.textContent = 'ë¶„ì„ ì¤‘...';
  if (sidePreview) { sidePreview.style.color='var(--gray-300)'; sidePreview.textContent='ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”...'; }
  if (sideBtn) sideBtn.disabled = true;

  pg(1, 'active');

  try {
    const prompt = `ìƒí’ˆëª…: ${name}${feat?'\ní•µì‹¬ íŠ¹ì§•: '+feat:''}${target?'\níƒ€ê²Ÿ ê³ ê°: '+target:''}${url?'\nìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ URL: '+url:''}\n\nìœ„ ìƒí’ˆì˜ ë„¤ì´ë²„ íŒŒì›Œë§í¬ ê´‘ê³  ì†Œì¬ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.`;

    // ì´ë¯¸ì§€ ì—¬ëŸ¬ ì¥ í¬í•¨
    let content;
    if (S.imgs.length > 0) {
      content = S.imgs.map(img => ({
        type: 'image',
        source: { type: 'base64', media_type: img.type || 'image/jpeg', data: img.b64 }
      }));
      content.push({ type: 'text', text: prompt });
    } else {
      content = prompt;
    }

    pg(1, 'done'); pg(2, 'active');

    const raw = await callClaude(
      `ë‹¹ì‹ ì€ ë„¤ì´ë²„ íŒŒì›Œë§í¬ ê´‘ê³  ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ë°˜ë“œì‹œ ìˆœìˆ˜ JSONë§Œ ì‘ë‹µí•˜ì„¸ìš”. ì½”ë“œë¸”ë¡, ì„¤ëª…, ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì ˆëŒ€ ê¸ˆì§€.

ìƒì„± ê·œì¹™:
- ì œëª©: 15ì ì´ë‚´, ì •í™•íˆ 30ê°œ. ìˆ«ìÂ·í˜œíƒÂ·íƒ€ê²Ÿì„ í™œìš©í•œ í´ë¦­ ìœ ë„ ë¬¸êµ¬. ë‹¤ì–‘í•œ ê°ë„ë¡œ ì‘ì„±.
- ì„¤ëª…: ë°˜ë“œì‹œ 45ì ì´í•˜(ê³µë°± í¬í•¨). ì •í™•íˆ 12ê°œ. í•µì‹¬ í˜œíƒì„ êµ¬ì²´ì ìœ¼ë¡œ, ê°€ëŠ¥í•˜ë©´ 43~45ìë¡œ ê½‰ ì±„ìš¸ ê²ƒ. 45ì ì´ˆê³¼ëŠ” ì ˆëŒ€ ê¸ˆì§€.
- íƒ€ê²Ÿ ê³ ê°ì´ ìˆìœ¼ë©´ í•´ë‹¹ íƒ€ê²Ÿì˜ ì–¸ì–´ì™€ ê´€ì‹¬ì‚¬ì— ë§ê²Œ ì‘ì„±.
- ê¸ˆì§€ í‘œí˜„: ìµœê³ Â·ìµœì €Â·1ìœ„Â·ìµœìƒÂ·íŠ¹ê°€Â·ìµœëŒ€Â·ìµœì €ê°€Â·ì••ë„ì Â·ì™„ë²½Â·íƒì›”Â·ì›”ë“±Â·ë…ë³´ì Â·ë³´ì¥Â·ë¬´ì¡°ê±´Â·100% íš¨ê³¼ ë“± ìµœìƒê¸‰Â·ê³¼ì¥ í‘œí˜„ ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€.
- ê·¼ê±° ì—†ëŠ” íš¨ëŠ¥ ê³¼ì¥ ê¸ˆì§€. êµ¬ì²´ì  ìˆ˜ì¹˜ë‚˜ ì‚¬ì‹¤ ê¸°ë°˜ìœ¼ë¡œë§Œ ì‘ì„±.

í˜•ì‹: {"titles":["...",...],"descs":["...",...]}`,
      content
    );

    let parsed;
    try { parsed = JSON.parse(raw.replace(/```json|```/g,'').trim()); }
    catch(e) { throw new Error('ê²°ê³¼ íŒŒì‹± ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); }

    S.titles = (parsed.titles || []).map(t => [...t].slice(0,15).join(''));
    S.descs  = (parsed.descs  || []).map(d => [...d].slice(0,45).join(''));
    S.kws    = [];

    pg(2, 'done'); pg(3, 'active');
    render();
    pg(3, 'done');
    document.getElementById('resultWrap').style.display = 'flex';
    // í”„ë¡œê·¸ë ˆìŠ¤ë°” ìœ ì§€ (ì‚¬ë¼ì§€ì§€ ì•ŠìŒ)

    // ë§ˆì¼€í„° ë¶„ì„ ë¦¬í¬íŠ¸ (ë¹„ë™ê¸° - ê²°ê³¼ í‘œì‹œ í›„ ì‹¤í–‰)
  
    document.getElementById('analysisBody').innerHTML = '<div class="analysis-loading"><span class="spin-sm"></span> ë¶„ì„ ì¤‘...</div>';
    generateAnalysis(name, feat, target, S.titles, S.descs, S.imgs).then(html => {
      document.getElementById('analysisBody').innerHTML = html;
      // ì‚¬ì´ë“œ íŒ¨ë„ ì—…ë°ì´íŠ¸
      const status = document.getElementById('analysisSideStatus');
      const preview = document.getElementById('analysisSidePreview');
      const btn = document.getElementById('analysisOpenBtn');
      if (status) status.textContent = 'ë¶„ì„ ì™„ë£Œ âœ“';
      if (preview) {
        // ì „ì²´ ì„¹ì…˜ì—ì„œ í•µì‹¬ ë¬¸ì¥ 5ì¤„ ì¶”ì¶œ
        const tmp = document.createElement('div'); tmp.innerHTML = html;
        // 5ì¤„ ìš”ì•½ ì„¹ì…˜ ìš°ì„ , ì—†ìœ¼ë©´ ì „ì²´ì—ì„œ ì¶”ì¶œ
        const tmp2 = tmp;
        const allSections = tmp2.querySelectorAll('.analysis-section');
        let summary = '';
        allSections.forEach(sec => {
          const title = sec.querySelector('.analysis-section-title');
          if (title && title.textContent.includes('5ì¤„ ìš”ì•½')) {
            const body = sec.querySelector('.analysis-section-content');
            if (body) summary = body.innerHTML;
          }
        });
        if (!summary) {
          const lines = [];
          tmp2.querySelectorAll('.analysis-section-content').forEach(el => {
            el.textContent.split(/[.ã€‚]\s+/).map(s=>s.trim()).filter(s=>s.length>10)
              .forEach(s => { if(lines.length<5) lines.push(s); });
          });
          summary = lines.join('<br>');
        }
        preview.style.color = '';
        preview.innerHTML = summary || 'ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
      }
      if (btn) { btn.disabled = false; }
    }).catch(() => {
      document.getElementById('analysisBody').innerHTML = '<div>ë¶„ì„ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”.</div>';
      const status = document.getElementById('analysisSideStatus');
      if (status) status.textContent = 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
    });

  } catch(err) {
    alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + err.message);
    [1,2,3].forEach(n => pg(n,''));
    const pb2 = document.getElementById('progressBar'); if(pb2) pb2.style.display='none';
    document.getElementById('emptyState').style.display = 'flex';
  } finally {
    btn.disabled = false;
    document.getElementById('genTxt').textContent = 'âœ¨ ê´‘ê³  ì†Œì¬ ìƒì„±í•˜ê¸°';
  }
}

// â”€â”€ ê²°ê³¼ ë Œë”ë§
function render() {
  // ì œëª©
  const tEl = document.getElementById('titleItems');
  tEl.innerHTML = '';
  S.titles.forEach((t, i) => {
    const len = [...t].length, over = len > 15;
    const g = i<5?'g1':i<10?'g2':'g3';
    // ì¶”ì²œ ê³ ì • ìœ„ì¹˜ (5ê°œì”© ê·¸ë£¹ â†’ ì œëª©1/2/3 ì¶”ì²œ)
    const recPin = i<5?'1':i<10?'2':'3';
    tEl.insertAdjacentHTML('beforeend',
      `<div class="item" id="t${i}">
        <button class="plus" onclick="tog('t',${i})">+</button>
        <div class="txt-wrap">
          <div class="txt">${esc(t)}</div>
          <div class="meta">
            <span class="gtag ${g}">ì œëª©${recPin} ì¶”ì²œ</span>
            <span class="cc${over?' over':''}">${len}/15ì${over?' âš ï¸':''}</span>
          </div>
        </div>
        <select class="pin-sel" id="pin${i}" onchange="onPinChange(${i},this)">
          <option value="">ìœ„ì¹˜ ê³ ì •</option>
          <option value="1">ì œëª© 1 ê³ ì •</option>
          <option value="2">ì œëª© 2 ê³ ì •</option>
          <option value="3">ì œëª© 3 ê³ ì •</option>
        </select>
      </div>`
    );
  });
  document.getElementById('tBadge').textContent = S.titles.length;

  // ì„¤ëª…
  const dEl = document.getElementById('descItems');
  dEl.innerHTML = '';
  S.descs.forEach((d, i) => {
    const len = [...d].length, over = len > 45;
    dEl.insertAdjacentHTML('beforeend',
      `<div class="item" id="d${i}">
        <button class="plus" onclick="tog('d',${i})">+</button>
        <div class="txt-wrap">
          <div class="txt" contenteditable="true" oninput="onDescEdit(${i},this)" onblur="onDescEdit(${i},this)">${esc(d)}</div>
          <div class="meta"><span class="cc${over?' over':''}">${len}/45ì${over?' âš ï¸':''}</span></div>
        </div>
        <select class="pin-sel" id="dpin${i}" onchange="onDescPinChange(${i},this)">
          <option value="">ìœ„ì¹˜ ê³ ì •</option>
          <option value="1">ì„¤ëª… 1 (ì•)</option>
          <option value="2">ì„¤ëª… 2 (ë’¤)</option>
        </select>
      </div>`
    );
  });
  document.getElementById('dBadge').textContent = S.descs.length;

  // í‚¤ì›Œë“œ
  const kwEl = document.getElementById('kwCloud');
  if (kwEl) kwEl.innerHTML = S.kws.map(k =>
    `<span class="kw-chip" onclick="cpKw(this)">${esc(k)}</span>`
  ).join('');
}

// ì œëª© ìœ„ì¹˜ ê³ ì • í•¸ë“¤ëŸ¬ (ë³µìˆ˜ í—ˆìš©)
function onPinChange(i, sel) {
  const val = sel.value;
  sel.className = 'pin-sel' + (val ? ' pinned' : '');
  if (val && !S.selT.has(i)) tog('t', i);
  sync();
}

// ì„¤ëª… ìœ„ì¹˜ ê³ ì • í•¸ë“¤ëŸ¬
function onDescPinChange(i, sel) {
  const val = sel.value;
  // ê°™ì€ ì„¤ëª… ìœ„ì¹˜ëŠ” 1ê°œë§Œ
  if (val) {
    document.querySelectorAll('[id^="dpin"]').forEach((s, idx) => {
      if (idx !== i && s.value === val) { s.value=''; s.className='pin-sel'; }
    });
  }
  sel.className = 'pin-sel' + (val ? ' pinned' : '');
  if (val && !S.selD.has(i)) tog('d', i);
  sync();
}

// ì œëª© ì§ì ‘ í¸ì§‘
function onTitleEdit(i, el) {
  const txt = el.textContent.trim();
  S.titles[i] = txt;
  const len = [...txt].length, over = len > 15;
  const cc = document.getElementById('tcc'+i);
  if (cc) { cc.textContent = len+'/15ì'+(over?' âš ï¸':''); cc.className='cc'+(over?' over':''); }
  sync();
}

// ì„¤ëª… ì§ì ‘ í¸ì§‘
function onDescEdit(i, el) {
  const txt = el.textContent.trim();
  S.descs[i] = txt;
  const len = [...txt].length, over = len > 45;
  const cc = el.closest('.txt-wrap')?.querySelector('.cc');
  if (cc) { cc.textContent = len+'/45ì'+(over?' âš ï¸':''); cc.className='cc'+(over?' over':''); }
  sync();
}

function cpKw(el) {
  navigator.clipboard.writeText(el.textContent).catch(()=>{});
  el.classList.add('copied');
  setTimeout(() => el.classList.remove('copied'), 800);
}

// â”€â”€ ì„ íƒ í† ê¸€
function tog(type, i) {
  const set = type==='t' ? S.selT : S.selD;
  set.has(i) ? set.delete(i) : set.add(i);
  document.getElementById(type+i).classList.toggle('on', set.has(i));
  const plusBtn = document.getElementById(type+i).querySelector('.plus');
  plusBtn.textContent = set.has(i) ? 'âœ“' : '+';
  sync();
}
function selAll(type) {
  const items = type==='t' ? S.titles : S.descs;
  const set   = type==='t' ? S.selT   : S.selD;
  items.forEach((_,i) => {
    set.add(i);
    const el = document.getElementById(type+i);
    if (el) { el.classList.add('on'); el.querySelector('.plus').textContent='âœ“'; }
  });
  sync();
}
function rem(type, i) {
  const set = type==='t' ? S.selT : S.selD;
  set.delete(i);
  const el = document.getElementById(type+i);
  if (el) { el.classList.remove('on'); el.querySelector('.plus').textContent='+'; }
  sync();
}

// â”€â”€ ë¯¸ë¦¬ë³´ê¸° ë™ê¸°í™”
function sync() {
  const ts = [...S.selT].sort((a,b)=>a-b).map(i => S.titles[i]);
  const ds = [...S.selD].sort((a,b)=>a-b).map(i => S.descs[i]);

  // ì œëª© í•€ë§µ (ë³µìˆ˜ í—ˆìš© - ê°™ì€ ìœ„ì¹˜ ì—¬ëŸ¬ê°œ ê°€ëŠ¥)
  const pinMap = {1:[], 2:[], 3:[]};
  document.querySelectorAll('[id^="pin"]:not([id^="dpin"])').forEach((s) => {
    const idx = parseInt(s.id.replace('pin',''));
    if (s.value && S.selT.has(idx)) pinMap[parseInt(s.value)].push(S.titles[idx]);
  });
  // ì„¤ëª… í•€ë§µ
  const descPinMap = {1: null, 2: null};
  document.querySelectorAll('[id^="dpin"]').forEach((s) => {
    const idx = parseInt(s.id.replace('dpin',''));
    if (s.value && S.selD.has(idx)) descPinMap[parseInt(s.value)] = S.descs[idx];
  });

  // ì œëª© ë¯¸ë¦¬ë³´ê¸° - í•€ëœ ê²ƒ ìš°ì„ , ìˆœì„œëŒ€ë¡œ ìµœëŒ€ 3ê°œ
  const slot1 = pinMap[1].length ? pinMap[1] : [];
  const slot2 = pinMap[2].length ? pinMap[2] : [];
  const slot3 = pinMap[3].length ? pinMap[3] : [];
  // í•€ ì—†ëŠ” ì„ íƒí•­ëª© ì±„ìš°ê¸°
  const unpinned = ts.filter(t => {
    const idx = S.titles.indexOf(t);
    const pin = document.getElementById('pin'+S.titles.indexOf(t));
    return !pin || !pin.value;
  });
  const allSlots = [
    ...(slot1.length?slot1:unpinned.slice(0,1)),
    ...(slot2.length?slot2:unpinned.slice(1,2)),
    ...(slot3.length?slot3:unpinned.slice(2,3))
  ].filter(Boolean).slice(0,3);

  // ì„¤ëª… ì¡°í•©
  const d1 = descPinMap[1] || ds[0] || '';
  const d2 = descPinMap[2] || ds[1] || '';
  const pvDTxt = [d1, d2].filter(Boolean).join(' ');
  // PC ë¯¸ë¦¬ë³´ê¸°
  const pvPcT = document.getElementById('pvPcTitles');
  if (pvPcT) {
    if (allSlots.length) {
      pvPcT.className = 'naver-ad-title';
      pvPcT.innerHTML = allSlots.join(' Â· ');
    } else {
      pvPcT.className = 'naver-ad-title empty';
      pvPcT.textContent = 'ì œëª©ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤';
    }
  }
  // ì¹©: ì„ íƒëœ ì„¤ëª…ë“¤ì„ ìš”ì•½ í‚¤ì›Œë“œë¡œ
  const pvPcChips = document.getElementById('pvPcChips');
  if (pvPcChips) {
    pvPcChips.innerHTML = ds.slice(0,2).map(d => {
      const words = d.split(/[,Â·\s]+/).filter(w=>w.length>1).slice(0,2);
      return words.map(w=>`<span class="naver-ad-chip">${esc(w)}</span>`).join('');
    }).join('');
  }
  const pvPcD = document.getElementById('pvPcDesc');
  if (pvPcD) {
    pvPcD.textContent = pvDTxt || 'ì„¤ëª…ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤';
    pvPcD.className = pvDTxt ? 'naver-ad-desc' : 'naver-ad-desc empty';
  }
  // ëª¨ë°”ì¼ ë¯¸ë¦¬ë³´ê¸°
  const pvMobT = document.getElementById('pvMobTitles');
  if (pvMobT) {
    if (allSlots.length) {
      pvMobT.className = 'naver-mob-title';
      pvMobT.innerHTML = allSlots.join('<br>');
    } else {
      pvMobT.className = 'naver-mob-title empty';
      pvMobT.textContent = 'ì œëª©ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤';
    }
  }
  const pvMobD = document.getElementById('pvMobDesc');
  if (pvMobD) {
    pvMobD.textContent = pvDTxt || 'ì„¤ëª…ì„ ì„ íƒí•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤';
    pvMobD.className = pvDTxt ? 'naver-mob-desc' : 'naver-mob-desc empty';
  }
  // ëª¨ë°”ì¼ ì¹©
  const pvMobChips = document.getElementById('pvMobChips');
  if (pvMobChips) {
    pvMobChips.innerHTML = ds.slice(0,3).map(d => {
      const words = d.split(/[,Â·\s]+/).filter(w=>w.length>1).slice(0,2);
      return words.map(w=>`<span class="naver-mob-chip">${esc(w)}</span>`).join('');
    }).join('');
  }

  document.getElementById('sTCnt').textContent = ts.length+'ê°œ';
  document.getElementById('sDCnt').textContent = ds.length+'ê°œ';

  // ì„ íƒ ëª©ë¡ - í•€ ì •ë³´ í‘œì‹œ
  document.getElementById('sTList').innerHTML = ts.length
    ? [...S.selT].sort((a,b)=>a-b).map(i => {
        const pin = document.getElementById('pin'+i)?.value;
        const badge = pin ? `<span style="font-size:10px;color:var(--blue);font-weight:700;margin-right:4px">[ì œëª©${pin}]</span>` : '';
        return `<div class="sel-item">${badge}<span contenteditable="true" style="flex:1;outline:none;cursor:text" oninput="S.titles[${i}]=this.textContent.trim();sync()" onblur="S.titles[${i}]=this.textContent.trim()">${esc(S.titles[i])}</span><button class="sel-x" onclick="rem('t',${i})">Ã—</button></div>`;
      }).join('')
    : '<div class="sel-empty">ì„ íƒ ì—†ìŒ</div>';
  document.getElementById('sDList').innerHTML = ds.length
    ? [...S.selD].sort((a,b)=>a-b).map(i => {
        const pin = document.getElementById('dpin'+i)?.value;
        const badge = pin ? `<span style="font-size:10px;color:var(--green);font-weight:700;margin-right:4px">[ì„¤ëª…${pin}]</span>` : '';
        return `<div class="sel-item">${badge}${esc(S.descs[i])}<button class="sel-x" onclick="rem('d',${i})">Ã—</button></div>`;
      }).join('')
    : '<div class="sel-empty">ì„ íƒ ì—†ìŒ</div>';

  const tsb = document.getElementById('tSelBadge');
  if (ts.length) { tsb.style.display=''; tsb.textContent='âœ“ '+ts.length+'ê°œ ì„ íƒ'; } else tsb.style.display='none';
  const dsb = document.getElementById('dSelBadge');
  if (ds.length) { dsb.style.display=''; dsb.textContent='âœ“ '+ds.length+'ê°œ ì„ íƒ'; } else dsb.style.display='none';

  // export button removed
}

// â”€â”€ CSV
function exportCSV() {
  const ts = [...S.selT].map(i => S.titles[i]);
  const ds = [...S.selD].map(i => S.descs[i]);
  const url = document.getElementById('storeUrl').value || 'https://smartstore.naver.com/';
  const name = document.getElementById('productName').value;
  let csv = '\ufeffì œëª©,ì„¤ëª…,í‘œì‹œURL\n';
  const rows = Math.max(ts.length, ds.length, 1);
  for (let i=0; i<rows; i++) csv += `"${ts[i]||''}","${ds[Math.min(i,ds.length-1)]||''}","${url}"\n`;
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv;charset=utf-8;'}));
  a.download = `íŒŒì›Œë§í¬_${name}_${new Date().toLocaleDateString('ko')}.csv`;
  a.click();
}

// â”€â”€ í—¤ë” ì‹œê³„
function startClock() {
  const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  function tick() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2,'0');
    const m = String(now.getMinutes()).padStart(2,'0');
    const s = String(now.getSeconds()).padStart(2,'0');
    const el = document.getElementById('hClockTime');
    if (el) el.textContent = h + ':' + m + ':' + s;
    const dateEl = document.getElementById('hClockDate');
    if (dateEl) {
      const y = now.getFullYear();
      const mo = now.getMonth()+1;
      const d = now.getDate();
      const day = days[now.getDay()];
      dateEl.textContent = y+'ë…„ '+mo+'ì›” '+d+'ì¼ ('+day+') KST';
    }
  }
  tick();
  setInterval(tick, 1000);
}
startClock();

function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#39;')}


function switchResultTab(tab) {
  ['t','d'].forEach(t => {
    const btn = document.getElementById('rtab'+t.toUpperCase());
    const pane = document.getElementById('rpane'+t.toUpperCase());
    if (btn) btn.classList.toggle('active', t===tab);
    if (pane) pane.classList.toggle('active', t===tab);
  });
}

function switchPvTab(tab) {}



function switchResultTab(tab) {
  ['t','d'].forEach(t => {
    const btn = document.getElementById('rtab'+t.toUpperCase());
    const pane = document.getElementById('rpane'+t.toUpperCase());
    if(btn) btn.classList.toggle('active', t===tab);
    if(pane) pane.classList.toggle('active', t===tab);
  });
}
function switchPvTab(){}



function switchResultTab(tab) {
  ['t','d'].forEach(t => {
    const btn = document.getElementById('rtab'+t.toUpperCase());
    const pane = document.getElementById('rpane'+t.toUpperCase());
    if(btn) btn.classList.toggle('active', t===tab);
    if(pane) pane.classList.toggle('active', t===tab);
  });
}
function switchPvTab(){}

</script>
</body>
</html>
